KISSY.add("magix/body",function(i,e,p){var o=e.has,l=e.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),b=document.body,h={},g={},j=65536,q=function(b,d,a){a?b.setAttribute(d,a):a=b.getAttribute(d);return a},m,k={process:function(h){for(var d=h.target||h.srcElement;d&&1!=d.nodeType;)d=d.parentNode;var a=d,c=h.type,f=g[c]||(g[c]=RegExp("(?:^|,)"+c+"(?:,|$)"));if(!f.test(q(d,"mx-ie"))){for(var r="mx-"+c,s,e,v=[];a&&a!=b&&!(s=q(a,r),e=q(a,"mx-ie"),s||f.test(e));)v.push(a),
a=a.parentNode;if(s){c=q(a,"mx-owner");if(!c){f=a;for(e=m.all();f&&f!=b;)if(o(e,f.id)){q(a,"mx-owner",c=f.id);break}else f=f.parentNode}if(c)(c=(c=m.get(c))&&c.view)&&c.processEvent({info:s,se:h,tId:d.id||(d.id="mx-e-"+j--),cId:a.id||(a.id="mx-e-"+j--)});else throw Error("miss mx-owner:"+s);}else for(;v.length;)h=v.shift(),e=q(h,"mx-ie"),f.test(e)||(e=e?e+","+c:c,q(h,"mx-ie",e))}},on:function(e,d){var a=this;h[e]?h[e]++:(m=d,h[e]=1,l[e]?a.unbubble(0,b,e):b["on"+e]=function(c){(c=c||window.event)&&
a.process(c)})},un:function(e){var d=h[e];0<d&&(d--,d||(l[e]?this.unbubble(1,b,e):b["on"+e]=null),h[e]=d)}};k.unbubble=function(b,d,a){(b?p.undelegate:p.delegate).call(p,d,a,"[mx-"+a+"]",k.process)};return k},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(i,e){var p=e.safeExec;return{fire:function(e,l,b,h){var g="~"+e,j=this[g];if(j){l||(l={});if(!l.type)l.type=e;for(var e=j.length,i=e-1,m,k;e--;){m=h?e:i-e;k=j[m];if(k.d||k.r)j.splice(m,1),i--;k.d||p(k.f,l,this)}}b&&delete this[g]},on:function(i,l,b){i="~"+i;i=this[i]||(this[i]=[]);e.isNumeric(b)?i.splice(b,0,{f:l}):i.push({f:l,r:b})},un:function(e,i){var b="~"+e,h=this[b];if(h)if(i)for(var b=h.length-1,g;0<=b;b--){if(g=h[b],g.f==i&&!g.d){g.d=1;break}}else delete this[b]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(i){var e=[].slice,p=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,o=/\/[^\/]*$/,l=/[#?].*$/,b=/([^=&?\/#]+)=([^&=#?]*)/g,h=/^https?:\/\//i,g={},j=0,q={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},m=g.hasOwnProperty,k=function(v){return function(d,b,f){switch(arguments.length){case 0:f=v;break;case 1:f=w.isObject(d)?c(v,d):a(v,d)?v[d]:null;break;case 2:null===b?(delete v[d],f=b):v[d]=f=b}return f}},t=function(a){this.c=
[];this.x=a||5;this.b=this.x+3},d=function(a){return new t(a)},a=function(a,c){return a?m.call(a,c):0},c=function(c,d,b){for(var f in d)if(!b||!a(b,f))c[f]=d[f];return c};c(t.prototype,{get:function(c){var d=this.c,b,c="pathname"+c;if(a(d,c)&&(b=d[c],1<=b.f))b.f++,b.t=j++,b=b.v;return b},set:function(c,b){var d=this.c,c="pathname"+c,f=d[c];if(!a(d,c)){if(d.length>=this.b){d.sort(function(a,c){return c.f==a.f?c.t-a.t:c.f-a.f});for(var e=this.b-this.x;e--;)f=d.pop(),delete d[f.k]}f={};d.push(f);d[c]=
f}f.k=c;f.v=b;f.f=1;f.t=j++;return f},del:function(a){var a="pathname"+a,c=this.c,d=c[a];if(d)d.f=-1E5,d.v="",delete c[a]},has:function(c){return a(this.c,"pathname"+c)}});var f=d(20),r=d(),s=function(a,c,d,b,f,n){w.isArray(a)||(a=[a]);if(!c||!w.isArray(c)&&!c.callee)c=[c];for(b=0;b<a.length;b++)try{n=a[b],f=w.isFunction(n)&&n.apply(d,c)}catch(e){}return f},w={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:c,has:a,safeExec:s,noop:function(){},config:k(q),start:function(a){var d=
this,a=c(q,a);d.libEnv(a);d.libRequire(a.iniFile,function(b){q=c(a,b,a);q.tagNameChanged="vframe"!=q.tagName;var f=a.progress;d.libRequire(["magix/router","magix/vom"],function(c,b){c.on("!ul",b.locChged);c.on("changed",b.locChged);f&&b.on("progress",f);d.libRequire(a.extensions,c.start)})});a.ready&&(s(a.ready),delete a.ready)},keys:Object.keys||function(c){var d=[],b;for(b in c)a(c,b)&&d.push(b);return d},local:k({}),path:function(a,c){var d=a+"\n"+c,b=r.get(d);if(!b){h.test(c)?b=c:(a=a.replace(l,
"").replace(o,"")+"/","/"==c.charAt(0)?(b=h.test(a)?8:0,b=a.indexOf("/",b),b=a.substring(0,b)+c):b=a+c);for(;p.test(b);)b=b.replace(p,"$1/");r.set(d,b)}return b},pathToObject:function(a,c){var d=f.get(a);if(!d){var d={},e={},s="";l.test(a)?s=a.replace(l,""):~a.indexOf("=")||(s=a);if(s&&h.test(s))var n=s.indexOf("/",8),s=-1==n?"/":s.substring(n);a.replace(b,function(a,d,b){if(c)try{b=decodeURIComponent(b)}catch(f){}e[d]=b});d.pathname=s;d.params=e;f.set(a,d)}return d},objectToPath:function(a,c){var b=
a.pathname,d=[],f=a.params,n,e;for(e in f)n=f[e],c&&encodeURIComponent(n),d.push(e+"="+n);return b+(b&&d.length?"?":"")+d.join("&")},tmpl:function(c,b){return 1==arguments.length?{v:g[c],h:a(g,c)}:g[c]=b},listToMap:function(a,c){var b,d,f={},n;w.isString(a)&&(a=a.split(","));if(a&&(n=a.length))for(b=0;b<n;b++)d=a[b],f[c?d[c]:d]=c?d:1;return f},cache:d};return c(w,{libRequire:function(a,c){a?i.use(""+a,function(a){c&&c.apply(a,e.call(arguments,1))}):c&&c()},libEnv:function(a){var c=a.appHome,b=location,
d=a.appName,c=this.path(b.href,c+"/");a.appHome=c;var f=a.debug;f&&(f=0==c.indexOf(b.protocol+"//"+b.host+"/"));b="";(b=f?i.now():a.appTag)&&(b+=".js");i.config({packages:[{name:d,path:c,debug:a.debug=f,combine:a.appCombine,tag:b}]})},isArray:i.isArray,isFunction:i.isFunction,isObject:i.isObject,isRegExp:i.isRegExp,isString:i.isString,isNumber:i.isNumber})});
KISSY.add("magix/router",function(i,e,p,o){var l=window,b=e.has,h=e.mix,i=document,g=/^UTF-8$/i.test(i.charset||i.characterSet||"UTF-8"),j=e.config(),q=e.cache(),m=e.cache(),k,t,d,a=/#.*$/,c=/^[^#]*#?!?/,f=j.nativeHistory,r,s,w=function(a,c,d){if(a){d=this.params;e.isArray(a)||(a=a.split(","));for(var f=0;f<a.length&&!(c=b(d,a[f]));f++);}return c},v=function(){return b(this,"pathname")},I=function(){return b(this,"view")},J=function(){return this.hash.pathname!=this.query.pathname},K=function(a){return this.hash.params[a]!=
this.query.params[a]},D=function(a){return b(this.hash.params,a)},n=function(a){return b(this.query.params,a)},E=function(a){return this.params[a]},x=function(a){var a=e.pathToObject(a,g),c=a.pathname;c&&s&&(a.pathname=e.path(l.location.pathname,c));return a},u=h({getView:function(a){if(!d){d={rs:j.routes||{},nf:j.notFoundView};var c=j.defaultView;if(!c)throw Error("unset defaultView");d.home=c;var b=j.defaultPathname||"";d.rs[b]=c;d.pathname=b}a||(a=d.pathname);c=d.rs;c=e.isFunction(c)?c.call(j,
a):c[a];return{view:c?c:d.nf||d.home,pathname:c?a:d.nf?a:d.pathname}},start:function(){var a=u,c=l.history;r=f&&c.pushState;s=f&&!r;r?a.useState():a.useHash();a.route()},parseQH:function(b){var b=b||l.location.href,d=u,e=q.get(b);if(!e){var e=b.replace(a,""),s=b.replace(c,""),g=x(e),r=x(s),v={};h(v,g.params);h(v,r.params);e={pathnameDiff:J,paramDiff:K,hashOwn:D,queryOwn:n,get:E,href:b,srcQuery:e,srcHash:s,query:g,hash:r,params:v};q.set(b,e)}e.view||(b=d.getView(f?e.hash.pathname||e.query.pathname:
e.hash.pathname),h(e,b));return e},getChged:function(a,c){var b=c.href,d=a.href+"\n"+b,f=m.get(d);f||(d=b+"\n"+d,f=m.get(d));if(!f){var e,f={params:{}};if(a.pathname!=c.pathname)e=f.pathname=1;if(a.view!=c.view)e=f.view=1;var b=a.params,n=c.params,s;for(s in b)b[s]!=n[s]&&(e=1,f.params[s]=1);for(s in n)b[s]!=n[s]&&(e=1,f.params[s]=1);f.occur=e;f.isParam=w;f.isPathname=v;f.isView=I;m.set(d,f)}return f},route:function(){var a=u,c=a.parseQH(),b=t||{params:{},href:"~"},d=!t;t=c;b=a.getChged(b,c);b.occur&&
(k=c,a.fire("changed",{location:c,changed:b,force:d}))},navigate:function(a,c,d){var f=u;!c&&e.isObject(a)&&(c=a,a="");c&&(a=e.objectToPath({params:c,pathname:a},g));if(a){c=x(a);a={};a.params=h({},c.params);a.pathname=c.pathname;if(a.pathname){if(s&&(c=k.query)&&(c=c.params))for(var n in c)b(c,n)&&!b(a.params,n)&&(a.params[n]="")}else n=h({},k.params),a.params=h(n,a.params),a.pathname=k.pathname;n=e.objectToPath(a);if(r?n!=k.srcQuery:n!=k.srcHash)r?(f.poped=1,history[d?"replaceState":"pushState"](null,
null,n),f.route()):(h(a,k,a),a.srcHash=n,a.hash={params:a.params,pathname:a.pathname},f.fire("!ul",{loc:k=a}),n="#!"+n,d?location.replace(n):location.hash=n)}}},p);u.useState=function(){var a=u,c=location.href;o.on(l,"popstate",function(){var b=location.href==c;if(a.poped||!b)a.poped=1,a.route()})};u.useHash=function(){o.on(l,"hashchange",u.route)};return u},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(i,e,p,o){var l=document,b=65536,h=e.mix,g=e.config("tagName"),j=e.config("rootId"),q=!e.config("tagNameChanged"),m=e.has,k=q?"mx-defer":"mx-vframe",t,d,a=function(a){return"object"==typeof a?a:l.getElementById(a)},c=/<script[^>]*>[\s\S]*?<\/script>/ig,f,r=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};h(r,{root:function(c,b){if(!t){f=b;var d=a(j);if(!d)d=l.createElement(g),d.id=j,l.body.insertBefore(d,l.body.firstChild);t=new r(j);
c.add(t)}return t}});h(h(r.prototype,p),{mountView:function(b,d){var g=this,r=a(g.id);r._bak?r._chgd=1:(r._bak=1,r._tmpl=r.innerHTML.replace(c,""));g.unmountView();if(b){var i=e.pathToObject(b),j=i.pathname,l=--g.sign;e.libRequire(j,function(c){if(l==g.sign){var b=g.owner;o.prepare(c);var e=new c({owner:g,id:g.id,$:a,path:j,vom:b,location:f});g.view=e;e.on("interact",function(a){if(!a.tmpl){if(r._chgd)r.innerHTML=r._tmpl;g.mountZoneVframes(0,0,1)}e.on("rendered",function(){g.mountZoneVframes(0,0,
1)});e.on("prerender",function(){g.unmountZoneVframes()});e.on("inited",function(){g.viewInited=1;g.fire("viewInited",{view:e})})},0);d=d||{};e.load(h(d,i.params,d))}})}},unmountView:function(){if(this.view){d||(d={caused:this.id});this.unmountZoneVframes();this.cAlter(d);this.view.destroy();var c=a(this.id);if(c&&c._bak)c.innerHTML=c._tmpl;delete this.view;delete this.viewInited;d=0;this.fire("viewUnmounted")}this.un("viewInited");this.sign--},mountVframe:function(a,c,b,d){var f=this.owner,e=f.get(a);
if(!e)e=new r(a),e.pId=this.id,m(this.cM,a)||this.cC++,this.cM[a]=d,f.add(e);e.mountView(c,b);return e},mountZoneVframes:function(c,d,f){this.unmountZoneVframes(c);var c=a(c||this.id).getElementsByTagName(g),e=c.length,h={};if(e)for(var r=0,i,n,j,l;r<e;r++)if(i=c[r],n=i.id||(i.id="magix_vf_"+b--),!m(h,n)&&(j=i.getAttribute("mx-view"),(l=!i.getAttribute(k)==q)||j)){this.mountVframe(n,j,d,f);n=a(i).getElementsByTagName(g);for(var u=0,t=n.length,o;u<t;u++)o=n[u],j=o.getAttribute("mx-view"),l=!i.getAttribute(k)==
q,!l&&!j&&(h[o.id||(o.id="magix_vf_"+b--)]=1)}this.cC==this.rC&&this.cCreated({})},unmountVframe:function(a){var a=a||this.id,c=this.owner,b=c.get(a);if(b){var d=b.fcc;b.unmountView();c.remove(a,d);if((c=c.get(b.pId))&&m(c.cM,a))delete c.cM[a],c.cC--}},unmountZoneVframes:function(c){if(c){for(var c=a(c).getElementsByTagName(g),b={},d=this.cM,f=c.length-1,e;0<=f;f--)e=c[f].id,m(d,e)&&(b[e]=1);c=b}else c=this.cM;for(var h in c)this.unmountVframe(h)},cCreated:function(a){var c=this.view;if(c&&!this.fcc)this.fcc=
1,delete this.fca,c.fire("created",a),this.fire("created",a);var b=this.owner;b.vfCreated();c=this.id;if((b=b.get(this.pId))&&!m(b.rM,c))b.rM[c]=b.cM[c],b.rC++,b.rC==b.cC&&b.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var c=this.view,b=this.id;if(c)this.fca=1,c.fire("alter",a),this.fire("alter",a);if((c=this.owner.get(this.pId))&&m(c.rM,b)){var d=c.rM[b];c.rC--;delete c.rM[b];d&&c.cAlter(a)}}},locChged:function(a,c){var b=this.view;if(b&&b.sign&&b.rendered){var d=b.olChanged(c),
f={location:a,changed:c,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];e.isString(a)&&(a=a.split(","));this.cs=a}};d&&e.safeExec(b.locationChange,f,b);for(var b=f.cs||e.keys(this.cM),d=0,f=b.length,g=this.owner,h;d<f;d++)(h=g.get(b[d]))&&h.locChged(a,c)}}});return r},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(i,e,p,o,l){var b=e.safeExec,h=e.has,g=[],j=e.mix,q=["render","renderUI"],m=function(a){return function(){var c;this.notifyUpdate()&&(c=a.apply(this,arguments));return c}},k=e.cache(40),t=function(a){j(this,a);this.sign=1};j(t,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,c,b=q.length-1,d;-1<b;b--)d=q[b],c=a[d],e.isFunction(c)&&c!=e.noop&&(a[d]=m(c))}}});var d=t.prototype,a=window.CollectGarbage||e.noop,c=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
f=/\smx-owner\s*=/,r=/\smx-[^v][a-z]+\s*=/,s=function(a){return!f.test(a)&&r.test(a)?a+' mx-owner="'+s.t+'"':a},w={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},v=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,I=/(\w+):([^,]+)/g;j(d,p);j(d,{render:e.noop,locationChange:e.noop,init:e.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,c=a.hasTmpl,d=arguments,f=a.sign,e=h(a,"template"),r=function(h){if(f==a.sign){if(!e)a.template=a.wrapMxEvent(h);a.delegateEvents();a.fire("interact",{tmpl:c},1);b(a.init,d,a);a.fire("inited",0,1);b(a.render,g,a);if(!c&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};c&&!e?a.fetchTmpl(r):r()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
a()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){s.t=this.id;return(""+a).replace(c,s)},setViewHTML:function(a){var c;this.beginUpdate();if(this.sign&&(c=this.$(this.id)))c.innerHTML=a;this.endUpdate()},observeLocation:function(a){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var b=c.keys;if(e.isObject(a))c.pn=a.pathname,a=a.keys;if(a)c.keys=b.concat((""+a).split(","))},olChanged:function(a){var c=this.$ol;if(c){var b=0;c.pn&&
(b=a.isPathname());b||(b=a.isParam(c.keys));return b}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),c=null;if(a&&a.viewInited)c=a.view;return c},processEvent:function(a){if(this.enableEvent&&this.sign){var c=a.info,d=a.se,f=k.get(c);f||(f=c.match(v),f={n:f[1],f:f[2],i:f[3],p:{}},f.i&&f.i.replace(I,function(a,c,b){f.p[c]=b}),k.set(c,f));if(c=this.events){var e=c[d.type],h=
w[f.f];h&&h.call(w,d);(h=e&&e[f.n])&&b(h,j({view:this,currentId:a.cId,targetId:a.tId,domEvent:d,events:c,params:f.p},w),e)}}},delegateEvents:function(a){var c=this.events,a=a?o.un:o.on,b=this.vom,d;for(d in c)a.call(o,d,b)}});var J=e.config("appHome"),K=e.config("debug")?"?t="+i.now():"",D=function(a,c,b){for(var d in c)i.isObject(c[d])?(h(a,d)||(a[d]={}),D(a[d],c[d],1)):b&&(a[d]=c[d])};t.prototype.fetchTmpl=function(a){var c=this,d=c.template;if(i.isUndefined(d))if(d=e.tmpl(c.path),d.h)a(d.v);else{var f=
J+c.path+".html",h=D[f],d=function(b){a(e.tmpl(c.path,b))};h?h.push(d):(h=D[f]=[d],l({url:f+K,success:function(a){b(h,a);delete D[f]},error:function(a,c){b(h,c);delete D[f]}}))}else a(d)};t.extend=function(a,c,d){var f=function(){f.superclass.constructor.apply(this,arguments);c&&b(c,arguments,this)};f.extend=this.extend;return i.extend(f,this,a,d)};t.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var c=a.prototype,b=a.superclass;b;)b=b.constructor,D(c,
b.prototype),b=b.superclass}a.wrapUpdate()};return t},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(i,e,p,o){var l=p.has,b=p.mix,h=0,g=0,j=0,q=0,m={},k={},t=p.mix({all:function(){return m},add:function(b){if(!l(m,b.id))h++,m[b.id]=b,b.owner=t,t.fire("add",{vframe:b})},get:function(b){return m[b]},remove:function(b,a){var c=m[b];c&&(h--,a&&g--,delete m[b],t.fire("remove",{vframe:c}))},vfCreated:function(){if(!q){g++;var b=g/h;j<b&&t.fire("progress",{percent:j=b},q=1==b)}},root:function(){return e.root(t,k)},locChged:function(d){var a=d.loc,c;a?c=1:a=d.location;b(k,
a);if(!c)c=t.root(),d=d.changed,d.isView()?c.mountView(a.view):c.locChged(a,d)}},o);return t},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(i,e,p){var o=e.has,l=e.safeExec,b=e.mix,h=function(a){i.isArray(a)||(a=[a]);for(var c=0,b;c<a.length;c++)b=a[c],delete b.cacheKey;return a},g=function(a){this.$mClass=a;this.$mCache=e.cache();this.$mCacheKeys={};this.$mMetas={}},j=[].slice,q={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},m=function(a){var c={},b;for(b in a)q[b]||(c[b]=a[b]);return c},k=function(a,c,b){return function(){return a.apply(c,[c,b].concat(j.call(arguments)))}},t=function(a,
c){if(c)for(var b=a.length-1;-1<b;b--)t(a[b]);else{b=a.$mm;if(!a.fromCache&&0<b.used)a.fromCache=!0;b.used++}};b(g,{create:function(a){if(!a)throw Error("MManager.create:modelClass ungiven");return new g(a)}});var d=function(a){this.$host=a;this.$doTask=!1;this.$reqModels={}};b(d.prototype,{fetchModels:function(a,c,b){var d=this;if(d.$doTask)return d.next(function(d){d.fetchModels(a,c,b)}),d;d.$doTask=!0;var e=d.$host,h=e.$mCache,g=e.$mCacheKeys,j=d.$reqModels;i.isArray(a)||(a=[a]);var m=a.length,
q=0,p,n,E=Array(m),x=[],u={},F=[],L=i.isArray(c);L&&(x=Array(c.length));for(var N=function(a,k,y,A){if(!d.$destroy){q++;delete j[a.id];var B=a.$mm,C=B.cacheKey;E[k]=a;if(A)n=!0,p=A,u[k]=y;else if(!C||C&&!h.has(C)){C&&h.set(C,a);B.doneAt=i.now();var z=B.after,B=B.meta;z&&l(z,[a,B]);e.fireAfter(B.name,[a])}if(2==b){if(z=L?c[k]:c)t(a),x[k]=l(z,[a,n?{msg:p}:null,n?u:null],d)}else if(4==b){F[k]={m:a,e:n,s:p};for(k=F.i||0;z=F[k];k++)if(B=L?c[k]:c,t(z.m),x[k]=l(B,[z.m,z.e?{msg:z.s}:null,F.e?u:null,x],d),
z.e)u[k]=z.s,F.e=1;F.i=k}if(q>=m)u.msg=p,k=n?u:null,1==b?(t(E,1),E.push(k),x[0]=l(c,E,d),x[1]=k):x.push(k),d.$ntId=setTimeout(function(){d.doNext(x)},30);if(C&&o(g,C))k=g[C].q,delete g[C],l(k,[y,A],a)}},G=0,y;G<a.length;G++)if(y=a[G]){var H;H=e.getModel(y);var A=H.cacheKey;y=H.entity;var M=k(N,y,G);A&&o(g,A)?g[A].q.push(M):H.needUpdate?(j[y.id]=y,A&&(g[A]={q:[],e:y}),y.request(M)):M()}else throw Error("miss attrs:"+a);return d},fetchAll:function(a,c){return this.fetchModels(a,c,1)},saveAll:function(a,
c){a=h(a);return this.fetchModels(a,c,1)},fetchOrder:function(a,c){var b=j.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOrder:function(a,c){var a=h(a),b=j.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOne:function(a,c){var a=h(a),b=j.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,2)},fetchOne:function(a,c){var b=j.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,c=this.$host.$mCacheKeys;
if(a)for(var b in a){var d=a[b],e=d.$mm.cacheKey;if(e&&o(c,e)){var h=c[e];delete c[e];l(h,[!0,d,"aborted"],d)}d.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){this.$doTask=!1;var c=this.$queue;c&&(c=c.shift())&&l(c,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});b(g.prototype,
{registerModels:function(a){var c=this.$mMetas;i.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++){if((d=a[b])&&!d.name)throw Error("model must own a name attribute");c[d.name]=d}},registerMethods:function(a){b(this,a)},createModel:function(a){var c=this.getModelMeta(a),b=new this.$mClass(m(c));b.$mm={used:0};var d=a.before||c.before;this.fireBefore(c.name,[b]);i.isFunction(d)&&l(d,[b,c,a]);b.$mm.after=a.after||c.after;d=a.cacheKey||c.cacheKey;i.isFunction(d)&&(d=l(d,[c,a]));b.$mm.cacheKey=d;b.$mm.meta=
c;b.set(m(a));b.setUrlParams(c.urlParams);b.setPostParams(c.postParams);b.setUrlParams(a.urlParams);b.setPostParams(a.postParams);return b},getModelMeta:function(a){var c=this.$mMetas,b;b=i.isString(a)?a:a.name;c=c[b];if(!c)throw Error("Not found:"+a.name);return c},getModel:function(a){var c=this.getCachedModel(a),b;c||(b=!0,c=this.createModel(a));return{entity:c,cacheKey:c.$mm.cacheKey,needUpdate:b}},saveAll:function(a,c){return(new d(this)).saveAll(a,c)},fetchAll:function(a,c){return(new d(this)).fetchAll(a,
c)},saveOrder:function(a,c){var b=new d(this);return b.saveOrder.apply(b,arguments)},fetchOrder:function(a,c){var b=new d(this);return b.fetchOrder.apply(b,arguments)},saveOne:function(a,c){var b=new d(this);return b.saveOne.apply(b,arguments)},fetchOne:function(a,c){var b=new d(this);return b.fetchOne.apply(b,arguments)},clearCacheByKey:function(a){var c=this.$mCache;i.isString(a)&&c.del(a)},clearCacheByName:function(a){for(var c=this.$mCache,b=c.c,d=0;d<b.length;d++){var e=b[d].v;(e=e&&e.$mm)&&
e.meta.name==a&&c.del(e.cacheKey)}},getModelUrl:function(a){a=this.getModelMeta(a);return a.url?a.url:this.$mClass.prototype.url(a.uri)},listenBefore:function(a,c){p.on.call(this,a+"_before",c)},listenAfter:function(a,c){p.on.call(this,a+"_after",c)},unlistenBefore:function(a,c){p.un.call(this,a+"_before",c)},unlistenAfter:function(a,c){p.un.call(this,a+"_after",c)},fireBefore:function(a,c){p.fire.call(this,a+"_before",c)},fireAfter:function(a,c){p.fire.call(this,a+"_after",c)},getCachedModel:function(a){var c=
this.$mCache,b=null,d,e;i.isString(a)?d=a:(e=this.getModelMeta(a),d=a.cacheKey||e.cacheKey,i.isFunction(d)&&(d=l(d,[e,a])));if(d)if(b=this.$mCacheKeys[d])b=b.e;else if(b=c.get(d)){if(!e)e=b.$mm.meta;c=a.cacheTime||e.cacheTime||0;i.isFunction(c)&&(c=l(c,[e,a]));0<c&&i.now()-b.$mm.doneAt>c&&(this.clearCacheByKey(d),b=null)}return b}});return g},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(i,e){var p=function(b,h,g){for(var j in h)i.isObject(h[j])?(e.has(b,j)||(b[j]={}),p(b[j],h[j],!0)):g&&(b[j]=h[j])},o=function(b){b&&this.set(b);this.id=i.guid("m")},l=encodeURIComponent;e.mix(o,{GET:"GET",POST:"POST",extend:function(b,h){var g=function(){g.superclass.constructor.apply(this,arguments);h&&e.safeExec(h,[],this)};e.mix(g,this,{prototype:!0});p(b,this.prototype);return i.extend(g,this,b)}});e.mix(o.prototype,{urlMap:{},sync:e.noop,parse:function(b){return b},
getPostParams:function(){return this.getParams(o.POST)},getUrlParams:function(){return this.getParams(o.GET)},getParams:function(b){var b=b?b.toUpperCase():o.GET,b=this["$"+b],e=[],g;if(b)for(var j in b)if(g=b[j],i.isArray(g))for(var q=0;q<g.length;q++)e.push(j+"="+l(g[q]));else e.push(j+"="+l(g));return e.join("&")},setUrlParamsIf:function(b,e){this.setParams(b,e,o.GET,!0)},setPostParamsIf:function(b,e){this.setParams(b,e,o.POST,!0)},setParams:function(b,e,g,j){g=g?g.toUpperCase():o.GET;if(!this.$types)this.$types=
{};this.$types[g]=!0;g="$"+g;this[g]||(this[g]={});if(i.isObject(b))for(var l in b){if(!j||!this[g][l])this[g][l]=b[l]}else if(b&&(!j||!this[g][b]))this[g][b]=e},setPostParams:function(b,e){this.setParams(b,e,o.POST)},setUrlParams:function(b,e){this.setParams(b,e,o.GET)},reset:function(){var b=this.$types;if(b){for(var h in b)e.has(b,h)&&delete this["$"+h];delete this.$types}b=this.$keys;h=this.$attrs;if(b){for(var g=0;g<b.length;g++)delete h[b[g]];delete this.$keys}},url:function(b){var e=this.get("url");
if(b=b||this.get("uri")){var e=b.split(":"),g=this.urlMap;if(g){for(var i=0,l=e.length;i<l&&!(g=g[e[i]],!g);i++);b=g||b}e=b}else if(!e)throw Error("model not set uri and url");return e},get:function(b){var e=!arguments.length,g=this.$attrs;return g?e?g:g[b]:null},set:function(b,e,g){if(!this.$attrs)this.$attrs={};if(g&&!this.$keys)this.$keys=[];if(i.isObject(b))for(var j in b)g&&this.$keys.push(j),this.$attrs[j]=b[j];else b&&(g&&this.$keys.push(b),this.$attrs[b]=e)},request:function(b,e){b||(b=function(){});
var g=i.isFunction(b),j=b.success,l=b.error,m=this;m.$abort=!1;var k=function(k,d){if(!m.$abort)if(d)g&&b(k,d,e),l&&l.call(m,d);else{if(k){var a=m.parse(k);i.isObject(a)||(a={data:a});m.set(a,null,!0)}g&&b(k,d,e);j&&j.call(m,k)}};k.success=function(b){k(b)};k.error=function(b){k(null,b||"request error")};m.$trans=m.sync(k,e)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=
i.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return o},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(i,e,p,o){var l=window,b=function(b){l.clearTimeout(b);l.clearInterval(b)},h=function(b){j(b.destroy,[],b)},g=0,j=e.safeExec,q=e.has,m={},k=function(b){if(!k.d)k.d=1,b.on("add",function(a){var a=a.vframe,b=m[a.id];if(b){for(var d=0;d<b.length;d++)t(a,b[d]);delete m[a.id]}}),b.on("remove",function(a){delete m[a.vframe.id]}),b.root().on("created",function(){m={}})},t=function(b,a){var c=b.view;if(c&&b.viewInited)j(c.receiveMessage,a,c);else{var e=function(c){b.un("viewInited",
e);j(c.view.receiveMessage,a,c.view)};b.on("viewInited",e)}};return p.extend({mxViewCtor:e.noop,navigate:function(){o.navigate.apply(o,arguments)},manage:function(d,a){var c=!0;1==arguments.length&&(a=d,d="res_"+g++,c=!1);if(!this.$res)this.$res={};var e;i.isNumber(a)?e=b:a&&a.destroy&&(e=h);this.$res[d]={hasKey:c,res:a,destroy:e};return a},getManaged:function(b){var a=this.$res;return a&&q(a,b)?a[b].res:null},removeManaged:function(b){var a=null,c=this.$res;if(c)if(q(c,b))a=c[b].res,delete c[b];
else for(var e in c)if(c[e].res===b){a=c[e].res;delete c[e];break}return a},destroyManaged:function(b){var a=this.$res;if(a){for(var c in a){var e=a[c],g=e.res,h=e.destroy,i=!1;h&&(h(g),i=!0);e.hasKey||delete a[c];this.fire("destroyManaged",{resource:g,processed:i})}"destroy"==b.type&&delete this.$res}},receiveMessage:e.noop,postMessageTo:function(b,a){var c=this.vom;k(c);e.isArray(b)||(b=[b]);a||(a={});for(var f=0,g;f<b.length;f++){g=b[f];var h=c.get(g);h?t(h,a):(m[g]||(m[g]=[]),m[g].push(a))}},
destroyMRequest:function(){var b=this.$res;if(b)for(var a in b){var c=b[a].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete b[a])}}},function(){var b=this;b.home=e.config().appHome;b.beginUpdateHTML=b.beginUpdate;b.endUpdateHTML=b.endUpdate;b.on("interact",function(){b.on("rendercall",b.destroyMRequest);b.on("prerender",b.destroyManaged);b.on("destroy",b.destroyManaged)});b.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(i){var e=function(){};if(!i.console)i.console={log:e,info:e,error:e};var p,o={};if(!i.Magix)i.Magix={config:function(e){for(var b in e)o[b]=e[b]},start:function(e){p=e}},KISSY.use("magix/magix",function(e,b){i.Magix=b;b.config(o);p&&b.start(p)})})(this);