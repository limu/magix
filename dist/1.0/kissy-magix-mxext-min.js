KISSY.add("magix/body",function(i,h,q){var n=h.has,b=h.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),d=document.body,f={},k={},r=65536,m=function(c,a,e){e?c.setAttribute(a,e):e=c.getAttribute(a);return e},l,o={process:function(c){for(var a=c.target||c.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var e=a,b=c.type,f=k[b]||(k[b]=RegExp("(?:^|,)"+b+"(?:,|$)"));if(!f.test(m(a,"mx-ie"))){for(var s="mx-"+b,t,p,B=[];e&&e!=d&&!(t=m(e,s),p=m(e,"mx-ie"),t||f.test(p));)B.push(e),
e=e.parentNode;if(t){b=m(e,"mx-owner");if(!b){f=e;for(p=l.all();f&&f!=d;)if(n(p,f.id)){m(e,"mx-owner",b=f.id);break}else f=f.parentNode}if(b)(b=(b=l.get(b))&&b.view)&&b.processEvent({info:t,se:c,tId:a.id||(a.id="mx-e-"+r--),cId:e.id||(e.id="mx-e-"+r--)});else throw Error("miss mx-owner:"+t);}else for(;B.length;)c=B.shift(),p=m(c,"mx-ie"),f.test(p)||(p=p?p+","+b:b,m(c,"mx-ie",p))}},on:function(c,a){var e=this;f[c]?f[c]++:(l=a,f[c]=1,b[c]?e.unbubble(0,d,c):d["on"+c]=function(a){(a=a||window.event)&&
e.process(a)})},un:function(c){var a=f[c];0<a&&(a--,a||(b[c]?this.unbubble(1,d,c):d["on"+c]=null),f[c]=a)}};o.unbubble=function(c,a,e){(c?q.undelegate:q.delegate).call(q,a,e,"[mx-"+e+"]",o.process)};return o},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(i,h){var q=h.safeExec;return{fire:function(h,b,d,f){var k="~"+h,i=this[k];if(i){b||(b={});if(!b.type)b.type=h;for(var h=i.length,m=h-1,l,o;h--;){l=f?h:m-h;o=i[l];if(o.d||o.r)i.splice(l,1),m--;o.d||q(o.f,b,this)}}d&&delete this[k]},on:function(i,b,d){i="~"+i;i=this[i]||(this[i]=[]);h.isNumeric(d)?i.splice(d,0,{f:b}):i.push({f:b,r:d})},un:function(h,b){var d="~"+h,f=this[d];if(f)if(b)for(var d=f.length-1,k;0<=d;d--){if(k=f[d],k.f==b&&!k.d){k.d=1;break}}else delete this[d]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(i){var h=[].slice,q=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,n=/\/[^\/]*$/,b=/[#?].*$/,d=/([^=&?\/#]+)=([^&=#?]*)/g,f=/^https?:\/\//i,k={},r=0,m={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},l=k.hasOwnProperty,o=function(a){return function(c,b,j){switch(arguments.length){case 0:j=a;break;case 1:j=p.isObject(c)?g(a,c):e(a,c)?a[c]:null;break;case 2:null===b?(delete a[c],j=b):a[c]=j=b}return j}},c=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new c(a)},e=function(a,c){return a?l.call(a,c):0},g=function(a,c,b){for(var j in c)if(!b||!e(b,j))a[j]=c[j];return a};g(c.prototype,{get:function(a){var c=this.c,b,a="pathname"+a;if(e(c,a)&&(b=c[a],1<=b.f))b.f++,b.t=r++,b=b.v;return b},set:function(a,c){var b=this.c,a="pathname"+a,j=b[a];if(!e(b,a)){if(b.length>=this.b){b.sort(function(a,c){return c.f==a.f?c.t-a.t:c.f-a.f});for(var g=this.b-this.x;g--;)j=b.pop(),delete b[j.k]}j={};b.push(j);b[a]=
j}j.k=a;j.v=c;j.f=1;j.t=r++;return j},del:function(a){var a="pathname"+a,c=this.c,b=c[a];if(b)b.f=-1E5,b.v="",delete c[a]},has:function(a){return e(this.c,"pathname"+a)}});var v=a(60),s=a(),t=function(a,c,b,e,g,d){p.isArray(a)||(a=[a]);if(!c||!p.isArray(c)&&!c.callee)c=[c];for(e=0;e<a.length;e++)try{d=a[e],g=p.isFunction(d)&&d.apply(b,c)}catch(f){}return g},p={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:g,has:e,safeExec:t,noop:function(){},config:o(m),start:function(a){var c=
this,a=g(m,a);c.libEnv(a);c.libRequire(a.iniFile,function(b){m=g(a,b,a);var e=a.progress;c.libRequire(["magix/router","magix/vom"],function(b,g){b.on("!ul",g.locChged);b.on("changed",g.locChged);e&&g.on("progress",e);c.libRequire(a.extensions,b.start)})});a.ready&&(t(a.ready),delete a.ready)},keys:Object.keys||function(a){var c=[],b;for(b in a)e(a,b)&&c.push(b);return c},local:o({}),path:function(a,c){var e=a+"\n"+c,j=s.get(e);if(!j){f.test(c)?j=c:(a=a.replace(b,"").replace(n,"")+"/","/"==c.charAt(0)?
(j=f.test(a)?8:0,j=a.indexOf("/",j),j=a.substring(0,j)+c):j=a+c);for(;q.test(j);)j=j.replace(q,"$1/");s.set(e,j)}return j},pathToObject:function(a,c){var e=v.get(a);if(!e){var e={},j={},g="";b.test(a)?g=a.replace(b,""):~a.indexOf("=")||(g=a);if(g&&f.test(g))var p=g.indexOf("/",8),g=-1==p?"/":g.substring(p);a.replace(d,function(a,b,e){if(c)try{e=decodeURIComponent(e)}catch(g){}j[b]=e});e.pathname=g;e.params=j;v.set(a,e)}return e},objectToPath:function(a,c){var b=a.pathname,e=[],g=a.params,d,f;for(f in g)d=
g[f],c&&encodeURIComponent(d),e.push(f+"="+d);return b+(b&&e.length?"?":"")+e.join("&")},tmpl:function(a,c){return 1==arguments.length?{v:k[a],h:e(k,a)}:k[a]=c},listToMap:function(a,c){var b,e,g={},d;this.isString(a)&&(a=a.split(","));if(a&&(d=a.length))for(b=0;b<d;b++)e=a[b],g[c?e[c]:e]=c?e:1;return g},createCache:a};return g(p,{libRequire:function(a,c){a?i.use(a.toString(),function(a){c&&c.apply(a,h.call(arguments,1))}):c&&c()},libEnv:function(a){var c=a.appHome,b=location,e=a.appName,c=this.path(b.href,
c+"/");a.appHome=c;var g=a.debug;g&&(g=0==c.indexOf(b.protocol+"//"+b.host+"/"));b="";(b=g?i.now():a.appTag)&&(b+=".js");i.config({packages:[{name:e,path:c,debug:a.debug=g,combine:a.appCombine,tag:b}]})},isArray:i.isArray,isFunction:i.isFunction,isObject:i.isObject,isRegExp:i.isRegExp,isString:i.isString,isNumber:i.isNumber})});
KISSY.add("magix/router",function(i,h,q,n){var b=window,d=h.has,f=h.mix,k=document,r=/^UTF-8$/i.test(k.charset||k.characterSet||"UTF-8"),m=h.config(),l=h.createCache(),o=h.createCache(),c,a,e,g=65536,v=/#.*$/,s=/^[^#]*#?!?/,t=m.nativeHistory,p,B,H=function(a,c,b){if(a){b=this.params;h.isArray(a)||(a=a.split(","));for(var e=0;e<a.length&&!(c=d(b,a[e]));e++);}return c},C=function(){return d(this,"pathname")},j=function(){return d(this,"view")},I=function(){return this.hash.pathname!=this.query.pathname},
y=function(a){return this.hash.params[a]!=this.query.params[a]},D=function(a){return d(this.hash.params,a)},E=function(a){return d(this.query.params,a)},F=function(a){return this.params[a]},u=f({getView:function(a){if(!e){e={routes:m.routes||{},e404:m.notFoundView};var c=m.defaultView;if(!c)throw Error("unset defaultView");e.home=c;var b=m.defaultPathname||"";e.routes[b]=c;e.pathname=b}a||(a=e.pathname);c=e.routes;c=h.isFunction(c)?c.call(m,a):c[a];return{view:c?c:e.e404||e.home,pathname:c?a:e.e404?
a:e.pathname}},start:function(){var a=u,c=b.history;p=t&&c.pushState;B=t&&!p;p?a.useState():a.useHash();a.route()},path:function(a){var a=h.pathToObject(a,r),c=a.pathname;c&&B&&(a.pathname=h.path(b.location.pathname,c));return a},parseQH:function(a,c){var a=a||b.location.href,e=u,j=l.get(a);if(!j){var j=a.replace(v,""),g=a.replace(s,""),d=e.path(j),p=e.path(g),h={};f(h,d.params);f(h,p.params);j={pathnameDiff:I,paramDiff:y,hashOwn:D,queryOwn:E,get:F,href:a,srcQuery:j,srcHash:g,query:d,hash:p,params:h};
l.set(a,j)}c&&!j.view&&(e=e.getView(t?j.hash.pathname||j.query.pathname:j.hash.pathname),f(j,e));return j},getChged:function(a,c){var b=c.href,e=a.href+"\n"+b,g=o.get(e);g||(e=b+"\n"+e,g=o.get(e));if(!g){var d,g={params:{}};if(a.pathname!=c.pathname)d=g.pathname=1;if(a.view!=c.view)d=g.view=1;var b=a.params,f=c.params,p;for(p in b)b[p]!=f[p]&&(d=1,g.params[p]=1);for(p in f)b[p]!=f[p]&&(d=1,g.params[p]=1);g.occur=d;g.isParam=H;g.isPathname=C;g.isView=j;o.set(e,g)}return g},route:function(){var b=u,
e=b.parseQH(0,1),j=a||{params:{},href:"~"},g=!a;a=e;j=b.getChged(j,e);j.occur&&(c=e,b.fire("changed",{location:e,changed:j,force:g}))},navigate:function(a,b){var e=u;!b&&h.isObject(a)&&(b=a,a="");b&&(a=h.objectToPath({params:b,pathname:a},r));if(a){var j=e.path(a),s={};s.params=f({},j.params);s.pathname=j.pathname;if(s.pathname){if(B&&(j=c.query)&&(j=j.params))for(var t in j)d(j,t)&&!d(s.params,t)&&(s.params[t]="")}else t=f({},c.params),s.params=f(t,s.params),s.pathname=c.pathname;t=h.objectToPath(s);
if(p?t!=c.srcQuery:t!=c.srcHash)p?(e.poped=1,history.pushState(g--,k.title,t),e.route()):(f(s,c,s),s.srcHash=t,s.hash={params:s.params,pathname:s.pathname},e.fire("!ul",{loc:c=s}),location.hash="#!"+t)}}},q);u.useState=function(){var a=u,c=location.href;n.on(b,"popstate",function(){var b=location.href==c;if(a.poped||!b)a.poped=1,a.route()})};u.useHash=function(){n.on(b,"hashchange",u.route)};return u},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(i,h,q,n){var b=document,d=65536,f=window.CollectGarbage||h.noop,k=h.mix,i=h.config(),r=i.tagName,m=i.rootId,l=h.has,o,c,a=function(a){return"object"==typeof a?a:b.getElementById(a)};b.createElement(r);var e=/<script[^>]*>[\s\S]*?<\/script>/ig,g,v=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};k(v,{root:function(c,e){if(!o){g=e;var d=a(m);if(!d)d=b.createElement(r),d.id=m,b.body.insertBefore(d,b.body.firstChild);o=new v(m);c.add(o)}return o}});
k(k(v.prototype,q),{mountView:function(c,b){var d=this,f=a(d.id);f._bak?f._chgd=1:(f._bak=1,f._tmpl=f.innerHTML.replace(e,""));d.unmountView();if(c){var i=h.pathToObject(c),v=i.pathname,j=--d.sign;h.libRequire(v,function(c){if(j==d.sign){var e=d.owner;n.prepare(c);var s=new c({owner:d,id:d.id,$:a,path:v,vom:e,location:g});d.view=s;s.on("interact",function(a){d.fire("viewInteract",{view:s});d.viewUsable=1;if(!a.tmpl){if(f._chgd)f.innerHTML=f._tmpl;d.mountZoneVframes(0,0,1)}s.on("rendered",function(){d.mountZoneVframes(0,
0,1)});s.on("prerender",function(){d.unmountZoneVframes()})},0);b=b||{};s.load(k(b,i.params,b))}})}},unmountView:function(){if(this.view){c||(c={caused:this.id});this.unmountZoneVframes();this.cAlter(c);this.view.destroy();var b=a(this.id);if(b&&b._bak)b.innerHTML=b._tmpl;delete this.view;delete this.viewUsable;c=0;this.fire("viewUnmounted");f()}this.un("viewInteract");this.sign--},mountVframe:function(a,c,b,e){var g=this.owner,d=g.get(a);if(!d)d=new v(a),d.pId=this.id,l(this.cM,a)||this.cC++,this.cM[a]=
e,g.add(d);d.mountView(c,b);return d},mountZoneVframes:function(c,b,e){this.unmountZoneVframes(c);var c=a(c||this.id).getElementsByTagName(r),g=c.length,f={};if(g)for(var h=0,j,i,k,v;h<g;h++){j=c[h];i=j.id||(j.id="magix_vf_"+d--);l(f,i)||(k=j.getAttribute("mx-view"),v=j.getAttribute("mx-defer"),(!v||k)&&this.mountVframe(i,k,b,e));j=a(j).getElementsByTagName(r);i=0;for(k=j.length;i<k;i++)f[j[i].id||(j[i].id="magix_vf_"+d--)]=1}this.cC==this.rC&&this.cCreated({})},unmountVframe:function(a){var a=a||
this.id,c=this.owner,b=c.get(a);if(b){var e=b.fcc;b.unmountView();c.remove(a,e);if((c=c.get(b.pId))&&l(c.cM,a))delete c.cM[a],c.cC--}},unmountZoneVframes:function(c){if(c){for(var c=a(c).getElementsByTagName(r),b={},e=this.cM,g=c.length-1,d;0<=g;g--)d=c[g].id,l(e,d)&&(b[d]=1);c=b}else c=this.cM;for(var f in c)this.unmountVframe(f)},cCreated:function(a){var c=this.view;if(c&&!this.fcc)this.fcc=1,delete this.fca,c.fire("created",a),this.fire("created",a);var b=this.owner;b.vfCreated();c=this.id;if((b=
b.get(this.pId))&&!l(b.rM,c))b.rM[c]=b.cM[c],b.rC++,b.rC==b.cC&&b.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var c=this.view,b=this.id;if(c)this.fca=1,c.fire("alter",a),this.fire("alter",a);if((c=this.owner.get(this.pId))&&l(c.rM,b)){var e=c.rM[b];c.rC--;delete c.rM[b];e&&c.cAlter(a)}}},locChged:function(a,c){var b=this.view;if(b&&b.sign&&b.rendered){var e=b.olChanged(c),g={location:a,changed:c,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];h.isString(a)&&(a=a.split(","));
this.cs=a}};e&&h.safeExec(b.locationChange,g,b);for(var b=g.cs||h.keys(this.cM),e=0,g=b.length,d=this.owner,j;e<g;e++)(j=d.get(b[e]))&&j.locChged(a,c)}}});return v},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(i,h,q,n,b){var d=h.safeExec,f=h.has,k=[],r=h.config(),m=h.mix,l=h.listToMap("render,renderUI"),o=function(a){return function(){var c;this.sign&&(this.sign++,this.fire("rendercall"),c=a.apply(this,arguments));return c}},c=function(a){m(this,a);this.sign=1};m(c,{wrapAsyn:function(){if(!this["~"]){this["~"]=1;var a=this.prototype,c,b;for(b in l)c=a[b],h.isFunction(c)&&(a[b]=o(c))}}});var a=c.prototype,e=window.CollectGarbage||h.noop,g=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
v=/\smx-owner\s*=/,s=/\smx-[^v][a-z]+\s*=/,t=function(a){return!v.test(a)&&s.test(a)?a+' mx-owner="'+t.t+'"':a},p={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},B=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,H=/(\w+):([^,]+)/g;m(a,q);m(a,{render:h.noop,locationChange:h.noop,init:h.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,c=a.hasTmpl,b=arguments,e=a.sign,g=f(a,"template"),h=function(f){if(e==a.sign){if(!g)a.template=a.wrapMxEvent(f);a.delegateEvents();a.fire("interact",{tmpl:c},1);d(a.init,b,a);d(a.render,k,a);if(!c&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};c&&!g?a.fetchTmpl(h):h()},beginUpdateHTML:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdateHTML:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
e()},wrapMxEvent:function(a){t.t=this.id;return(""+a).replace(g,t)},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=a;this.endUpdateHTML()},observeLocation:function(a){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var b=c.keys;if(h.isObject(a))c.pn=a.pathname,a=a.keys;if(a)c.keys=b.concat(h.isString(a)?a.split(","):a)},olChanged:function(a){var c=this.$ol;if(c){var b=0;c.pn&&(b=a.isPathname());b||(b=a.isParam(c.keys));return b}return 1},destroy:function(){this.fire("refresh",
0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),c=null;if(a&&a.viewUsable)c=a.view;return c},processEvent:function(a){if(this.enableEvent&&this.sign){var c=a.se,b=a.info.match(B),e=b[1],g=b[2],b=b[3],f=this.events;if(f){var h=f[c.type];(g=p[g])&&g(c);if(h&&h[e]){var i={};b&&b.replace(H,function(a,c,b){i[c]=b});d(h[e],m({view:this,currentId:a.cId,targetId:a.tId,domEvent:c,events:f,params:i},p),h)}}}},delegateEvents:function(a){var c=
this.events,a=a?n.un:n.on,b=this.vom,e;for(e in c)a.call(n,e,b)}});var C=function(a,c,b){for(var e in c)i.isObject(c[e])?(f(a,e)||(a[e]={}),C(a[e],c[e],1)):b&&(a[e]=c[e])};c.prototype.fetchTmpl=function(a){var c=this,e=c.template;if(i.isUndefined(e))if(e=h.tmpl(c.path),e.h)a(e.v);else{var g=r.appHome+c.path+".html",f=C[g],e=function(b){a(h.tmpl(c.path,b))};f?f.push(e):(f=C[g]=[e],b({url:g+(r.debug?"?t="+i.now():""),success:function(a){d(f,a);delete C[g]},error:function(a,c){d(f,c);delete C[g]}}))}else a(e)};
c.extend=function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments);c&&d(c,arguments,this)};b.extend=this.extend;return i.extend(b,this,a)};c.prepare=function(a){if(!a.wrapAsyn){a.wrapAsyn=this.wrapAsyn;a.extend=this.extend;for(var c=a.prototype,b=a.superclass;b;)b=b.constructor,C(c,b.prototype),b=b.superclass}a.wrapAsyn()};return c},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(i,h,q,n){var b=q.has,d=q.mix,f=0,k=0,r=0,m=0,l={},o={},c=q.mix({all:function(){return l},add:function(a){if(!b(l,a.id))f++,l[a.id]=a,a.owner=c,c.fire("add",{vframe:a})},get:function(a){return l[a]},remove:function(a,b){var g=l[a];g&&(f--,b&&k--,delete l[a],c.fire("remove",{vframe:g}))},vfCreated:function(){if(!m){k++;var a=k/f;r<a&&c.fire("progress",{percent:r=a},m=1==a)}},root:function(){return h.root(c,o)},locChged:function(a){var b=a.loc,g;b?g=1:b=a.location;d(o,
b);if(!g)g=c.root(),a=a.changed,a.isView()?g.mountView(b.view):g.locChged(b,a)}},n);return c},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(i,h,q){var n=h.has,b=h.safeExec,d=function(c){i.isArray(c)||(c=[c]);for(var a=0,b;a<c.length;a++)b=c[a],delete b.cacheKey;return c},f=function(c){this.$mClass=c;this.$mCache=h.createCache();this.$mCacheKeys={};this.$mMetas={}},k=[].slice,r={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},m=function(c){var a={},b;for(b in c)r[b]||(a[b]=c[b]);return a},l=function(c,a){var b=k.call(arguments,2);return function(){return c.apply(a,b.concat(k.call(arguments)))}};
h.mix(f,{create:function(c){if(!c)throw Error("MManager.create:modelClass ungiven");return new f(c)}});var o=function(c){this.$host=c;this.$doTask=!1;this.$reqModels={}};h.mix(o.prototype,{fetchModels:function(c,a,e){var g=this;if(g.$doTask)return g.next(function(b){b.fetchModels(c,a,e)}),g;g.$doTask=!0;var d=g.$host,f=d.$mCache,h=d.$mCacheKeys,k=g.$reqModels;i.isArray(c)||(c=[c]);var m=c.length,r=0,o,j,q=Array(m),y=[],D={},E=[],F=i.isArray(a);F&&(y=Array(a.length));for(var u=function(c,l,u,w){if(!g.$destroy){r++;
delete k[u.id];var x=u._cacheKey;q[c]=u;if(l)j=!0,o=w||o,D[c]=w;else if(u._doneAt=i.now(),x&&!f.has(x)){f.set(x,u);var A=u._after,z=u._meta;A&&b(A,[u,z]);d.fireAfter(z.name,[u])}if(2==e)(A=F?a[c]:a)&&(y[c]=b(A,[u,l?{msg:w}:null,j?D:null],g));else if(4==e){E[c]={m:u,e:l,s:w};for(c=E.i||0;A=E[c];c++)if(z=F?a[c]:a,y[c]=b(z,[A.m,A.e?{msg:A.s}:null,E.e?D:null,y],g),A.e)D[c]=A.s,E.e=1;E.i=c}x&&n(h,x)&&(c=h[x],delete h[x],b(c,[l,u,w],u));if(r>=m)D.msg=o,l=j?D:null,1==e?(q.push(l),y[0]=b(a,q,g),y[1]=l):y.push(l),
g.$ntId=setTimeout(function(){g.$doTask=!1;g.doNext(y)},30)}},x=0,w;x<c.length;x++)if(w=c[x]){var G;G=d.getModel(w);var z=G.cacheKey;z&&n(h,z)?h[z].push(l(u,g,x)):(w=G.entity,G.needUpdate?(k[w.id]=w,z&&(h[z]=[]),w.request({success:l(u,w,x,!1,w),error:l(u,w,x,!0,w)})):u(x,!1,w))}else throw Error("miss attrs:"+c);return g},fetchAll:function(c,a){return this.fetchModels(c,a,1)},saveAll:function(c,a){c=d(c);return this.fetchModels(c,a,1)},fetchOrder:function(c,a){var b=k.call(arguments,1);return this.fetchModels(c,
1<b.length?b:a,4)},saveOrder:function(c,a){var c=d(c),b=k.call(arguments,1);return this.fetchModels(c,1<b.length?b:a,4)},saveOne:function(c,a){var c=d(c),b=k.call(arguments,1);return this.reqModels(c,1<b.length?b:a,2)},fetchOne:function(c,a){var b=k.call(arguments,1);return this.fetchModels(c,1<b.length?b:a,2)},abort:function(){clearTimeout(this.$ntId);var c=this.$reqModels,a=this.$host.$mCacheKeys;if(c)for(var e in c){var g=c[e],d=g._cacheKey;if(d&&n(a,d)){var f=a[d];delete a[d];b(f,[!0,g,"aborted"],
g)}g.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(c){if(!this.$queue)this.$queue=[];this.$queue.push(c);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(c){var a=this.$queue;a&&(a=a.shift())&&b(a,[this].concat(c),this);this.$latest=c},destroy:function(){this.$destroy=!0;this.abort()}});h.mix(f.prototype,{registerModels:function(c){var a=this.$mMetas;i.isArray(c)||(c=[c]);for(var b=0,g;b<c.length;b++){g=c[b];if(!g.name)throw Error("model must own a name attribute");
a[g.name]=g}},registerMethods:function(c){var a=this,b;for(b in c)a[b]=function(c){return function(){for(var b,e=arguments,d=[],f=0,h;f<e.length;f++)h=e[f],i.isFunction(h)?d.push(function(a){return function(){b||a.apply(a,arguments)}}(h)):d.push(h);var k=c.apply(a,d);return{destroy:function(){b=!0;k&&k.destroy&&k.destroy()}}}}(c[b])},createModel:function(c){var a=this.getModelMeta(c),e=new this.$mClass(m(a)),g=c.before||a.before;this.fireBefore(a.name,[e]);i.isFunction(g)&&b(g,[e,a,c]);e._after=c.after||
a.after;g=c.cacheKey||a.cacheKey;i.isFunction(g)&&(g=b(g,[a,c]));e._cacheKey=g;e._meta=a;e.set(m(c));e.setUrlParams(a.urlParams);e.setPostParams(a.postParams);e.setUrlParams(c.urlParams);e.setPostParams(c.postParams);return e},getModelMeta:function(c){var a=this.$mMetas,b;b=i.isString(c)?c:c.name;a=a[b];if(!a)throw Error("Not found:"+c.name);return a},getModel:function(c){var a=this.getCachedModel(c),b;a||(b=!0,a=this.createModel(c));return{entity:a,cacheKey:a._cacheKey,needUpdate:b}},saveAll:function(c,
a){return(new o(this)).saveAll(c,a)},fetchAll:function(c,a){return(new o(this)).fetchAll(c,a)},saveOrder:function(c,a){var b=new o(this);return b.saveOrder.apply(b,arguments)},fetchOrder:function(c,a){var b=new o(this);return b.fetchOrder.apply(b,arguments)},saveOne:function(c,a){var b=new o(this);return b.saveOne.apply(b,arguments)},fetchOne:function(c,a){var b=new o(this);return b.fetchOne.apply(b,arguments)},clearCacheByKey:function(c){var a=this.$mCache;i.isString(c)&&a.del(c)},clearCacheByName:function(c){for(var a=
this.$mCache,b=a.c,g=0;g<b.length;g++){var d=b[g].v;(d&&d._meta.name)==c&&a.del(d._cacheKey)}},getModelUrl:function(c){return this.$mClass.prototype.url(this.getModelMeta(c).uri)},listenBefore:function(c,a){q.on.call(this,c+"_before",a)},listenAfter:function(c,a){q.on.call(this,c+"_after",a)},unlistenBefore:function(c,a){q.un.call(this,c+"_before",a)},unlistenAfter:function(c,a){q.un.call(this,c+"_after",a)},fireBefore:function(c,a){q.fire.call(this,c+"_before",a)},fireAfter:function(c,a){q.fire.call(this,
c+"_after",a)},getCachedModel:function(c){var a=this.$mCache,e=null,g,d;i.isString(c)?g=c:(d=this.getModelMeta(c),g=c.cacheKey||d.cacheKey,i.isFunction(g)&&(g=b(g,[d,c])));if(g&&(e=a.get(g))){if(!d)d=e._meta;a=c.cacheTime||d.cacheTime||0;i.isFunction(a)&&(a=b(a,[d,c]));0<a&&i.now()-e._doneAt>a&&(this.clearCacheByKey(g),e=null)}return e}});return f},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(i,h){var q=function(b,d,f){for(var k in d)i.isObject(d[k])?(h.has(b,k)||(b[k]={}),q(b[k],d[k],!0)):f&&(b[k]=d[k])},n=function(b){b&&this.set(b);this.id=i.guid("m")};h.mix(n,{GET:"GET",POST:"POST",extend:function(b,d){var f=function(){f.superclass.constructor.apply(this,arguments);d&&h.safeExec(d,[],this)};h.mix(f,this,{prototype:!0});q(b,this.prototype);return i.extend(f,this,b)}});h.mix(n.prototype,{urlMap:{},sync:h.noop,parse:function(b){return b},getParamsObject:function(b){if(!b)b=
n.GET;return this["$"+b]||null},getUrlParamsObject:function(){return this.getParamsObject(n.GET)},getPostParamsObject:function(){return this.getParamsObject(n.POST)},getPostParams:function(){return this.getParams(n.POST)},getUrlParams:function(){return this.getParams(n.GET)},getParams:function(b){var b=b?b.toUpperCase():n.GET,b=this["$"+b],d=[],f;if(b)for(var h in b)if(f=b[h],i.isArray(f))for(var r=0;r<f.length;r++)d.push(h+"="+encodeURIComponent(f[r]));else d.push(h+"="+encodeURIComponent(f));return d.join("&")},
setUrlParamsIf:function(b,d){this.setParams(b,d,n.GET,!0)},setPostParamsIf:function(b,d){this.setParams(b,d,n.POST,!0)},setParams:function(b,d,f,h){f=f?f.toUpperCase():n.GET;if(!this.$types)this.$types={};this.$types[f]=!0;f="$"+f;this[f]||(this[f]={});if(i.isObject(b))for(var r in b){if(!h||!this[f][r])this[f][r]=b[r]}else if(b&&(!h||!this[f][b]))this[f][b]=d},setPostParams:function(b,d){this.setParams(b,d,n.POST)},setUrlParams:function(b,d){this.setParams(b,d,n.GET)},removeParamsObject:function(b){if(!b)b=
n.GET;delete this["$"+b]},removePostParamsObject:function(){this.removeParamsObject(n.POST)},removeUrlParamsObject:function(){this.removeParamsObject(n.GET)},reset:function(){var b=this.$types;if(b){for(var d in b)h.has(b,d)&&delete this["$"+d];delete this.$types}b=this.$keys;d=this.$attrs;if(b){for(var f=0;f<b.length;f++)delete d[b[f]];delete this.$keys}},url:function(b){var b=b||this.get("uri"),d;if(b){d=b.split(":");var f=this.urlMap;if(f){for(var h=0,i=d.length;h<i&&!(f=f[d[h]],!f);h++);b=f||
b}}else throw Error("model not set uri");return b},get:function(b){var d=this.$attrs;return d?d[b]:null},set:function(b,d,f){if(!this.$attrs)this.$attrs={};if(f&&!this.$keys)this.$keys=[];if(i.isObject(b))for(var h in b)f&&this.$keys.push(h),this.$attrs[h]=b[h];else b&&(f&&this.$keys.push(b),this.$attrs[b]=d)},load:function(b){this.request(b)},save:function(b){this.request(b)},request:function(b){b||(b={});var d=b.success,f=b.error,h=this;h.$abort=!1;b.success=function(b){if(!h.$abort){if(b){var f=
h.parse(b);i.isObject(f)||(f={data:f});h.set(f,null,!0)}d&&d.apply(this,arguments)}};b.error=function(){h.$abort||f&&f.apply(this,arguments)};h.$trans=h.sync(b)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return n},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(i,h,q,n){var b=window,d=function(a){b.clearTimeout(a);b.clearInterval(a)},f=function(a){r(a.destroy,[],a)},k=0,r=h.safeExec,m=h.has,l={},o=function(a){if(!o.d)o.d=1,a.on("add",function(a){var a=a.vframe,b=l[a.id];if(b){for(var d=0;d<b.length;d++)c(a,b[d]);delete l[a.id]}}),a.on("remove",function(a){delete l[a.vframe.id]}),a.root().on("created",function(){l={}})},c=function(a,b){var c=a.view;if(c&&a.viewUsable)r(c.receiveMessage,b,c);else{var d=function(c){a.un("viewInteract",
d);r(c.view.receiveMessage,b,c.view)};a.on("viewInteract",d)}};return q.extend({mxViewCtor:h.noop,navigate:function(){n.navigate.apply(n,arguments)},manage:function(a,b){var c=!0;1==arguments.length&&(b=a,a="res_"+k++,c=!1);if(!this.$res)this.$res={};var h;i.isNumber(b)?h=d:b&&b.destroy&&(h=f);this.$res[a]={hasKey:c,res:b,destroy:h};return b},getManaged:function(a){var b=this.$res;return b&&m(b,a)?b[a].res:null},removeManaged:function(a){var b=null,c=this.$res;if(c)if(m(c,a))b=c[a].res,delete c[a];
else for(var d in c)if(c[d].res===a){b=c[d].res;delete c[d];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var d=b[c],f=d.res,h=d.destroy,i=!1;h&&(h(f),i=!0);d.hasKey||delete b[c];this.fire("destroyManaged",{resource:f,processed:i})}"destroy"==a.type&&delete this.$res}},receiveMessage:h.noop,postMessageTo:function(a,b){var d=this.vom;o(d);h.isArray(a)||(a=[a]);b||(b={});for(var f=0,i;f<a.length;f++){i=a[f];var k=d.get(i);k?c(k,b):(l[i]||(l[i]=[]),l[i].push(b))}},
destroyMRequest:function(){var a=this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",a.destroyMRequest);a.on("prerender",a.destroyManaged);a.on("destroy",a.destroyManaged)});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(i){var h=function(){};if(!i.console)i.console={log:h,info:h,error:h};var q,n={};if(!i.Magix)i.Magix={config:function(b){for(var d in b)n[d]=b[d]},start:function(b){q=b}},KISSY.use("magix/magix",function(b,d){i.Magix=d;d.config(n);q&&d.start(q)})})(this);