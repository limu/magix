KISSY.add("magix/body",function(h,f,p){var n=f.has,c=f.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),g=document.body,e={},k={},q=65536,m=function(b,a,d){d?b.setAttribute(a,d):d=b.getAttribute(a);return d},l,o={process:function(b){for(var a=b.target||b.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var d=a,c=b.type,e=k[c]||(k[c]=RegExp("(?:^|,)"+c+"(?:,|$)"));if(!e.test(m(a,"mx-ie"))){for(var u="mx-"+c,f,s,A=[];d&&d!=g&&!(f=m(d,u),s=m(d,"mx-ie"),f||e.test(s));)A.push(d),
d=d.parentNode;if(f){c=m(d,"mx-owner");if(!c){e=d;for(s=l.all();e&&e!=g;)if(n(s,e.id)){m(d,"mx-owner",c=e.id);break}else e=e.parentNode}if(c)(c=(c=l.get(c))&&c.view)&&c.processEvent({info:f,se:b,tId:a.id||(a.id="mx-e-"+q--),cId:d.id||(d.id="mx-e-"+q--)});else throw Error("miss mx-owner:"+f);}else for(;A.length;)b=A.shift(),s=m(b,"mx-ie"),e.test(s)||(s=s?s+","+c:c,m(b,"mx-ie",s))}},on:function(b,a){var d=this;e[b]?e[b]++:(l=a,e[b]=1,c[b]?d.unbubble(0,g,b):g["on"+b]=function(a){(a=a||window.event)&&
d.process(a)})},un:function(b){var a=e[b];0<a&&(a--,a||(c[b]?this.unbubble(1,g,b):g["on"+b]=null),e[b]=a)}};o.unbubble=function(b,a,d){(b?p.undelegate:p.delegate).call(p,a,d,"[mx-"+d+"]",o.process)};return o},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(h,f){var p=f.safeExec;return{fire:function(f,c,g,e){var k="~"+f,h=this[k];if(h){c||(c={});if(!c.type)c.type=f;for(var f=h.length,m=f-1,l,o;f--;){l=e?f:m-f;o=h[l];if(o.d||o.r)h.splice(l,1),m--;o.d||p(o.f,c,this)}}g&&delete this[k]},on:function(h,c,g){h="~"+h;h=this[h]||(this[h]=[]);f.isNumeric(g)?h.splice(g,0,{f:c}):h.push({f:c,r:g})},un:function(f,c){var g="~"+f,e=this[g];if(e)if(c)for(var g=e.length-1,k;0<=g;g--){if(k=e[g],k.f==c&&!k.d){k.d=1;break}}else delete this[g]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(h){var f=[].slice,p=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,n=/\/[^\/]*$/,c=/[#?].*$/,g=/([^=&?\/#]+)=([^&=#?]*)/g,e=/^https?:\/\//i,k={},q=0,m={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},l=k.hasOwnProperty,o=function(a){return function(b,c,e){switch(arguments.length){case 0:e=a;break;case 1:e=s.isObject(b)?i(a,b):d(a,b)?a[b]:null;break;case 2:null===c?(delete a[b],e=c):a[b]=e=c}return e}},b=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new b(a)},d=function(a,b){return a?l.call(a,b):0},i=function(a,b,c){for(var e in b)if(!c||!d(c,e))a[e]=b[e];return a};i(b.prototype,{get:function(a){var b=this.c,c,a="pathname"+a;if(d(b,a)&&(c=b[a],1<=c.f))c.f++,c.t=q++,c=c.v;return c},set:function(a,b){var c=this.c,a="pathname"+a,e=c[a];if(!d(c,a)){if(c.length>=this.b){c.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var j=this.b-this.x;j--;)e=c.pop(),delete c[e.k]}e={};c.push(e);c[a]=
e}e.k=a;e.v=b;e.f=1;e.t=q++;return e},del:function(a){var a="pathname"+a,b=this.c,c=b[a];if(c)c.f=-1E5,c.v="",delete b[a]},has:function(a){return d(this.c,"pathname"+a)}});var x=a(60),u=a(),B=function(a,b,c,d,j,e){s.isArray(a)||(a=[a]);if(!b||!s.isArray(b)&&!b.callee)b=[b];for(d=0;d<a.length;d++)try{e=a[d],j=s.isFunction(e)&&e.apply(c,b)}catch(i){}return j},s={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:i,has:d,safeExec:B,noop:function(){},config:o(m),start:function(a){var b=
this,a=i(m,a);b.libEnv(a);b.libRequire(a.iniFile,function(c){m=i(a,c,a);var d=a.progress;b.libRequire(["magix/router","magix/vom"],function(c,e){c.on("!ul",e.locChged);c.on("changed",e.locChged);d&&e.on("progress",d);b.libRequire(a.extensions,c.start)})});a.ready&&(B(a.ready),delete a.ready)},keys:Object.keys||function(a){var b=[],c;for(c in a)d(a,c)&&b.push(c);return b},local:o({}),path:function(a,b){var d=a+"\n"+b,i=u.get(d);if(!i){e.test(b)?i=b:(a=a.replace(c,"").replace(n,"")+"/","/"==b.charAt(0)?
(i=e.test(a)?8:0,i=a.indexOf("/",i),i=a.substring(0,i)+b):i=a+b);for(;p.test(i);)i=i.replace(p,"$1/");u.set(d,i)}return i},pathToObject:function(a,b){var d=x.get(a);if(!d){var d={},i={},j="";c.test(a)?j=a.replace(c,""):~a.indexOf("=")||(j=a);if(j&&e.test(j))var s=j.indexOf("/",8),j=-1==s?"/":j.substring(s);a.replace(g,function(a,c,d){if(b)try{d=decodeURIComponent(d)}catch(j){}i[c]=d});d.pathname=j;d.params=i;x.set(a,d)}return d},objectToPath:function(a,b){var c=a.pathname,d=[],j=a.params,e,i;for(i in j)e=
j[i],b&&encodeURIComponent(e),d.push(i+"="+e);return c+(c&&d.length?"?":"")+d.join("&")},tmpl:function(a,b){return 1==arguments.length?{v:k[a],h:d(k,a)}:k[a]=b},listToMap:function(a,b){var c,d,j={},e;this.isString(a)&&(a=a.split(","));if(a&&(e=a.length))for(c=0;c<e;c++)d=a[c],j[b?d[b]:d]=b?d:1;return j},cache:a};return i(s,{libRequire:function(a,b){a?h.use(a.toString(),function(a){b&&b.apply(a,f.call(arguments,1))}):b&&b()},libEnv:function(a){var b=a.appHome,c=location,d=a.appName,b=this.path(c.href,
b+"/");a.appHome=b;var j=a.debug;j&&(j=0==b.indexOf(c.protocol+"//"+c.host+"/"));c="";(c=j?h.now():a.appTag)&&(c+=".js");h.config({packages:[{name:d,path:b,debug:a.debug=j,combine:a.appCombine,tag:c}]})},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber})});
KISSY.add("magix/router",function(h,f,p,n){var c=window,g=f.has,e=f.mix,k=document,q=/^UTF-8$/i.test(k.charset||k.characterSet||"UTF-8"),m=f.config(),l=f.cache(),o=f.cache(),b,a,d,i=65536,x=/#.*$/,u=/^[^#]*#?!?/,B=m.nativeHistory,s,A,I=function(a,b,c){if(a){c=this.params;f.isArray(a)||(a=a.split(","));for(var d=0;d<a.length&&!(b=g(c,a[d]));d++);}return b},J=function(){return g(this,"pathname")},z=function(){return g(this,"view")},j=function(){return this.hash.pathname!=this.query.pathname},t=function(a){return this.hash.params[a]!=
this.query.params[a]},C=function(a){return g(this.hash.params,a)},D=function(a){return g(this.query.params,a)},F=function(a){return this.params[a]},w=function(a){var a=f.pathToObject(a,q),b=a.pathname;b&&A&&(a.pathname=f.path(c.location.pathname,b));return a},r=e({getView:function(a){if(!d){d={rs:m.routes||{},nf:m.notFoundView};var b=m.defaultView;if(!b)throw Error("unset defaultView");d.home=b;var c=m.defaultPathname||"";d.rs[c]=b;d.pathname=c}a||(a=d.pathname);b=d.rs;b=f.isFunction(b)?b.call(m,
a):b[a];return{view:b?b:d.nf||d.home,pathname:b?a:d.nf?a:d.pathname}},start:function(){var a=r,b=c.history;s=B&&b.pushState;A=B&&!s;s?a.useState():a.useHash();a.route()},parseQH:function(a){var a=a||c.location.href,b=r,d=l.get(a);if(!d){var d=a.replace(x,""),i=a.replace(u,""),g=w(d),s=w(i),f={};e(f,g.params);e(f,s.params);d={pathnameDiff:j,paramDiff:t,hashOwn:C,queryOwn:D,get:F,href:a,srcQuery:d,srcHash:i,query:g,hash:s,params:f};l.set(a,d)}d.view||(a=b.getView(B?d.hash.pathname||d.query.pathname:
d.hash.pathname),e(d,a));return d},getChged:function(a,b){var d=b.href,c=a.href+"\n"+d,j=o.get(c);j||(c=d+"\n"+c,j=o.get(c));if(!j){var e,j={params:{}};if(a.pathname!=b.pathname)e=j.pathname=1;if(a.view!=b.view)e=j.view=1;var d=a.params,i=b.params,g;for(g in d)d[g]!=i[g]&&(e=1,j.params[g]=1);for(g in i)d[g]!=i[g]&&(e=1,j.params[g]=1);j.occur=e;j.isParam=I;j.isPathname=J;j.isView=z;o.set(c,j)}return j},route:function(){var d=r,c=d.parseQH(),j=a||{params:{},href:"~"},e=!a;a=c;j=d.getChged(j,c);j.occur&&
(b=c,d.fire("changed",{location:c,changed:j,force:e}))},navigate:function(a,d){var c=r;!d&&f.isObject(a)&&(d=a,a="");d&&(a=f.objectToPath({params:d,pathname:a},q));if(a){var j=w(a),u={};u.params=e({},j.params);u.pathname=j.pathname;if(u.pathname){if(A&&(j=b.query)&&(j=j.params))for(var t in j)g(j,t)&&!g(u.params,t)&&(u.params[t]="")}else t=e({},b.params),u.params=e(t,u.params),u.pathname=b.pathname;t=f.objectToPath(u);if(s?t!=b.srcQuery:t!=b.srcHash)s?(c.poped=1,history.pushState(i--,k.title,t),c.route()):
(e(u,b,u),u.srcHash=t,u.hash={params:u.params,pathname:u.pathname},c.fire("!ul",{loc:b=u}),location.hash="#!"+t)}}},p);r.useState=function(){var a=r,b=location.href;n.on(c,"popstate",function(){var d=location.href==b;if(a.poped||!d)a.poped=1,a.route()})};r.useHash=function(){n.on(c,"hashchange",r.route)};return r},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(h,f,p,n){var c=document,g=65536,e=window.CollectGarbage||f.noop,k=f.mix,h=f.config(),q=h.tagName,m=h.rootId,l=f.has,o,b,a=function(a){return"object"==typeof a?a:c.getElementById(a)};c.createElement(q);var d=/<script[^>]*>[\s\S]*?<\/script>/ig,i,x=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};k(x,{root:function(b,d){if(!o){i=d;var e=a(m);if(!e)e=c.createElement(q),e.id=m,c.body.insertBefore(e,c.body.firstChild);o=new x(m);b.add(o)}return o}});
k(k(x.prototype,p),{mountView:function(b,c){var e=this,g=a(e.id);g._bak?g._chgd=1:(g._bak=1,g._tmpl=g.innerHTML.replace(d,""));e.unmountView();if(b){var h=f.pathToObject(b),x=h.pathname,m=--e.sign;f.libRequire(x,function(b){if(m==e.sign){var d=e.owner;n.prepare(b);var f=new b({owner:e,id:e.id,$:a,path:x,vom:d,location:i});e.view=f;f.on("interact",function(a){if(!a.tmpl){if(g._chgd)g.innerHTML=g._tmpl;e.mountZoneVframes(0,0,1)}f.on("rendered",function(){e.mountZoneVframes(0,0,1)});f.on("prerender",
function(){e.unmountZoneVframes()});f.on("inited",function(){e.viewInited=1;e.fire("viewInited",{view:f})})},0);c=c||{};f.load(k(c,h.params,c))}})}},unmountView:function(){if(this.view){b||(b={caused:this.id});this.unmountZoneVframes();this.cAlter(b);this.view.destroy();var d=a(this.id);if(d&&d._bak)d.innerHTML=d._tmpl;delete this.view;delete this.viewInited;b=0;this.fire("viewUnmounted");e()}this.un("viewInited");this.sign--},mountVframe:function(a,b,d,c){var e=this.owner,i=e.get(a);if(!i)i=new x(a),
i.pId=this.id,l(this.cM,a)||this.cC++,this.cM[a]=c,e.add(i);i.mountView(b,d);return i},mountZoneVframes:function(b,d,c){this.unmountZoneVframes(b);var b=a(b||this.id).getElementsByTagName(q),e=b.length,i={};if(e)for(var f=0,h,j,t,k;f<e;f++){h=b[f];j=h.id||(h.id="magix_vf_"+g--);l(i,j)||(t=h.getAttribute("mx-view"),k=h.getAttribute("mx-defer"),(!k||t)&&this.mountVframe(j,t,d,c));h=a(h).getElementsByTagName(q);j=0;for(t=h.length;j<t;j++)i[h[j].id||(h[j].id="magix_vf_"+g--)]=1}this.cC==this.rC&&this.cCreated({})},
unmountVframe:function(a){var a=a||this.id,b=this.owner,d=b.get(a);if(d){var c=d.fcc;d.unmountView();b.remove(a,c);if((b=b.get(d.pId))&&l(b.cM,a))delete b.cM[a],b.cC--}},unmountZoneVframes:function(b){if(b){for(var b=a(b).getElementsByTagName(q),d={},c=this.cM,e=b.length-1,i;0<=e;e--)i=b[e].id,l(c,i)&&(d[i]=1);b=d}else b=this.cM;for(var g in b)this.unmountVframe(g)},cCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;
d.vfCreated();b=this.id;if((d=d.get(this.pId))&&!l(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var b=this.view,d=this.id;if(b)this.fca=1,b.fire("alter",a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&l(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.cAlter(a)}}},locChged:function(a,b){var d=this.view;if(d&&d.sign&&d.rendered){var c=d.olChanged(b),e={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=
a||[];f.isString(a)&&(a=a.split(","));this.cs=a}};c&&f.safeExec(d.locationChange,e,d);for(var d=e.cs||f.keys(this.cM),c=0,e=d.length,i=this.owner,g;c<e;c++)(g=i.get(d[c]))&&g.locChged(a,b)}}});return x},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(h,f,p,n,c){var g=f.safeExec,e=f.has,k=[],q=f.config(),m=f.mix,l=["render","renderUI"],o=function(a){return function(){var b;this.notifyUpdate()&&(b=a.apply(this,arguments));return b}},b=f.cache(40),a=function(a){m(this,a);this.sign=1};m(a,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,b,d=l.length-1;-1<d;d--)b=a[l[d]],f.isFunction(b)&&b!=f.noop&&(a[d]=o(b))}}});var d=a.prototype,i=window.CollectGarbage||f.noop,x=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
u=/\smx-owner\s*=/,B=/\smx-[^v][a-z]+\s*=/,s=function(a){return!u.test(a)&&B.test(a)?a+' mx-owner="'+s.t+'"':a},A={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},I=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,J=/(\w+):([^,]+)/g;m(d,p);m(d,{render:f.noop,locationChange:f.noop,init:f.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,b=a.hasTmpl,d=arguments,c=a.sign,i=e(a,"template"),f=function(e){if(c==a.sign){if(!i)a.template=a.wrapMxEvent(e);a.delegateEvents();a.fire("interact",{tmpl:b},1);g(a.init,d,a);a.fire("inited",0,1);g(a.render,k,a);if(!b&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};b&&!i?a.fetchTmpl(f):f()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
i()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){s.t=this.id;return(""+a).replace(x,s)},setViewHTML:function(a){var b;this.beginUpdate();if(this.sign&&(b=this.$(this.id)))b.innerHTML=a;this.endUpdate()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(f.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat(f.isString(a)?a.split(","):a)},olChanged:function(a){var b=this.$ol;if(b){var d=
0;b.pn&&(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),b=null;if(a&&a.viewInited)b=a.view;return b},processEvent:function(a){if(this.enableEvent&&this.sign){var d=a.info,c=a.se,e=b.get(d);e||(e=d.match(I),e={n:e[1],f:e[2],i:e[3],p:{}},e.i&&e.i.replace(J,function(a,b,d){e.p[b]=d}),b.set(d,e));if(d=this.events){var i=d[c.type],
f=A[e.f];f&&f.call(A,c);(f=i&&i[e.n])&&g(f,m({view:this,currentId:a.cId,targetId:a.tId,domEvent:c,events:d,params:e.p},A),i)}}},delegateEvents:function(a){var b=this.events,a=a?n.un:n.on,d=this.vom,c;for(c in b)a.call(n,c,d)}});var z=function(a,b,d){for(var c in b)h.isObject(b[c])?(e(a,c)||(a[c]={}),z(a[c],b[c],1)):d&&(a[c]=b[c])};a.prototype.fetchTmpl=function(a){var b=this,d=b.template;if(h.isUndefined(d))if(d=f.tmpl(b.path),d.h)a(d.v);else{var e=q.appHome+b.path+".html",i=z[e],d=function(d){a(f.tmpl(b.path,
d))};i?i.push(d):(i=z[e]=[d],c({url:e+(q.debug?"?t="+h.now():""),success:function(a){g(i,a);delete z[e]},error:function(a,b){g(i,b);delete z[e]}}))}else a(d)};a.extend=function(a,b){var d=function(){d.superclass.constructor.apply(this,arguments);b&&g(b,arguments,this)};d.extend=this.extend;return h.extend(d,this,a)};a.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var b=a.prototype,d=a.superclass;d;)d=d.constructor,z(b,d.prototype),d=d.superclass}a.wrapUpdate()};
return a},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(h,f,p,n){var c=p.has,g=p.mix,e=0,k=0,q=0,m=0,l={},o={},b=p.mix({all:function(){return l},add:function(a){if(!c(l,a.id))e++,l[a.id]=a,a.owner=b,b.fire("add",{vframe:a})},get:function(a){return l[a]},remove:function(a,d){var c=l[a];c&&(e--,d&&k--,delete l[a],b.fire("remove",{vframe:c}))},vfCreated:function(){if(!m){k++;var a=k/e;q<a&&b.fire("progress",{percent:q=a},m=1==a)}},root:function(){return f.root(b,o)},locChged:function(a){var d=a.loc,c;d?c=1:d=a.location;g(o,
d);if(!c)c=b.root(),a=a.changed,a.isView()?c.mountView(d.view):c.locChged(d,a)}},n);return b},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(h,f,p){var n=f.has,c=f.safeExec,g=function(b){h.isArray(b)||(b=[b]);for(var a=0,d;a<b.length;a++)d=b[a],delete d.cacheKey;return b},e=function(b){this.$mClass=b;this.$mCache=f.cache();this.$mCacheKeys={};this.$mMetas={}},k=[].slice,q={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},m=function(b){var a={},d;for(d in b)q[d]||(a[d]=b[d]);return a},l=function(b,a){var d=k.call(arguments,2);return function(){return b.apply(a,d.concat(k.call(arguments)))}};
f.mix(e,{create:function(b){if(!b)throw Error("MManager.create:modelClass ungiven");return new e(b)}});var o=function(b){this.$host=b;this.$doTask=!1;this.$reqModels={}};f.mix(o.prototype,{fetchModels:function(b,a,d){var e=this;if(e.$doTask)return e.next(function(c){c.fetchModels(b,a,d)}),e;e.$doTask=!0;var g=e.$host,f=g.$mCache,k=g.$mCacheKeys,m=e.$reqModels;h.isArray(b)||(b=[b]);var q=b.length,o=0,p,z,j=Array(q),t=[],C={},D=[],F=h.isArray(a);F&&(t=Array(a.length));for(var w=function(b,l,r,v){if(!e.$destroy){o++;
delete m[r.id];var w=r._cacheKey;j[b]=r;if(l)z=!0,p=v||p,C[b]=v;else if(r._doneAt=h.now(),w){if(!f.has(w)){f.set(w,r);var y=r._after,E=r._meta;y&&c(y,[r,E]);g.fireAfter(E.name,[r])}}else y=r._after,E=r._meta,y&&c(y,[r,E]),g.fireAfter(E.name,[r]);if(2==d)(y=F?a[b]:a)&&(t[b]=c(y,[r,l?{msg:v}:null,z?C:null],e));else if(4==d){D[b]={m:r,e:l,s:v};for(b=D.i||0;y=D[b];b++)if(E=F?a[b]:a,t[b]=c(E,[y.m,y.e?{msg:y.s}:null,D.e?C:null,t],e),y.e)C[b]=y.s,D.e=1;D.i=b}w&&n(k,w)&&(b=k[w],delete k[w],c(b,[l,r,v],r));
if(o>=q)C.msg=p,l=z?C:null,1==d?(j.push(l),t[0]=c(a,j,e),t[1]=l):t.push(l),e.$ntId=setTimeout(function(){e.$doTask=!1;e.doNext(t)},30)}},r=0,v;r<b.length;r++)if(v=b[r]){var H;H=g.getModel(v);var G=H.cacheKey;G&&n(k,G)?k[G].push(l(w,e,r)):(v=H.entity,H.needUpdate?(m[v.id]=v,G&&(k[G]=[]),v.request({success:l(w,v,r,!1,v),error:l(w,v,r,!0,v)})):w(r,!1,v))}else throw Error("miss attrs:"+b);return e},fetchAll:function(b,a){return this.fetchModels(b,a,1)},saveAll:function(b,a){b=g(b);return this.fetchModels(b,
a,1)},fetchOrder:function(b,a){var d=k.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,4)},saveOrder:function(b,a){var b=g(b),d=k.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,4)},saveOne:function(b,a){var b=g(b),d=k.call(arguments,1);return this.reqModels(b,1<d.length?d:a,2)},fetchOne:function(b,a){var d=k.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,2)},abort:function(){clearTimeout(this.$ntId);var b=this.$reqModels,a=this.$host.$mCacheKeys;if(b)for(var d in b){var e=
b[d],g=e._cacheKey;if(g&&n(a,g)){var f=a[g];delete a[g];c(f,[!0,e,"aborted"],e)}e.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(b){if(!this.$queue)this.$queue=[];this.$queue.push(b);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(b){var a=this.$queue;a&&(a=a.shift())&&c(a,[this].concat(b),this);this.$latest=b},destroy:function(){this.$destroy=!0;this.abort()}});f.mix(e.prototype,{registerModels:function(b){var a=this.$mMetas;
h.isArray(b)||(b=[b]);for(var d=0,c;d<b.length;d++){if((c=b[d])&&!c.name)throw Error("model must own a name attribute");a[c.name]=c}},registerMethods:function(b){var a=this,d;for(d in b)a[d]=function(b){return function(){for(var d,c=arguments,e=[],g=0,f;g<c.length;g++)f=c[g],h.isFunction(f)?e.push(function(a){return function(){d||a.apply(a,arguments)}}(f)):e.push(f);var k=b.apply(a,e);return{destroy:function(){d=!0;k&&k.destroy&&k.destroy()}}}}(b[d])},createModel:function(b){var a=this.getModelMeta(b),
d=new this.$mClass(m(a)),e=b.before||a.before;this.fireBefore(a.name,[d]);h.isFunction(e)&&c(e,[d,a,b]);d._after=b.after||a.after;e=b.cacheKey||a.cacheKey;h.isFunction(e)&&(e=c(e,[a,b]));d._cacheKey=e;d._meta=a;d.set(m(b));d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);return d},getModelMeta:function(b){var a=this.$mMetas,d;d=h.isString(b)?b:b.name;a=a[d];if(!a)throw Error("Not found:"+b.name);return a},getModel:function(b){var a=
this.getCachedModel(b),d;a||(d=!0,a=this.createModel(b));return{entity:a,cacheKey:a._cacheKey,needUpdate:d}},saveAll:function(b,a){return(new o(this)).saveAll(b,a)},fetchAll:function(b,a){return(new o(this)).fetchAll(b,a)},saveOrder:function(b,a){var d=new o(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(b,a){var d=new o(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(b,a){var d=new o(this);return d.saveOne.apply(d,arguments)},fetchOne:function(b,a){var d=new o(this);
return d.fetchOne.apply(d,arguments)},clearCacheByKey:function(b){var a=this.$mCache;h.isString(b)&&a.del(b)},clearCacheByName:function(b){for(var a=this.$mCache,d=a.c,c=0;c<d.length;c++){var e=d[c].v;(e&&e._meta.name)==b&&a.del(e._cacheKey)}},getModelUrl:function(b){b=this.getModelMeta(b);return b.url?b.url:this.$mClass.prototype.url(b.uri)},listenBefore:function(b,a){p.on.call(this,b+"_before",a)},listenAfter:function(b,a){p.on.call(this,b+"_after",a)},unlistenBefore:function(b,a){p.un.call(this,
b+"_before",a)},unlistenAfter:function(b,a){p.un.call(this,b+"_after",a)},fireBefore:function(b,a){p.fire.call(this,b+"_before",a)},fireAfter:function(b,a){p.fire.call(this,b+"_after",a)},getCachedModel:function(b){var a=this.$mCache,d=null,e,g;h.isString(b)?e=b:(g=this.getModelMeta(b),e=b.cacheKey||g.cacheKey,h.isFunction(e)&&(e=c(e,[g,b])));if(e&&(d=a.get(e))){if(!g)g=d._meta;a=b.cacheTime||g.cacheTime||0;h.isFunction(a)&&(a=c(a,[g,b]));0<a&&h.now()-d._doneAt>a&&(this.clearCacheByKey(e),d=null)}return d}});
return e},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(h,f){var p=function(c,g,e){for(var k in g)h.isObject(g[k])?(f.has(c,k)||(c[k]={}),p(c[k],g[k],!0)):e&&(c[k]=g[k])},n=function(c){c&&this.set(c);this.id=h.guid("m")};f.mix(n,{GET:"GET",POST:"POST",extend:function(c,g){var e=function(){e.superclass.constructor.apply(this,arguments);g&&f.safeExec(g,[],this)};f.mix(e,this,{prototype:!0});p(c,this.prototype);return h.extend(e,this,c)}});f.mix(n.prototype,{urlMap:{},sync:f.noop,parse:function(c){return c},getParamsObject:function(c){if(!c)c=
n.GET;return this["$"+c]||null},getUrlParamsObject:function(){return this.getParamsObject(n.GET)},getPostParamsObject:function(){return this.getParamsObject(n.POST)},getPostParams:function(){return this.getParams(n.POST)},getUrlParams:function(){return this.getParams(n.GET)},getParams:function(c){var c=c?c.toUpperCase():n.GET,c=this["$"+c],g=[],e;if(c)for(var f in c)if(e=c[f],h.isArray(e))for(var q=0;q<e.length;q++)g.push(f+"="+encodeURIComponent(e[q]));else g.push(f+"="+encodeURIComponent(e));return g.join("&")},
setUrlParamsIf:function(c,g){this.setParams(c,g,n.GET,!0)},setPostParamsIf:function(c,g){this.setParams(c,g,n.POST,!0)},setParams:function(c,g,e,f){e=e?e.toUpperCase():n.GET;if(!this.$types)this.$types={};this.$types[e]=!0;e="$"+e;this[e]||(this[e]={});if(h.isObject(c))for(var q in c){if(!f||!this[e][q])this[e][q]=c[q]}else if(c&&(!f||!this[e][c]))this[e][c]=g},setPostParams:function(c,g){this.setParams(c,g,n.POST)},setUrlParams:function(c,g){this.setParams(c,g,n.GET)},removeParamsObject:function(c){if(!c)c=
n.GET;delete this["$"+c]},removePostParamsObject:function(){this.removeParamsObject(n.POST)},removeUrlParamsObject:function(){this.removeParamsObject(n.GET)},reset:function(){var c=this.$types;if(c){for(var g in c)f.has(c,g)&&delete this["$"+g];delete this.$types}c=this.$keys;g=this.$attrs;if(c){for(var e=0;e<c.length;e++)delete g[c[e]];delete this.$keys}},url:function(c){var g=this.get("url");if(c=c||this.get("uri")){var g=c.split(":"),e=this.urlMap;if(e){for(var f=0,h=g.length;f<h&&!(e=e[g[f]],
!e);f++);c=e||c}g=c}else if(!g)throw Error("model not set uri and url");return g},get:function(c){var g=!arguments.length,e=this.$attrs;return e?g?e:e[c]:null},set:function(c,g,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(h.isObject(c))for(var f in c)e&&this.$keys.push(f),this.$attrs[f]=c[f];else c&&(e&&this.$keys.push(c),this.$attrs[c]=g)},load:function(c){this.request(c)},save:function(c){this.request(c)},request:function(c){c||(c={});var g=c.success,e=c.error,f=this;f.$abort=
!1;c.success=function(c){if(!f.$abort){if(c){var e=f.parse(c);h.isObject(e)||(e={data:e});f.set(e,null,!0)}g&&g.apply(this,arguments)}};c.error=function(){f.$abort||e&&e.apply(this,arguments)};f.$trans=f.sync(c)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=h.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},
endTransaction:function(){delete this.$bakAttrs}});return n},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(h,f,p,n){var c=window,g=function(a){c.clearTimeout(a);c.clearInterval(a)},e=function(a){q(a.destroy,[],a)},k=0,q=f.safeExec,m=f.has,l={},o=function(a){if(!o.d)o.d=1,a.on("add",function(a){var a=a.vframe,c=l[a.id];if(c){for(var e=0;e<c.length;e++)b(a,c[e]);delete l[a.id]}}),a.on("remove",function(a){delete l[a.vframe.id]}),a.root().on("created",function(){l={}})},b=function(a,b){var c=a.view;if(c&&a.viewInited)q(c.receiveMessage,b,c);else{var e=function(c){a.un("viewInited",
e);q(c.view.receiveMessage,b,c.view)};a.on("viewInited",e)}};return p.extend({mxViewCtor:f.noop,navigate:function(){n.navigate.apply(n,arguments)},manage:function(a,b){var c=!0;1==arguments.length&&(b=a,a="res_"+k++,c=!1);if(!this.$res)this.$res={};var f;h.isNumber(b)?f=g:b&&b.destroy&&(f=e);this.$res[a]={hasKey:c,res:b,destroy:f};return b},getManaged:function(a){var b=this.$res;return b&&m(b,a)?b[a].res:null},removeManaged:function(a){var b=null,c=this.$res;if(c)if(m(c,a))b=c[a].res,delete c[a];
else for(var e in c)if(c[e].res===a){b=c[e].res;delete c[e];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);e.hasKey||delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}"destroy"==a.type&&delete this.$res}},receiveMessage:f.noop,postMessageTo:function(a,c){var e=this.vom;o(e);f.isArray(a)||(a=[a]);c||(c={});for(var g=0,h;g<a.length;g++){h=a[g];var k=e.get(h);k?b(k,c):(l[h]||(l[h]=[]),l[h].push(c))}},
destroyMRequest:function(){var a=this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.home=f.config().appHome;a.beginUpdateHTML=a.beginUpdate;a.endUpdateHTML=a.endUpdate;a.on("interact",function(){a.on("rendercall",a.destroyMRequest);a.on("prerender",a.destroyManaged);a.on("destroy",a.destroyManaged)});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(h){var f=function(){};if(!h.console)h.console={log:f,info:f,error:f};var p,n={};if(!h.Magix)h.Magix={config:function(c){for(var f in c)n[f]=c[f]},start:function(c){p=c}},KISSY.use("magix/magix",function(c,f){h.Magix=f;f.config(n);p&&f.start(p)})})(this);