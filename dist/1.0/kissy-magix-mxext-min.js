KISSY.add("magix/body",function(g,f,q){var p=f.has,j=f.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),c=document.body,h={},e={},l=65536,n=function(c,a,b){b?c.setAttribute(a,b):b=c.getAttribute(a);return b},k,m={process:function(h){for(var a=h.target||h.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var b=a,d=h.type,i=e[d]||(e[d]=RegExp("(?:^|,)"+d+"(?:,|$)"));if(!i.test(n(a,"mx-ie"))){for(var f="mx-"+d,j,s,E=[];b&&b!=c&&!(j=n(b,f),s=n(b,"mx-ie"),j||i.test(s));)E.push(b),
b=b.parentNode;if(j){d=n(b,"mx-owner");if(!d){i=b;for(s=k.all();i&&i!=c;)if(p(s,i.id)){n(b,"mx-owner",d=i.id);break}else i=i.parentNode}if(d)(d=(d=k.get(d))&&d.view)&&d.processEvent({info:j,se:h,tId:a.id||(a.id="mx-e-"+l--),cId:b.id||(b.id="mx-e-"+l--)});else throw Error("miss mx-owner:"+j);}else for(;E.length;)h=E.shift(),s=n(h,"mx-ie"),i.test(s)||(s=s?s+","+d:d,n(h,"mx-ie",s))}},on:function(e,a){var b=this;h[e]?h[e]++:(k=a,h[e]=1,j[e]?b.unbubble(0,c,e):c["on"+e]=function(a){(a=a||window.event)&&
b.process(a)})},un:function(e){var a=h[e];0<a&&(a--,a||(j[e]?this.unbubble(1,c,e):c["on"+e]=null),h[e]=a)}};m.unbubble=function(c,a,b){(c?q.undelegate:q.delegate).call(q,a,b,"[mx-"+b+"]",m.process)};return m},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(g,f){var q=f.safeExec;return{fire:function(f,j,c,h){var e="~"+f,l=this[e];if(l){j||(j={});if(!j.type)j.type=f;for(var f=l.length,g=f-1,k,m;f--;){k=h?f:g-f;m=l[k];if(m.d||m.r)l.splice(k,1),g--;m.d||q(m.f,j,this)}}c&&delete this[e]},on:function(g,j,c){g="~"+g;g=this[g]||(this[g]=[]);f.isNumeric(c)?g.splice(c,0,{f:j}):g.push({f:j,r:c})},un:function(f,g){var c="~"+f,h=this[c];if(h)if(g)for(var c=h.length-1,e;0<=c;c--){if(e=h[c],e.f==g&&!e.d){e.d=1;break}}else delete this[c]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(g){var f=[].slice,q=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,p=/\/[^\/]*$/,j=/[#?].*$/,c=/([^=&?\/#]+)=([^&=#?]*)/g,h=/^https?:\/\//i,e={},l=0,n={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},k=e.hasOwnProperty,m=function(a){return function(c,F,e){switch(arguments.length){case 0:e=a;break;case 1:e=s.isObject(c)?d(a,c):b(a,c)?a[c]:null;break;case 2:null===F?(delete a[c],e=F):a[c]=e=F}return e}},r=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new r(a)},b=function(a,b){return a?k.call(a,b):0},d=function(a,d,c){for(var e in d)if(!c||!b(c,e))a[e]=d[e];return a};d(r.prototype,{get:function(a){var d=this.c,c,a="pathname"+a;if(b(d,a)&&(c=d[a],1<=c.f))c.f++,c.t=l++,c=c.v;return c},set:function(a,d){var c=this.c,a="pathname"+a,e=c[a];if(!b(c,a)){if(c.length>=this.b){c.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var i=this.b-this.x;i--;)e=c.pop(),delete c[e.k]}e={};c.push(e);c[a]=
e}e.k=a;e.v=d;e.f=1;e.t=l++;return e},del:function(a){var a="pathname"+a,b=this.c,d=b[a];if(d)d.f=-1E5,d.v="",delete b[a]},has:function(a){return b(this.c,"pathname"+a)}});var i=a(60),t=a(),v=function(a,b,d,c,e,o){s.isArray(a)||(a=[a]);if(!b||!s.isArray(b)&&!b.callee)b=[b];for(c=0;c<a.length;c++)try{o=a[c],e=s.isFunction(o)&&o.apply(d,b)}catch(i){}return e},s={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:d,has:b,safeExec:v,noop:function(){},config:m(n),start:function(a){var b=
this,a=d(n,a);b.libEnv(a);b.libRequire(a.iniFile,function(c){n=d(a,c,a);n.tagNameChanged="vframe"!=n.tagName;var e=a.progress;b.libRequire(["magix/router","magix/vom"],function(d,c){d.on("!ul",c.locChged);d.on("changed",c.locChged);e&&c.on("progress",e);b.libRequire(a.extensions,d.start)})});a.ready&&(v(a.ready),delete a.ready)},keys:Object.keys||function(a){var d=[],c;for(c in a)b(a,c)&&d.push(c);return d},local:m({}),path:function(a,b){var d=a+"\n"+b,c=t.get(d);if(!c){h.test(b)?c=b:(a=a.replace(j,
"").replace(p,"")+"/","/"==b.charAt(0)?(c=h.test(a)?8:0,c=a.indexOf("/",c),c=a.substring(0,c)+b):c=a+b);for(;q.test(c);)c=c.replace(q,"$1/");t.set(d,c)}return c},pathToObject:function(a,b){var d=i.get(a);if(!d){var d={},e={},f="";j.test(a)?f=a.replace(j,""):~a.indexOf("=")||(f=a);if(f&&h.test(f))var o=f.indexOf("/",8),f=-1==o?"/":f.substring(o);a.replace(c,function(a,d,c){if(b)try{c=decodeURIComponent(c)}catch(o){}e[d]=c});d.pathname=f;d.params=e;i.set(a,d)}return d},objectToPath:function(a,b){var d=
a.pathname,c=[],e=a.params,o,f;for(f in e)o=e[f],b&&encodeURIComponent(o),c.push(f+"="+o);return d+(d&&c.length?"?":"")+c.join("&")},tmpl:function(a,d){return 1==arguments.length?{v:e[a],h:b(e,a)}:e[a]=d},listToMap:function(a,b){var d,c,e={},o;s.isString(a)&&(a=a.split(","));if(a&&(o=a.length))for(d=0;d<o;d++)c=a[d],e[b?c[b]:c]=b?c:1;return e},cache:a};return d(s,{libRequire:function(a,b){a?g.use(""+a,function(a){b&&b.apply(a,f.call(arguments,1))}):b&&b()},libEnv:function(a){var b=a.appHome,d=location,
c=a.appName,b=this.path(d.href,b+"/");a.appHome=b;var e=a.debug;e&&(e=0==b.indexOf(d.protocol+"//"+d.host+"/"));d="";(d=e?g.now():a.appTag)&&(d+=".js");g.config({packages:[{name:c,path:b,debug:a.debug=e,combine:a.appCombine,tag:d}]})},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isObject,isRegExp:g.isRegExp,isString:g.isString,isNumber:g.isNumber})});
KISSY.add("magix/router",function(g,f,q,p){var j=window,c=f.has,h=f.mix,g=document,e=/^UTF-8$/i.test(g.charset||g.characterSet||"UTF-8"),l=f.config(),n=f.cache(),k=f.cache(),m,r,a,b=/#.*$/,d=/^[^#]*#?!?/,i=l.nativeHistory,t,v,s=function(a,b,d){if(a){d=this.params;f.isArray(a)||(a=a.split(","));for(var e=0;e<a.length&&!(b=c(d,a[e]));e++);}return b},E=function(){return c(this,"pathname")},I=function(){return c(this,"view")},F=function(){return this.hash.pathname!=this.query.pathname},J=function(a){return this.hash.params[a]!=
this.query.params[a]},x=function(a){return c(this.hash.params,a)},o=function(a){return c(this.query.params,a)},u=function(a){return this.params[a]},A=function(a){var a=f.pathToObject(a,e),b=a.pathname;b&&v&&(a.pathname=f.path(j.location.pathname,b));return a},w=h({getView:function(b){if(!a){a={rs:l.routes||{},nf:l.notFoundView};var d=l.defaultView;if(!d)throw Error("unset defaultView");a.home=d;var c=l.defaultPathname||"";a.rs[c]=d;a.pathname=c}b||(b=a.pathname);d=a.rs;d=f.isFunction(d)?d.call(l,
b):d[b];return{view:d?d:a.nf||a.home,pathname:d?b:a.nf?b:a.pathname}},start:function(){var a=w,b=j.history;t=i&&b.pushState;v=i&&!t;t?a.useState():a.useHash();a.route()},parseQH:function(a){var a=a||j.location.href,c=w,e=n.get(a);if(!e){var e=a.replace(b,""),f=a.replace(d,""),s=A(e),g=A(f),l={};h(l,s.params);h(l,g.params);e={pathnameDiff:F,paramDiff:J,hashOwn:x,queryOwn:o,get:u,href:a,srcQuery:e,srcHash:f,query:s,hash:g,params:l};n.set(a,e)}e.view||(a=c.getView(i?e.hash.pathname||e.query.pathname:
e.hash.pathname),h(e,a));return e},getChged:function(a,b){var d=b.href,c=a.href+"\n"+d,e=k.get(c);e||(c=d+"\n"+c,e=k.get(c));if(!e){var o,e={params:{}};if(a.pathname!=b.pathname)o=e.pathname=1;if(a.view!=b.view)o=e.view=1;var d=a.params,f=b.params,i;for(i in d)d[i]!=f[i]&&(o=1,e.params[i]=1);for(i in f)d[i]!=f[i]&&(o=1,e.params[i]=1);e.occur=o;e.isParam=s;e.isPathname=E;e.isView=I;k.set(c,e)}return e},route:function(){var a=w,b=a.parseQH(),d=r||{params:{},href:"~"},c=!r;r=b;d=a.getChged(d,b);d.occur&&
(m=b,a.fire("changed",{location:b,changed:d,force:c}))},navigate:function(a,b,d){var o=w;!b&&f.isObject(a)&&(b=a,a="");b&&(a=f.objectToPath({params:b,pathname:a},e));if(a){b=A(a);a={};a.params=h({},b.params);a.pathname=b.pathname;if(a.pathname){if(v&&(b=m.query)&&(b=b.params))for(var i in b)c(b,i)&&!c(a.params,i)&&(a.params[i]="")}else i=h({},m.params),a.params=h(i,a.params),a.pathname=m.pathname;i=f.objectToPath(a);if(t?i!=m.srcQuery:i!=m.srcHash)t?(o.poped=1,history[d?"replaceState":"pushState"](null,
null,i),o.route()):(h(a,m,a),a.srcHash=i,a.hash={params:a.params,pathname:a.pathname},o.fire("!ul",{loc:m=a}),i="#!"+i,d?location.replace(i):location.hash=i)}}},q);w.useState=function(){var a=w,b=location.href;p.on(j,"popstate",function(){var d=location.href==b;if(a.poped||!d)a.poped=1,a.route()})};w.useHash=function(){p.on(j,"hashchange",w.route)};return w},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(g,f,q,p){var j=document,c=65536,h=window.CollectGarbage||f.noop,e=f.mix,l=f.config("tagName"),n=f.config("rootId"),k=!f.config("tagNameChanged"),m=f.has,r=k?"mx-defer":"mx-vframe",a,b,d=function(a){return"object"==typeof a?a:j.getElementById(a)};j.createElement(l);var i=/<script[^>]*>[\s\S]*?<\/script>/ig,t,v=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};e(v,{root:function(b,c){if(!a){t=c;var e=d(n);if(!e)e=j.createElement(l),
e.id=n,j.body.insertBefore(e,j.body.firstChild);a=new v(n);b.add(a)}return a}});e(e(v.prototype,q),{mountView:function(a,b){var c=this,h=d(c.id);h._bak?h._chgd=1:(h._bak=1,h._tmpl=h.innerHTML.replace(i,""));c.unmountView();if(a){var g=f.pathToObject(a),l=g.pathname,o=--c.sign;f.libRequire(l,function(a){if(o==c.sign){var i=c.owner;p.prepare(a);var f=new a({owner:c,id:c.id,$:d,path:l,vom:i,location:t});c.view=f;f.on("interact",function(a){if(!a.tmpl){if(h._chgd)h.innerHTML=h._tmpl;c.mountZoneVframes(0,
0,1)}f.on("rendered",function(){c.mountZoneVframes(0,0,1)});f.on("prerender",function(){c.unmountZoneVframes()});f.on("inited",function(){c.viewInited=1;c.fire("viewInited",{view:f})})},0);b=b||{};f.load(e(b,g.params,b))}})}},unmountView:function(){if(this.view){b||(b={caused:this.id});this.unmountZoneVframes();this.cAlter(b);this.view.destroy();var a=d(this.id);if(a&&a._bak)a.innerHTML=a._tmpl;delete this.view;delete this.viewInited;b=0;this.fire("viewUnmounted");h()}this.un("viewInited");this.sign--},
mountVframe:function(a,b,d,c){var e=this.owner,i=e.get(a);if(!i)i=new v(a),i.pId=this.id,m(this.cM,a)||this.cC++,this.cM[a]=c,e.add(i);i.mountView(b,d);return i},mountZoneVframes:function(a,b,e){this.unmountZoneVframes(a);var a=d(a||this.id).getElementsByTagName(l),i=a.length,f={};if(i)for(var h=0,o,u,g,j;h<i;h++)if(o=a[h],u=o.id||(o.id="magix_vf_"+c--),!m(f,u)&&(g=o.getAttribute("mx-view"),(j=!o.getAttribute(r)==k)||g)){this.mountVframe(u,g,b,e);u=d(o).getElementsByTagName(l);for(var t=0,n=u.length,
p;t<n;t++)p=u[t],g=p.getAttribute("mx-view"),j=!o.getAttribute(r)==k,!j&&!g&&(f[p.id||(p.id="magix_vf_"+c--)]=1)}this.cC==this.rC&&this.cCreated({})},unmountVframe:function(a){var a=a||this.id,b=this.owner,d=b.get(a);if(d){var c=d.fcc;d.unmountView();b.remove(a,c);if((b=b.get(d.pId))&&m(b.cM,a))delete b.cM[a],b.cC--}},unmountZoneVframes:function(a){if(a){for(var a=d(a).getElementsByTagName(l),b={},c=this.cM,e=a.length-1,i;0<=e;e--)i=a[e].id,m(c,i)&&(b[i]=1);a=b}else a=this.cM;for(var f in a)this.unmountVframe(f)},
cCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;d.vfCreated();b=this.id;if((d=d.get(this.pId))&&!m(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var b=this.view,d=this.id;if(b)this.fca=1,b.fire("alter",a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&m(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.cAlter(a)}}},locChged:function(a,b){var d=
this.view;if(d&&d.sign&&d.rendered){var c=d.olChanged(b),e={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];f.isString(a)&&(a=a.split(","));this.cs=a}};c&&f.safeExec(d.locationChange,e,d);for(var d=e.cs||f.keys(this.cM),c=0,e=d.length,i=this.owner,o;c<e;c++)(o=i.get(d[c]))&&o.locChged(a,b)}}});return v},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(g,f,q,p,j){var c=f.safeExec,h=f.has,e=[],l=f.mix,n=["render","renderUI"],k=function(a){return function(){var b;this.notifyUpdate()&&(b=a.apply(this,arguments));return b}},m=f.cache(40),r=function(a){l(this,a);this.sign=1};l(r,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,b,d=n.length-1,c;-1<d;d--)c=n[d],b=a[c],f.isFunction(b)&&b!=f.noop&&(a[c]=k(b))}}});var a=r.prototype,b=window.CollectGarbage||f.noop,d=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
i=/\smx-owner\s*=/,t=/\smx-[^v][a-z]+\s*=/,v=function(a){return!i.test(a)&&t.test(a)?a+' mx-owner="'+v.t+'"':a},s={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},E=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,I=/(\w+):([^,]+)/g;l(a,q);l(a,{render:f.noop,locationChange:f.noop,init:f.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,b=a.hasTmpl,d=arguments,i=a.sign,f=h(a,"template"),g=function(h){if(i==a.sign){if(!f)a.template=a.wrapMxEvent(h);a.delegateEvents();a.fire("interact",{tmpl:b},1);c(a.init,d,a);a.fire("inited",0,1);c(a.render,e,a);if(!b&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};b&&!f?a.fetchTmpl(g):g()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
b()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){v.t=this.id;return(""+a).replace(d,v)},setViewHTML:function(a){var b;this.beginUpdate();if(this.sign&&(b=this.$(this.id)))b.innerHTML=a;this.endUpdate()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(f.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat((""+a).split(","))},olChanged:function(a){var b=this.$ol;if(b){var d=0;b.pn&&
(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),b=null;if(a&&a.viewInited)b=a.view;return b},processEvent:function(a){if(this.enableEvent&&this.sign){var b=a.info,d=a.se,e=m.get(b);e||(e=b.match(E),e={n:e[1],f:e[2],i:e[3],p:{}},e.i&&e.i.replace(I,function(a,b,d){e.p[b]=d}),m.set(b,e));if(b=this.events){var i=b[d.type],f=
s[e.f];f&&f.call(s,d);(f=i&&i[e.n])&&c(f,l({view:this,currentId:a.cId,targetId:a.tId,domEvent:d,events:b,params:e.p},s),i)}}},delegateEvents:function(a){var b=this.events,a=a?p.un:p.on,d=this.vom,c;for(c in b)a.call(p,c,d)}});var F=f.config("appHome"),J=f.config("debug")?"?t="+g.now():"",x=function(a,b,d){for(var c in b)g.isObject(b[c])?(h(a,c)||(a[c]={}),x(a[c],b[c],1)):d&&(a[c]=b[c])};r.prototype.fetchTmpl=function(a){var b=this,d=b.template;if(g.isUndefined(d))if(d=f.tmpl(b.path),d.h)a(d.v);else{var e=
F+b.path+".html",i=x[e],d=function(d){a(f.tmpl(b.path,d))};i?i.push(d):(i=x[e]=[d],j({url:e+J,success:function(a){c(i,a);delete x[e]},error:function(a,b){c(i,b);delete x[e]}}))}else a(d)};r.extend=function(a,b,d){var e=function(){e.superclass.constructor.apply(this,arguments);b&&c(b,arguments,this)};e.extend=this.extend;return g.extend(e,this,a,d)};r.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var b=a.prototype,d=a.superclass;d;)d=d.constructor,x(b,
d.prototype),d=d.superclass}a.wrapUpdate()};return r},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(g,f,q,p){var j=q.has,c=q.mix,h=0,e=0,l=0,n=0,k={},m={},r=q.mix({all:function(){return k},add:function(a){if(!j(k,a.id))h++,k[a.id]=a,a.owner=r,r.fire("add",{vframe:a})},get:function(a){return k[a]},remove:function(a,b){var d=k[a];d&&(h--,b&&e--,delete k[a],r.fire("remove",{vframe:d}))},vfCreated:function(){if(!n){e++;var a=e/h;l<a&&r.fire("progress",{percent:l=a},n=1==a)}},root:function(){return f.root(r,m)},locChged:function(a){var b=a.loc,d;b?d=1:b=a.location;c(m,
b);if(!d)d=r.root(),a=a.changed,a.isView()?d.mountView(b.view):d.locChged(b,a)}},p);return r},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(g,f,q){var p=f.has,j=f.safeExec,c=function(a){g.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++)d=a[b],delete d.cacheKey;return a},h=function(a){this.$mClass=a;this.$mCache=f.cache();this.$mCacheKeys={};this.$mMetas={}},e=[].slice,l={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},n=function(a){var b={},d;for(d in a)l[d]||(b[d]=a[d]);return b},k=function(a,b,d){return function(){return a.apply(b,[b,d].concat(e.call(arguments)))}},m=function(a,
b){if(b)for(var d=a.length-1;-1<d;d--)m(a[d]);else{d=a.$mm;if(!a.fromCache&&0<d.used)a.fromCache=!0;d.used++}};f.mix(h,{create:function(a){if(!a)throw Error("MManager.create:modelClass ungiven");return new h(a)}});var r=function(a){this.$host=a;this.$doTask=!1;this.$reqModels={}};f.mix(r.prototype,{fetchModels:function(a,b,d){var c=this;if(c.$doTask)return c.next(function(c){c.fetchModels(a,b,d)}),c;c.$doTask=!0;var e=c.$host,f=e.$mCache,h=e.$mCacheKeys,l=c.$reqModels;g.isArray(a)||(a=[a]);var n=
a.length,r=0,q,x,o=Array(n),u=[],A={},w=[],K=g.isArray(b);K&&(u=Array(b.length));for(var M=function(a,k,y,B){if(!c.$destroy){r++;delete l[a.id];var C=a.$mm,D=C.cacheKey;o[k]=a;if(B)x=!0,q=B,A[k]=y;else if(!D||D&&!f.has(D)){D&&f.set(D,a);C.doneAt=g.now();var z=C.after,C=C.meta;z&&j(z,[a,C]);e.fireAfter(C.name,[a])}if(2==d){if(z=K?b[k]:b)m(a),u[k]=j(z,[a,x?{msg:q}:null,x?A:null],c)}else if(4==d){w[k]={m:a,e:x,s:q};for(k=w.i||0;z=w[k];k++)if(C=K?b[k]:b,m(z.m),u[k]=j(C,[z.m,z.e?{msg:z.s}:null,w.e?A:null,
u],c),z.e)A[k]=z.s,w.e=1;w.i=k}if(r>=n)A.msg=q,k=x?A:null,1==d?(m(o,1),o.push(k),u[0]=j(b,o,c),u[1]=k):u.push(k),c.$ntId=setTimeout(function(){c.doNext(u)},30);if(D&&p(h,D))k=h[D].q,delete h[D],j(k,[y,B],a)}},G=0,y;G<a.length;G++)if(y=a[G]){var H;H=e.getModel(y);var B=H.cacheKey;y=H.entity;var L=k(M,y,G);B&&p(h,B)?h[B].q.push(L):H.needUpdate?(l[y.id]=y,B&&(h[B]={q:[],e:y}),y.request(L)):L()}else throw Error("miss attrs:"+a);return c},fetchAll:function(a,b){return this.fetchModels(a,b,1)},saveAll:function(a,
b){a=c(a);return this.fetchModels(a,b,1)},fetchOrder:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOrder:function(a,b){var a=c(a),d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOne:function(a,b){var a=c(a),d=e.call(arguments,1);return this.reqModels(a,1<d.length?d:b,2)},fetchOne:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,b=this.$host.$mCacheKeys;
if(a)for(var d in a){var c=a[d],e=c.$mm.cacheKey;if(e&&p(b,e)){var f=b[e];delete b[e];j(f,[!0,c,"aborted"],c)}c.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){this.$doTask=!1;var b=this.$queue;b&&(b=b.shift())&&j(b,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});f.mix(h.prototype,
{registerModels:function(a){var b=this.$mMetas;g.isArray(a)||(a=[a]);for(var d=0,c;d<a.length;d++){if((c=a[d])&&!c.name)throw Error("model must own a name attribute");b[c.name]=c}},registerMethods:function(a){var b=this,d;for(d in a)b[d]=function(a){return function(d,c){return a.call(b,d,function(){c.apply(b,arguments)})}}(a[d])},createModel:function(a){var b=this.getModelMeta(a),d=new this.$mClass(n(b));d.$mm={used:0};var c=a.before||b.before;this.fireBefore(b.name,[d]);g.isFunction(c)&&j(c,[d,b,
a]);d.$mm.after=a.after||b.after;c=a.cacheKey||b.cacheKey;g.isFunction(c)&&(c=j(c,[b,a]));d.$mm.cacheKey=c;d.$mm.meta=b;d.set(n(a));d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);return d},getModelMeta:function(a){var b=this.$mMetas,d;d=g.isString(a)?a:a.name;b=b[d];if(!b)throw Error("Not found:"+a.name);return b},getModel:function(a){var b=this.getCachedModel(a),d;b||(d=!0,b=this.createModel(a));return{entity:b,cacheKey:b.$mm.cacheKey,
needUpdate:d}},saveAll:function(a,b){return(new r(this)).saveAll(a,b)},fetchAll:function(a,b){return(new r(this)).fetchAll(a,b)},saveOrder:function(a,b){var d=new r(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(a,b){var d=new r(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(a,b){var d=new r(this);return d.saveOne.apply(d,arguments)},fetchOne:function(a,b){var d=new r(this);return d.fetchOne.apply(d,arguments)},clearCacheByKey:function(a){var b=this.$mCache;g.isString(a)&&
b.del(a)},clearCacheByName:function(a){for(var b=this.$mCache,d=b.c,c=0;c<d.length;c++){var e=d[c].v;(e=e&&e.$mm)&&e.meta.name==a&&b.del(e.cacheKey)}},getModelUrl:function(a){a=this.getModelMeta(a);return a.url?a.url:this.$mClass.prototype.url(a.uri)},listenBefore:function(a,b){q.on.call(this,a+"_before",b)},listenAfter:function(a,b){q.on.call(this,a+"_after",b)},unlistenBefore:function(a,b){q.un.call(this,a+"_before",b)},unlistenAfter:function(a,b){q.un.call(this,a+"_after",b)},fireBefore:function(a,
b){q.fire.call(this,a+"_before",b)},fireAfter:function(a,b){q.fire.call(this,a+"_after",b)},getCachedModel:function(a){var b=this.$mCache,d=null,c,e;g.isString(a)?c=a:(e=this.getModelMeta(a),c=a.cacheKey||e.cacheKey,g.isFunction(c)&&(c=j(c,[e,a])));if(c)if(d=this.$mCacheKeys[c])d=d.e;else if(d=b.get(c)){if(!e)e=d.$mm.meta;b=a.cacheTime||e.cacheTime||0;g.isFunction(b)&&(b=j(b,[e,a]));0<b&&g.now()-d.$mm.doneAt>b&&(this.clearCacheByKey(c),d=null)}return d}});return h},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(g,f){var q=function(c,h,e){for(var l in h)g.isObject(h[l])?(f.has(c,l)||(c[l]={}),q(c[l],h[l],!0)):e&&(c[l]=h[l])},p=function(c){c&&this.set(c);this.id=g.guid("m")},j=encodeURIComponent;f.mix(p,{GET:"GET",POST:"POST",extend:function(c,h){var e=function(){e.superclass.constructor.apply(this,arguments);h&&f.safeExec(h,[],this)};f.mix(e,this,{prototype:!0});q(c,this.prototype);return g.extend(e,this,c)}});f.mix(p.prototype,{urlMap:{},sync:f.noop,parse:function(c){return c},
getPostParams:function(){return this.getParams(p.POST)},getUrlParams:function(){return this.getParams(p.GET)},getParams:function(c){var c=c?c.toUpperCase():p.GET,c=this["$"+c],f=[],e;if(c)for(var l in c)if(e=c[l],g.isArray(e))for(var n=0;n<e.length;n++)f.push(l+"="+j(e[n]));else f.push(l+"="+j(e));return f.join("&")},setUrlParamsIf:function(c,f){this.setParams(c,f,p.GET,!0)},setPostParamsIf:function(c,f){this.setParams(c,f,p.POST,!0)},setParams:function(c,f,e,l){e=e?e.toUpperCase():p.GET;if(!this.$types)this.$types=
{};this.$types[e]=!0;e="$"+e;this[e]||(this[e]={});if(g.isObject(c))for(var j in c){if(!l||!this[e][j])this[e][j]=c[j]}else if(c&&(!l||!this[e][c]))this[e][c]=f},setPostParams:function(c,f){this.setParams(c,f,p.POST)},setUrlParams:function(c,f){this.setParams(c,f,p.GET)},reset:function(){var c=this.$types;if(c){for(var h in c)f.has(c,h)&&delete this["$"+h];delete this.$types}c=this.$keys;h=this.$attrs;if(c){for(var e=0;e<c.length;e++)delete h[c[e]];delete this.$keys}},url:function(c){var f=this.get("url");
if(c=c||this.get("uri")){var f=c.split(":"),e=this.urlMap;if(e){for(var g=0,j=f.length;g<j&&!(e=e[f[g]],!e);g++);c=e||c}f=c}else if(!f)throw Error("model not set uri and url");return f},get:function(c){var f=!arguments.length,e=this.$attrs;return e?f?e:e[c]:null},set:function(c,f,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(g.isObject(c))for(var j in c)e&&this.$keys.push(j),this.$attrs[j]=c[j];else c&&(e&&this.$keys.push(c),this.$attrs[c]=f)},request:function(c,f){c||(c=function(){});
var e=g.isFunction(c),j=c.success,n=c.error,k=this;k.$abort=!1;var m=function(m,a){if(!k.$abort)if(a)e&&c(m,a,f),n&&n.call(k,a);else{if(m){var b=k.parse(m);g.isObject(b)||(b={data:b});k.set(b,null,!0)}e&&c(m,a,f);j&&j.call(k,m)}};m.success=function(c){m(c)};m.error=function(c){m(null,c||"request error")};k.$trans=k.sync(m,f)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=
g.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return p},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(g,f,q,p){var j=window,c=function(a){j.clearTimeout(a);j.clearInterval(a)},h=function(a){l(a.destroy,[],a)},e=0,l=f.safeExec,n=f.has,k={},m=function(a){if(!m.d)m.d=1,a.on("add",function(a){var a=a.vframe,d=k[a.id];if(d){for(var c=0;c<d.length;c++)r(a,d[c]);delete k[a.id]}}),a.on("remove",function(a){delete k[a.vframe.id]}),a.root().on("created",function(){k={}})},r=function(a,b){var d=a.view;if(d&&a.viewInited)l(d.receiveMessage,b,d);else{var c=function(d){a.un("viewInited",
c);l(d.view.receiveMessage,b,d.view)};a.on("viewInited",c)}};return q.extend({mxViewCtor:f.noop,navigate:function(){p.navigate.apply(p,arguments)},manage:function(a,b){var d=!0;1==arguments.length&&(b=a,a="res_"+e++,d=!1);if(!this.$res)this.$res={};var f;g.isNumber(b)?f=c:b&&b.destroy&&(f=h);this.$res[a]={hasKey:d,res:b,destroy:f};return b},getManaged:function(a){var b=this.$res;return b&&n(b,a)?b[a].res:null},removeManaged:function(a){var b=null,d=this.$res;if(d)if(n(d,a))b=d[a].res,delete d[a];
else for(var c in d)if(d[c].res===a){b=d[c].res;delete d[c];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);e.hasKey||delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}"destroy"==a.type&&delete this.$res}},receiveMessage:f.noop,postMessageTo:function(a,b){var c=this.vom;m(c);f.isArray(a)||(a=[a]);b||(b={});for(var e=0,g;e<a.length;e++){g=a[e];var h=c.get(g);h?r(h,b):(k[g]||(k[g]=[]),k[g].push(b))}},
destroyMRequest:function(){var a=this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.home=f.config().appHome;a.beginUpdateHTML=a.beginUpdate;a.endUpdateHTML=a.endUpdate;a.on("interact",function(){a.on("rendercall",a.destroyMRequest);a.on("prerender",a.destroyManaged);a.on("destroy",a.destroyManaged)});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(g){var f=function(){};if(!g.console)g.console={log:f,info:f,error:f};var q,p={};if(!g.Magix)g.Magix={config:function(f){for(var c in f)p[c]=f[c]},start:function(f){q=f}},KISSY.use("magix/magix",function(f,c){g.Magix=c;c.config(p);q&&c.start(q)})})(this);