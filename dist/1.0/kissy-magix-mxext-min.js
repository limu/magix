KISSY.add("magix/body",function(h,g,r){var t=g.has,l=g.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),c=document.body,f={},e={},o=65536,p=function(c,a,b){b?c.setAttribute(a,b):b=c.getAttribute(a);return b},j,q={process:function(f){for(var a=f.target||f.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var b=a,d=f.type,s=e[d]||(e[d]=RegExp("(?:^|,)"+d+"(?:,|$)"));if(!s.test(p(a,"mx-ie"))){for(var i="mx-"+d,g,m,B=[];b&&b!=c&&!(g=p(b,i),m=p(b,"mx-ie"),g||s.test(m));)B.push(b),
b=b.parentNode;if(g){d=p(b,"mx-owner");if(!d){s=b;for(m=j.all();s&&s!=c;)if(t(m,s.id)){p(b,"mx-owner",d=s.id);break}else s=s.parentNode}if(d)(d=(d=j.get(d))&&d.view)&&d.processEvent({info:g,se:f,tId:a.id||(a.id="mx-e-"+o--),cId:b.id||(b.id="mx-e-"+o--)});else throw Error("miss mx-owner:"+g);}else for(;B.length;)f=B.shift(),m=p(f,"mx-ie"),s.test(m)||(m=m?m+","+d:d,p(f,"mx-ie",m))}},on:function(e,a){var b=this;f[e]?f[e]++:(j=a,f[e]=1,l[e]?b.unbubble(0,c,e):c["on"+e]=function(a){(a=a||window.event)&&
b.process(a)})},un:function(e){var a=f[e];0<a&&(a--,a||(l[e]?this.unbubble(1,c,e):c["on"+e]=null),f[e]=a)}};q.unbubble=function(c,a,b){(c?r.undelegate:r.delegate).call(r,a,b,"[mx-"+b+"]",q.process)};return q},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(h,g){var r=g.safeExec;return{fire:function(g,l,c,f){var e="~"+g,o=this[e];if(o){l||(l={});if(!l.type)l.type=g;for(var g=o.length,h=g-1,j,q;g--;){j=f?g:h-g;q=o[j];if(q.d||q.r)o.splice(j,1),h--;q.d||r(q.f,l,this)}}c&&delete this[e]},on:function(h,l,c){h="~"+h;h=this[h]||(this[h]=[]);g.isNumeric(c)?h.splice(c,0,{f:l}):h.push({f:l,r:c})},un:function(g,h){var c="~"+g,f=this[c];if(f)if(h)for(var c=f.length-1,e;0<=c;c--){if(e=f[c],e.f==h&&!e.d){e.d=1;break}}else delete this[c]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(h){var g=[].slice,r=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,t=/\/[^\/]*$/,l=/[#?].*$/,c=/([^=&?\/#]+)=([^&=#?]*)/g,f=/^https?:\/\//i,e={},o=0,p={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},j=e.hasOwnProperty,q=function(a){return function(c,i,e){switch(arguments.length){case 0:e=a;break;case 1:e=m.isObject(c)?d(a,c):b(a,c)?a[c]:null;break;case 2:null===i?(delete a[c],e=i):a[c]=e=i}return e}},n=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new n(a)},b=function(a,b){return a?j.call(a,b):0},d=function(a,d,c){for(var i in d)if(!c||!b(c,i))a[i]=d[i];return a};d(n.prototype,{get:function(a){var d=this.c,c,a="pathname"+a;if(b(d,a)&&(c=d[a],1<=c.f))c.f++,c.t=o++,c=c.v;return c},set:function(a,d){var c=this.c,a="pathname"+a,i=c[a];if(!b(c,a)){if(c.length>=this.b){c.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var k=this.b-this.x;k--;)i=c.pop(),delete c[i.k]}i={};c.push(i);c[a]=
i}i.k=a;i.v=d;i.f=1;i.t=o++;return i},del:function(a){var a="pathname"+a,b=this.c,d=b[a];if(d)d.f=-1E5,d.v="",delete b[a]},has:function(a){return b(this.c,"pathname"+a)}});var s=a(60),i=a(),y=function(a,b,d,c,k,i){m.isArray(a)||(a=[a]);if(!b||!m.isArray(b)&&!b.callee)b=[b];for(c=0;c<a.length;c++)try{i=a[c],k=m.isFunction(i)&&i.apply(d,b)}catch(e){}return k},m={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:d,has:b,safeExec:y,noop:function(){},config:q(p),start:function(a){var b=
this,a=d(p,a);b.libEnv(a);b.libRequire(a.iniFile,function(c){p=d(a,c,a);var i=a.progress;b.libRequire(["magix/router","magix/vom"],function(d,c){d.on("!ul",c.locChged);d.on("changed",c.locChged);i&&c.on("progress",i);b.libRequire(a.extensions,d.start)})});a.ready&&(y(a.ready),delete a.ready)},keys:Object.keys||function(a){var d=[],c;for(c in a)b(a,c)&&d.push(c);return d},local:q({}),path:function(a,b){var d=a+"\n"+b,c=i.get(d);if(!c){f.test(b)?c=b:(a=a.replace(l,"").replace(t,"")+"/","/"==b.charAt(0)?
(c=f.test(a)?8:0,c=a.indexOf("/",c),c=a.substring(0,c)+b):c=a+b);for(;r.test(c);)c=c.replace(r,"$1/");i.set(d,c)}return c},pathToObject:function(a,b){var d=s.get(a);if(!d){var d={},i={},k="";l.test(a)?k=a.replace(l,""):~a.indexOf("=")||(k=a);if(k&&f.test(k))var e=k.indexOf("/",8),k=-1==e?"/":k.substring(e);a.replace(c,function(a,c,d){if(b)try{d=decodeURIComponent(d)}catch(k){}i[c]=d});d.pathname=k;d.params=i;s.set(a,d)}return d},objectToPath:function(a,b){var d=a.pathname,c=[],k=a.params,i,e;for(e in k)i=
k[e],b&&encodeURIComponent(i),c.push(e+"="+i);return d+(d&&c.length?"?":"")+c.join("&")},tmpl:function(a,d){return 1==arguments.length?{v:e[a],h:b(e,a)}:e[a]=d},listToMap:function(a,b){var d,c,k={},i;this.isString(a)&&(a=a.split(","));if(a&&(i=a.length))for(d=0;d<i;d++)c=a[d],k[b?c[b]:c]=b?c:1;return k},cache:a};return d(m,{libRequire:function(a,b){a?h.use(a.toString(),function(a){b&&b.apply(a,g.call(arguments,1))}):b&&b()},libEnv:function(a){var b=a.appHome,d=location,c=a.appName,b=this.path(d.href,
b+"/");a.appHome=b;var k=a.debug;k&&(k=0==b.indexOf(d.protocol+"//"+d.host+"/"));d="";(d=k?h.now():a.appTag)&&(d+=".js");h.config({packages:[{name:c,path:b,debug:a.debug=k,combine:a.appCombine,tag:d}]})},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber})});
KISSY.add("magix/router",function(h,g,r,t){var l=window,c=g.has,f=g.mix,e=document,o=/^UTF-8$/i.test(e.charset||e.characterSet||"UTF-8"),p=g.config(),j=g.cache(),q=g.cache(),n,a,b,d=/#.*$/,s=/^[^#]*#?!?/,i=p.nativeHistory,y,m,B=function(a,b,d){if(a){d=this.params;g.isArray(a)||(a=a.split(","));for(var k=0;k<a.length&&!(b=c(d,a[k]));k++);}return b},J=function(){return c(this,"pathname")},K=function(){return c(this,"view")},F=function(){return this.hash.pathname!=this.query.pathname},k=function(a){return this.hash.params[a]!=
this.query.params[a]},v=function(a){return c(this.hash.params,a)},z=function(a){return c(this.query.params,a)},G=function(a){return this.params[a]},A=function(a){var a=g.pathToObject(a,o),b=a.pathname;b&&m&&(a.pathname=g.path(l.location.pathname,b));return a},u=f({getView:function(a){if(!b){b={rs:p.routes||{},nf:p.notFoundView};var d=p.defaultView;if(!d)throw Error("unset defaultView");b.home=d;var c=p.defaultPathname||"";b.rs[c]=d;b.pathname=c}a||(a=b.pathname);d=b.rs;d=g.isFunction(d)?d.call(p,
a):d[a];return{view:d?d:b.nf||b.home,pathname:d?a:b.nf?a:b.pathname}},start:function(){var a=u,b=l.history;y=i&&b.pushState;m=i&&!y;y?a.useState():a.useHash();a.route()},parseQH:function(a){var a=a||l.location.href,b=u,c=j.get(a);if(!c){var c=a.replace(d,""),e=a.replace(s,""),m=A(c),g=A(e),h={};f(h,m.params);f(h,g.params);c={pathnameDiff:F,paramDiff:k,hashOwn:v,queryOwn:z,get:G,href:a,srcQuery:c,srcHash:e,query:m,hash:g,params:h};j.set(a,c)}c.view||(a=b.getView(i?c.hash.pathname||c.query.pathname:
c.hash.pathname),f(c,a));return c},getChged:function(a,b){var d=b.href,c=a.href+"\n"+d,k=q.get(c);k||(c=d+"\n"+c,k=q.get(c));if(!k){var i,k={params:{}};if(a.pathname!=b.pathname)i=k.pathname=1;if(a.view!=b.view)i=k.view=1;var d=a.params,e=b.params,m;for(m in d)d[m]!=e[m]&&(i=1,k.params[m]=1);for(m in e)d[m]!=e[m]&&(i=1,k.params[m]=1);k.occur=i;k.isParam=B;k.isPathname=J;k.isView=K;q.set(c,k)}return k},route:function(){var b=u,d=b.parseQH(),c=a||{params:{},href:"~"},k=!a;a=d;c=b.getChged(c,d);c.occur&&
(n=d,b.fire("changed",{location:d,changed:c,force:k}))},navigate:function(a,b,d){var k=u;!b&&g.isObject(a)&&(b=a,a="");b&&(a=g.objectToPath({params:b,pathname:a},o));if(a){b=A(a);a={};a.params=f({},b.params);a.pathname=b.pathname;if(a.pathname){if(m&&(b=n.query)&&(b=b.params))for(var i in b)c(b,i)&&!c(a.params,i)&&(a.params[i]="")}else i=f({},n.params),a.params=f(i,a.params),a.pathname=n.pathname;i=g.objectToPath(a);if(y?i!=n.srcQuery:i!=n.srcHash)y?(k.poped=1,history[d?"replaceState":"pushState"]({},
e.title,i),k.route()):(f(a,n,a),a.srcHash=i,a.hash={params:a.params,pathname:a.pathname},k.fire("!ul",{loc:n=a}),i="#!"+i,d?location.replace(i):location.hash=i)}}},r);u.useState=function(){var a=u,b=location.href;t.on(l,"popstate",function(){var d=location.href==b;if(a.poped||!d)a.poped=1,a.route()})};u.useHash=function(){t.on(l,"hashchange",u.route)};return u},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(h,g,r,t){var l=document,c=65536,f=window.CollectGarbage||g.noop,e=g.mix,h=g.config(),o=h.tagName,p=h.rootId,j=g.has,q,n,a=function(a){return"object"==typeof a?a:l.getElementById(a)};l.createElement(o);var b=/<script[^>]*>[\s\S]*?<\/script>/ig,d,s=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};e(s,{root:function(b,c){if(!q){d=c;var e=a(p);if(!e)e=l.createElement(o),e.id=p,l.body.insertBefore(e,l.body.firstChild);q=new s(p);b.add(q)}return q}});
e(e(s.prototype,r),{mountView:function(c,s){var m=this,f=a(m.id);f._bak?f._chgd=1:(f._bak=1,f._tmpl=f.innerHTML.replace(b,""));m.unmountView();if(c){var h=g.pathToObject(c),o=h.pathname,l=--m.sign;g.libRequire(o,function(b){if(l==m.sign){var c=m.owner;t.prepare(b);var i=new b({owner:m,id:m.id,$:a,path:o,vom:c,location:d});m.view=i;i.on("interact",function(a){if(!a.tmpl){if(f._chgd)f.innerHTML=f._tmpl;m.mountZoneVframes(0,0,1)}i.on("rendered",function(){m.mountZoneVframes(0,0,1)});i.on("prerender",
function(){m.unmountZoneVframes()});i.on("inited",function(){m.viewInited=1;m.fire("viewInited",{view:i})})},0);s=s||{};i.load(e(s,h.params,s))}})}},unmountView:function(){if(this.view){n||(n={caused:this.id});this.unmountZoneVframes();this.cAlter(n);this.view.destroy();var b=a(this.id);if(b&&b._bak)b.innerHTML=b._tmpl;delete this.view;delete this.viewInited;n=0;this.fire("viewUnmounted");f()}this.un("viewInited");this.sign--},mountVframe:function(a,b,d,c){var e=this.owner,f=e.get(a);if(!f)f=new s(a),
f.pId=this.id,j(this.cM,a)||this.cC++,this.cM[a]=c,e.add(f);f.mountView(b,d);return f},mountZoneVframes:function(b,d,e){this.unmountZoneVframes(b);var b=a(b||this.id).getElementsByTagName(o),f=b.length,s={};if(f)for(var g=0,h,k,v,l;g<f;g++){h=b[g];k=h.id||(h.id="magix_vf_"+c--);j(s,k)||(v=h.getAttribute("mx-view"),l=h.getAttribute("mx-defer"),(!l||v)&&this.mountVframe(k,v,d,e));h=a(h).getElementsByTagName(o);k=0;for(v=h.length;k<v;k++)s[h[k].id||(h[k].id="magix_vf_"+c--)]=1}this.cC==this.rC&&this.cCreated({})},
unmountVframe:function(a){var a=a||this.id,b=this.owner,d=b.get(a);if(d){var c=d.fcc;d.unmountView();b.remove(a,c);if((b=b.get(d.pId))&&j(b.cM,a))delete b.cM[a],b.cC--}},unmountZoneVframes:function(b){if(b){for(var b=a(b).getElementsByTagName(o),d={},c=this.cM,e=b.length-1,f;0<=e;e--)f=b[e].id,j(c,f)&&(d[f]=1);b=d}else b=this.cM;for(var s in b)this.unmountVframe(s)},cCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;
d.vfCreated();b=this.id;if((d=d.get(this.pId))&&!j(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var b=this.view,d=this.id;if(b)this.fca=1,b.fire("alter",a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&j(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.cAlter(a)}}},locChged:function(a,b){var d=this.view;if(d&&d.sign&&d.rendered){var c=d.olChanged(b),e={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=
a||[];g.isString(a)&&(a=a.split(","));this.cs=a}};c&&g.safeExec(d.locationChange,e,d);for(var d=e.cs||g.keys(this.cM),c=0,e=d.length,f=this.owner,s;c<e;c++)(s=f.get(d[c]))&&s.locChged(a,b)}}});return s},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(h,g,r,t,l){var c=g.safeExec,f=g.has,e=[],o=g.config(),p=g.mix,j=["render","renderUI"],q=function(a){return function(){var b;this.notifyUpdate()&&(b=a.apply(this,arguments));return b}},n=g.cache(40),a=function(a){p(this,a);this.sign=1};p(a,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,b,d=j.length-1,c;-1<d;d--)c=j[d],b=a[c],g.isFunction(b)&&b!=g.noop&&(a[c]=q(b))}}});var b=a.prototype,d=window.CollectGarbage||g.noop,s=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
i=/\smx-owner\s*=/,y=/\smx-[^v][a-z]+\s*=/,m=function(a){return!i.test(a)&&y.test(a)?a+' mx-owner="'+m.t+'"':a},B={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},J=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,K=/(\w+):([^,]+)/g;p(b,r);p(b,{render:g.noop,locationChange:g.noop,init:g.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,b=a.hasTmpl,d=arguments,i=a.sign,s=f(a,"template"),g=function(f){if(i==a.sign){if(!s)a.template=a.wrapMxEvent(f);a.delegateEvents();a.fire("interact",{tmpl:b},1);c(a.init,d,a);a.fire("inited",0,1);c(a.render,e,a);if(!b&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};b&&!s?a.fetchTmpl(g):g()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
d()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){m.t=this.id;return(""+a).replace(s,m)},setViewHTML:function(a){var b;this.beginUpdate();if(this.sign&&(b=this.$(this.id)))b.innerHTML=a;this.endUpdate()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(g.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat(g.isString(a)?a.split(","):a)},olChanged:function(a){var b=this.$ol;if(b){var d=
0;b.pn&&(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),b=null;if(a&&a.viewInited)b=a.view;return b},processEvent:function(a){if(this.enableEvent&&this.sign){var b=a.info,d=a.se,e=n.get(b);e||(e=b.match(J),e={n:e[1],f:e[2],i:e[3],p:{}},e.i&&e.i.replace(K,function(a,b,d){e.p[b]=d}),n.set(b,e));if(b=this.events){var f=b[d.type],
i=B[e.f];i&&i.call(B,d);(i=f&&f[e.n])&&c(i,p({view:this,currentId:a.cId,targetId:a.tId,domEvent:d,events:b,params:e.p},B),f)}}},delegateEvents:function(a){var b=this.events,a=a?t.un:t.on,d=this.vom,c;for(c in b)a.call(t,c,d)}});var F=function(a,b,d){for(var c in b)h.isObject(b[c])?(f(a,c)||(a[c]={}),F(a[c],b[c],1)):d&&(a[c]=b[c])};a.prototype.fetchTmpl=function(a){var b=this,d=b.template;if(h.isUndefined(d))if(d=g.tmpl(b.path),d.h)a(d.v);else{var e=o.appHome+b.path+".html",f=F[e],d=function(d){a(g.tmpl(b.path,
d))};f?f.push(d):(f=F[e]=[d],l({url:e+(o.debug?"?t="+h.now():""),success:function(a){c(f,a);delete F[e]},error:function(a,b){c(f,b);delete F[e]}}))}else a(d)};a.extend=function(a,b,d){var e=function(){e.superclass.constructor.apply(this,arguments);b&&c(b,arguments,this)};e.extend=this.extend;return h.extend(e,this,a,d)};a.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var b=a.prototype,d=a.superclass;d;)d=d.constructor,F(b,d.prototype),d=d.superclass}a.wrapUpdate()};
return a},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(h,g,r,t){var l=r.has,c=r.mix,f=0,e=0,o=0,p=0,j={},q={},n=r.mix({all:function(){return j},add:function(a){if(!l(j,a.id))f++,j[a.id]=a,a.owner=n,n.fire("add",{vframe:a})},get:function(a){return j[a]},remove:function(a,b){var d=j[a];d&&(f--,b&&e--,delete j[a],n.fire("remove",{vframe:d}))},vfCreated:function(){if(!p){e++;var a=e/f;o<a&&n.fire("progress",{percent:o=a},p=1==a)}},root:function(){return g.root(n,q)},locChged:function(a){var b=a.loc,d;b?d=1:b=a.location;c(q,
b);if(!d)d=n.root(),a=a.changed,a.isView()?d.mountView(b.view):d.locChged(b,a)}},t);return n},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(h,g,r){var t=g.has,l=g.safeExec,c=function(a){h.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++)d=a[b],delete d.cacheKey;return a},f=function(a){this.$mClass=a;this.$mCache=g.cache();this.$mCacheKeys={};this.$mMetas={}},e=[].slice,o={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},p=function(a){var b={},d;for(d in a)o[d]||(b[d]=a[d]);return b},j=function(a,b,d){return function(){return a.apply(b,[b,d].concat(e.call(arguments)))}},q=function(a,
b){if(b)for(var d=a.length-1;-1<d;d--)q(a[d]);else{d=a.$mm;if(!a.fromCache&&0<d.used)a.fromCache=!0;d.used++}};g.mix(f,{create:function(a){if(!a)throw Error("MManager.create:modelClass ungiven");return new f(a)}});var n=function(a){this.$host=a;this.$doTask=!1;this.$reqModels={}};g.mix(n.prototype,{fetchModels:function(a,b,d){var c=this;if(c.$doTask)return c.next(function(c){c.fetchModels(a,b,d)}),c;c.$doTask=!0;var e=c.$host,f=e.$mCache,g=e.$mCacheKeys,o=c.$reqModels;h.isArray(a)||(a=[a]);var p=
a.length,n=0,r,k,v=Array(p),z=[],G={},A=[],u=h.isArray(b);u&&(z=Array(b.length));for(var M=function(a,j,w,C){if(!c.$destroy){n++;delete o[a.id];var D=a.$mm,E=D.cacheKey;v[j]=a;if(C)k=!0,r=C,G[j]=w;else if(!E||E&&!f.has(E)){E&&f.set(E,a);D.doneAt=h.now();var x=D.after,D=D.meta;x&&l(x,[a,D]);e.fireAfter(D.name,[a])}if(2==d){if(x=u?b[j]:b)q(a),z[j]=l(x,[a,k?{msg:r}:null,k?G:null],c)}else if(4==d){A[j]={m:a,e:k,s:r};for(j=A.i||0;x=A[j];j++)if(D=u?b[j]:b,q(x.m),z[j]=l(D,[x.m,x.e?{msg:x.s}:null,A.e?G:null,
z],c),x.e)G[j]=x.s,A.e=1;A.i=j}if(n>=p)G.msg=r,j=k?G:null,1==d?(q(v,1),v.push(j),z[0]=l(b,v,c),z[1]=j):z.push(j),c.$ntId=setTimeout(function(){c.doNext(z)},30);if(E&&t(g,E))j=g[E].q,delete g[E],l(j,[w,C],a)}},H=0,w;H<a.length;H++)if(w=a[H]){var I;I=e.getModel(w);var C=I.cacheKey;w=I.entity;var L=j(M,w,H);C&&t(g,C)?g[C].q.push(L):I.needUpdate?(o[w.id]=w,C&&(g[C]={q:[],e:w}),w.request(L)):L()}else throw Error("miss attrs:"+a);return c},fetchAll:function(a,b){return this.fetchModels(a,b,1)},saveAll:function(a,
b){a=c(a);return this.fetchModels(a,b,1)},fetchOrder:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOrder:function(a,b){var a=c(a),d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOne:function(a,b){var a=c(a),d=e.call(arguments,1);return this.reqModels(a,1<d.length?d:b,2)},fetchOne:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,b=this.$host.$mCacheKeys;
if(a)for(var d in a){var c=a[d],e=c.$mm.cacheKey;if(e&&t(b,e)){var f=b[e];delete b[e];l(f,[!0,c,"aborted"],c)}c.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){this.$doTask=!1;var b=this.$queue;b&&(b=b.shift())&&l(b,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});g.mix(f.prototype,
{registerModels:function(a){var b=this.$mMetas;h.isArray(a)||(a=[a]);for(var d=0,c;d<a.length;d++){if((c=a[d])&&!c.name)throw Error("model must own a name attribute");b[c.name]=c}},registerMethods:function(a){var b=this,d;for(d in a)b[d]=function(a){return function(d,c){var e,f=a.call(b,d,function(){e||c.apply(b,arguments)});return{destroy:function(){e=!0;f&&f.destroy&&f.destroy()},fetchAll:1,fetchOne:1}}}(a[d])},createModel:function(a){var b=this.getModelMeta(a),d=new this.$mClass(p(b));d.$mm={used:0};
var c=a.before||b.before;this.fireBefore(b.name,[d]);h.isFunction(c)&&l(c,[d,b,a]);d.$mm.after=a.after||b.after;c=a.cacheKey||b.cacheKey;h.isFunction(c)&&(c=l(c,[b,a]));d.$mm.cacheKey=c;d.$mm.meta=b;d.set(p(a));d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);return d},getModelMeta:function(a){var b=this.$mMetas,d;d=h.isString(a)?a:a.name;b=b[d];if(!b)throw Error("Not found:"+a.name);return b},getModel:function(a){var b=this.getCachedModel(a),
d;b||(d=!0,b=this.createModel(a));return{entity:b,cacheKey:b.$mm.cacheKey,needUpdate:d}},saveAll:function(a,b){return(new n(this)).saveAll(a,b)},fetchAll:function(a,b){return(new n(this)).fetchAll(a,b)},saveOrder:function(a,b){var d=new n(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(a,b){var d=new n(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(a,b){var d=new n(this);return d.saveOne.apply(d,arguments)},fetchOne:function(a,b){var d=new n(this);return d.fetchOne.apply(d,
arguments)},clearCacheByKey:function(a){var b=this.$mCache;h.isString(a)&&b.del(a)},clearCacheByName:function(a){for(var b=this.$mCache,d=b.c,c=0;c<d.length;c++){var e=d[c].v;(e=e&&e.$mm)&&e.meta.name==a&&b.del(e.cacheKey)}},getModelUrl:function(a){a=this.getModelMeta(a);return a.url?a.url:this.$mClass.prototype.url(a.uri)},listenBefore:function(a,b){r.on.call(this,a+"_before",b)},listenAfter:function(a,b){r.on.call(this,a+"_after",b)},unlistenBefore:function(a,b){r.un.call(this,a+"_before",b)},unlistenAfter:function(a,
b){r.un.call(this,a+"_after",b)},fireBefore:function(a,b){r.fire.call(this,a+"_before",b)},fireAfter:function(a,b){r.fire.call(this,a+"_after",b)},getCachedModel:function(a){var b=this.$mCache,d=null,c,e;h.isString(a)?c=a:(e=this.getModelMeta(a),c=a.cacheKey||e.cacheKey,h.isFunction(c)&&(c=l(c,[e,a])));if(c)if(d=this.$mCacheKeys[c])d=d.e;else if(d=b.get(c)){if(!e)e=d.$mm.meta;b=a.cacheTime||e.cacheTime||0;h.isFunction(b)&&(b=l(b,[e,a]));0<b&&h.now()-d.$mm.doneAt>b&&(this.clearCacheByKey(c),d=null)}return d}});
return f},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(h,g){var r=function(c,f,e){for(var o in f)h.isObject(f[o])?(g.has(c,o)||(c[o]={}),r(c[o],f[o],!0)):e&&(c[o]=f[o])},t=function(c){c&&this.set(c);this.id=h.guid("m")},l=encodeURIComponent;g.mix(t,{GET:"GET",POST:"POST",extend:function(c,f){var e=function(){e.superclass.constructor.apply(this,arguments);f&&g.safeExec(f,[],this)};g.mix(e,this,{prototype:!0});r(c,this.prototype);return h.extend(e,this,c)}});g.mix(t.prototype,{urlMap:{},sync:g.noop,parse:function(c){return c},
getPostParams:function(){return this.getParams(t.POST)},getUrlParams:function(){return this.getParams(t.GET)},getParams:function(c){var c=c?c.toUpperCase():t.GET,c=this["$"+c],f=[],e;if(c)for(var g in c)if(e=c[g],h.isArray(e))for(var p=0;p<e.length;p++)f.push(g+"="+l(e[p]));else f.push(g+"="+l(e));return f.join("&")},setUrlParamsIf:function(c,f){this.setParams(c,f,t.GET,!0)},setPostParamsIf:function(c,f){this.setParams(c,f,t.POST,!0)},setParams:function(c,f,e,g){e=e?e.toUpperCase():t.GET;if(!this.$types)this.$types=
{};this.$types[e]=!0;e="$"+e;this[e]||(this[e]={});if(h.isObject(c))for(var l in c){if(!g||!this[e][l])this[e][l]=c[l]}else if(c&&(!g||!this[e][c]))this[e][c]=f},setPostParams:function(c,f){this.setParams(c,f,t.POST)},setUrlParams:function(c,f){this.setParams(c,f,t.GET)},reset:function(){var c=this.$types;if(c){for(var f in c)g.has(c,f)&&delete this["$"+f];delete this.$types}c=this.$keys;f=this.$attrs;if(c){for(var e=0;e<c.length;e++)delete f[c[e]];delete this.$keys}},url:function(c){var f=this.get("url");
if(c=c||this.get("uri")){var f=c.split(":"),e=this.urlMap;if(e){for(var g=0,h=f.length;g<h&&!(e=e[f[g]],!e);g++);c=e||c}f=c}else if(!f)throw Error("model not set uri and url");return f},get:function(c){var f=!arguments.length,e=this.$attrs;return e?f?e:e[c]:null},set:function(c,f,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(h.isObject(c))for(var g in c)e&&this.$keys.push(g),this.$attrs[g]=c[g];else c&&(e&&this.$keys.push(c),this.$attrs[c]=f)},request:function(c,f){c||(c=function(){});
var e=h.isFunction(c),g=c.success,l=c.error,j=this;j.$abort=!1;var q=function(n,a){if(!j.$abort)if(a)e&&c(n,a,f),l&&l.call(j,a);else{if(n){var b=j.parse(n);h.isObject(b)||(b={data:b});j.set(b,null,!0)}e&&c(n,a,f);g&&g.call(j,n)}};q.success=function(c){q(c)};q.error=function(c){q(null,c||"request error")};j.$trans=j.sync(q,f)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=
h.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return t},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(h,g,r,t){var l=window,c=function(a){l.clearTimeout(a);l.clearInterval(a)},f=function(a){o(a.destroy,[],a)},e=0,o=g.safeExec,p=g.has,j={},q=function(a){if(!q.d)q.d=1,a.on("add",function(a){var a=a.vframe,d=j[a.id];if(d){for(var c=0;c<d.length;c++)n(a,d[c]);delete j[a.id]}}),a.on("remove",function(a){delete j[a.vframe.id]}),a.root().on("created",function(){j={}})},n=function(a,b){var d=a.view;if(d&&a.viewInited)o(d.receiveMessage,b,d);else{var c=function(d){a.un("viewInited",
c);o(d.view.receiveMessage,b,d.view)};a.on("viewInited",c)}};return r.extend({mxViewCtor:g.noop,navigate:function(){t.navigate.apply(t,arguments)},manage:function(a,b){var d=!0;1==arguments.length&&(b=a,a="res_"+e++,d=!1);if(!this.$res)this.$res={};var g;h.isNumber(b)?g=c:b&&b.destroy&&(g=f);this.$res[a]={hasKey:d,res:b,destroy:g};return b},getManaged:function(a){var b=this.$res;return b&&p(b,a)?b[a].res:null},removeManaged:function(a){var b=null,d=this.$res;if(d)if(p(d,a))b=d[a].res,delete d[a];
else for(var c in d)if(d[c].res===a){b=d[c].res;delete d[c];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);e.hasKey||delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}"destroy"==a.type&&delete this.$res}},receiveMessage:g.noop,postMessageTo:function(a,b){var c=this.vom;q(c);g.isArray(a)||(a=[a]);b||(b={});for(var e=0,f;e<a.length;e++){f=a[e];var h=c.get(f);h?n(h,b):(j[f]||(j[f]=[]),j[f].push(b))}},
destroyMRequest:function(){var a=this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.home=g.config().appHome;a.beginUpdateHTML=a.beginUpdate;a.endUpdateHTML=a.endUpdate;a.on("interact",function(){a.on("rendercall",a.destroyMRequest);a.on("prerender",a.destroyManaged);a.on("destroy",a.destroyManaged)});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(h){var g=function(){};if(!h.console)h.console={log:g,info:g,error:g};var r,t={};if(!h.Magix)h.Magix={config:function(g){for(var c in g)t[c]=g[c]},start:function(g){r=g}},KISSY.use("magix/magix",function(g,c){h.Magix=c;c.config(t);r&&c.start(r)})})(this);