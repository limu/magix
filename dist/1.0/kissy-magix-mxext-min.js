KISSY.add("magix/body",function(h,e,q){var p=e.has,j=e.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),b=document.body,i={},f={},l=65536,o=function(b,d,a){a?b.setAttribute(d,a):a=b.getAttribute(d);return a},n,k={process:function(i){for(var d=i.target||i.srcElement;d&&1!=d.nodeType;)d=d.parentNode;var a=d,c=i.type,g=f[c]||(f[c]=RegExp("(?:^|,)"+c+"(?:,|$)"));if(!g.test(o(d,"mx-ie"))){for(var e="mx-"+c,j,s,w=[];a&&a!=b&&!(j=o(a,e),s=o(a,"mx-ie"),j||g.test(s));)w.push(a),
a=a.parentNode;if(j){c=o(a,"mx-owner");if(!c){g=a;for(s=n.all();g&&g!=b;)if(p(s,g.id)){o(a,"mx-owner",c=g.id);break}else g=g.parentNode}if(c)(c=(c=n.get(c))&&c.view)&&c.processEvent({info:j,se:i,tId:d.id||(d.id="mx-e-"+l--),cId:a.id||(a.id="mx-e-"+l--)});else throw Error("miss mx-owner:"+j);}else for(;w.length;)i=w.shift(),s=o(i,"mx-ie"),g.test(s)||(s=s?s+","+c:c,o(i,"mx-ie",s))}},on:function(f,d){var a=this;i[f]?i[f]++:(n=d,i[f]=1,j[f]?a.unbubble(0,b,f):b["on"+f]=function(c){(c=c||window.event)&&
a.process(c)})},un:function(f){var d=i[f];0<d&&(d--,d||(j[f]?this.unbubble(1,b,f):b["on"+f]=null),i[f]=d)}};k.unbubble=function(b,d,a){(b?q.undelegate:q.delegate).call(q,d,a,"[mx-"+a+"]",k.process)};return k},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(h,e){var q=e.safeExec;return{fire:function(e,j,b,i){var f="~"+e,l=this[f];if(l){j||(j={});if(!j.type)j.type=e;for(var e=l.length,h=e-1,n,k;e--;){n=i?e:h-e;k=l[n];if(k.d||k.r)l.splice(n,1),h--;k.d||q(k.f,j,this)}}b&&delete this[f]},on:function(h,j,b){h="~"+h;h=this[h]||(this[h]=[]);e.isNumeric(b)?h.splice(b,0,{f:j}):h.push({f:j,r:b})},un:function(e,h){var b="~"+e,i=this[b];if(i)if(h)for(var b=i.length-1,f;0<=b;b--){if(f=i[b],f.f==h&&!f.d){f.d=1;break}}else delete this[b]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(h){var e=[].slice,q=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,p=/\/[^\/]*$/,j=/[#?].*$/,b=/([^=&?\/#]+)=([^&=#?]*)/g,i=/^https?:\/\//i,f={},l=0,o={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},n=f.hasOwnProperty,k=function(w){return function(d,b,g){switch(arguments.length){case 0:g=w;break;case 1:g=s.isObject(d)?c(w,d):a(w,d)?w[d]:null;break;case 2:null===b?(delete w[d],g=b):w[d]=g=b}return g}},r=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},d=function(a){return new r(a)},a=function(a,c){return a?n.call(a,c):0},c=function(c,d,b){for(var g in d)if(!b||!a(b,g))c[g]=d[g];return c};c(r.prototype,{get:function(c){var d=this.c,b,c="pathname"+c;if(a(d,c)&&(b=d[c],1<=b.f))b.f++,b.t=l++,b=b.v;return b},set:function(c,b){var d=this.c,c="pathname"+c,g=d[c];if(!a(d,c)){if(d.length>=this.b){d.sort(function(a,c){return c.f==a.f?c.t-a.t:c.f-a.f});for(var f=this.b-this.x;f--;)g=d.pop(),delete d[g.k]}g={};d.push(g);d[c]=
g}g.k=c;g.v=b;g.f=1;g.t=l++;return g},del:function(a){var a="pathname"+a,c=this.c,d=c[a];if(d)d.f=-1E5,d.v="",delete c[a]},has:function(c){return a(this.c,"pathname"+c)}});var g=d(60),t=d(),u=function(a,c,d,b,g,m){s.isArray(a)||(a=[a]);if(!c||!s.isArray(c)&&!c.callee)c=[c];for(b=0;b<a.length;b++)try{m=a[b],g=s.isFunction(m)&&m.apply(d,c)}catch(f){}return g},s={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:c,has:a,safeExec:u,noop:function(){},config:k(o),start:function(a){var d=
this,a=c(o,a);d.libEnv(a);d.libRequire(a.iniFile,function(b){o=c(a,b,a);o.tagNameChanged="vframe"!=o.tagName;var g=a.progress;d.libRequire(["magix/router","magix/vom"],function(c,b){c.on("!ul",b.locChged);c.on("changed",b.locChged);g&&b.on("progress",g);d.libRequire(a.extensions,c.start)})});a.ready&&(u(a.ready),delete a.ready)},keys:Object.keys||function(c){var d=[],b;for(b in c)a(c,b)&&d.push(b);return d},local:k({}),path:function(a,c){var d=a+"\n"+c,b=t.get(d);if(!b){i.test(c)?b=c:(a=a.replace(j,
"").replace(p,"")+"/","/"==c.charAt(0)?(b=i.test(a)?8:0,b=a.indexOf("/",b),b=a.substring(0,b)+c):b=a+c);for(;q.test(b);)b=b.replace(q,"$1/");t.set(d,b)}return b},pathToObject:function(a,c){var d=g.get(a);if(!d){var d={},f={},e="";j.test(a)?e=a.replace(j,""):~a.indexOf("=")||(e=a);if(e&&i.test(e))var m=e.indexOf("/",8),e=-1==m?"/":e.substring(m);a.replace(b,function(a,d,b){if(c)try{b=decodeURIComponent(b)}catch(g){}f[d]=b});d.pathname=e;d.params=f;g.set(a,d)}return d},objectToPath:function(a,c){var b=
a.pathname,d=[],g=a.params,m,f;for(f in g)m=g[f],c&&encodeURIComponent(m),d.push(f+"="+m);return b+(b&&d.length?"?":"")+d.join("&")},tmpl:function(c,b){return 1==arguments.length?{v:f[c],h:a(f,c)}:f[c]=b},listToMap:function(a,c){var b,d,g={},m;s.isString(a)&&(a=a.split(","));if(a&&(m=a.length))for(b=0;b<m;b++)d=a[b],g[c?d[c]:d]=c?d:1;return g},cache:d};return c(s,{libRequire:function(a,c){a?h.use(""+a,function(a){c&&c.apply(a,e.call(arguments,1))}):c&&c()},libEnv:function(a){var c=a.appHome,b=location,
d=a.appName,c=this.path(b.href,c+"/");a.appHome=c;var g=a.debug;g&&(g=0==c.indexOf(b.protocol+"//"+b.host+"/"));b="";(b=g?h.now():a.appTag)&&(b+=".js");h.config({packages:[{name:d,path:c,debug:a.debug=g,combine:a.appCombine,tag:b}]})},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber})});
KISSY.add("magix/router",function(h,e,q,p){var j=window,b=e.has,i=e.mix,h=document,f=/^UTF-8$/i.test(h.charset||h.characterSet||"UTF-8"),l=e.config(),o=e.cache(),n=e.cache(),k,r,d,a=/#.*$/,c=/^[^#]*#?!?/,g=l.nativeHistory,t,u,s=function(a,c,d){if(a){d=this.params;e.isArray(a)||(a=a.split(","));for(var g=0;g<a.length&&!(c=b(d,a[g]));g++);}return c},w=function(){return b(this,"pathname")},I=function(){return b(this,"view")},J=function(){return this.hash.pathname!=this.query.pathname},K=function(a){return this.hash.params[a]!=
this.query.params[a]},D=function(a){return b(this.hash.params,a)},m=function(a){return b(this.query.params,a)},E=function(a){return this.params[a]},x=function(a){var a=e.pathToObject(a,f),c=a.pathname;c&&u&&(a.pathname=e.path(j.location.pathname,c));return a},v=i({getView:function(a){if(!d){d={rs:l.routes||{},nf:l.notFoundView};var c=l.defaultView;if(!c)throw Error("unset defaultView");d.home=c;var b=l.defaultPathname||"";d.rs[b]=c;d.pathname=b}a||(a=d.pathname);c=d.rs;c=e.isFunction(c)?c.call(l,
a):c[a];return{view:c?c:d.nf||d.home,pathname:c?a:d.nf?a:d.pathname}},start:function(){var a=v,c=j.history;t=g&&c.pushState;u=g&&!t;t?a.useState():a.useHash();a.route()},parseQH:function(b){var b=b||j.location.href,d=v,f=o.get(b);if(!f){var f=b.replace(a,""),e=b.replace(c,""),s=x(f),t=x(e),h={};i(h,s.params);i(h,t.params);f={pathnameDiff:J,paramDiff:K,hashOwn:D,queryOwn:m,get:E,href:b,srcQuery:f,srcHash:e,query:s,hash:t,params:h};o.set(b,f)}f.view||(b=d.getView(g?f.hash.pathname||f.query.pathname:
f.hash.pathname),i(f,b));return f},getChged:function(a,c){var b=c.href,d=a.href+"\n"+b,g=n.get(d);g||(d=b+"\n"+d,g=n.get(d));if(!g){var m,g={params:{}};if(a.pathname!=c.pathname)m=g.pathname=1;if(a.view!=c.view)m=g.view=1;var b=a.params,f=c.params,e;for(e in b)b[e]!=f[e]&&(m=1,g.params[e]=1);for(e in f)b[e]!=f[e]&&(m=1,g.params[e]=1);g.occur=m;g.isParam=s;g.isPathname=w;g.isView=I;n.set(d,g)}return g},route:function(){var a=v,c=a.parseQH(),b=r||{params:{},href:"~"},d=!r;r=c;b=a.getChged(b,c);b.occur&&
(k=c,a.fire("changed",{location:c,changed:b,force:d}))},navigate:function(a,c,d){var g=v;!c&&e.isObject(a)&&(c=a,a="");c&&(a=e.objectToPath({params:c,pathname:a},f));if(a){c=x(a);a={};a.params=i({},c.params);a.pathname=c.pathname;if(a.pathname){if(u&&(c=k.query)&&(c=c.params))for(var m in c)b(c,m)&&!b(a.params,m)&&(a.params[m]="")}else m=i({},k.params),a.params=i(m,a.params),a.pathname=k.pathname;m=e.objectToPath(a);if(t?m!=k.srcQuery:m!=k.srcHash)t?(g.poped=1,history[d?"replaceState":"pushState"](null,
null,m),g.route()):(i(a,k,a),a.srcHash=m,a.hash={params:a.params,pathname:a.pathname},g.fire("!ul",{loc:k=a}),m="#!"+m,d?location.replace(m):location.hash=m)}}},q);v.useState=function(){var a=v,c=location.href;p.on(j,"popstate",function(){var b=location.href==c;if(a.poped||!b)a.poped=1,a.route()})};v.useHash=function(){p.on(j,"hashchange",v.route)};return v},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(h,e,q,p){var j=document,b=65536,i=window.CollectGarbage||e.noop,f=e.mix,l=e.config("tagName"),o=e.config("rootId"),n=!e.config("tagNameChanged"),k=e.has,r=n?"mx-defer":"mx-vframe",d,a,c=function(a){return"object"==typeof a?a:j.getElementById(a)};j.createElement(l);var g=/<script[^>]*>[\s\S]*?<\/script>/ig,t,u=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};f(u,{root:function(a,b){if(!d){t=b;var g=c(o);if(!g)g=j.createElement(l),
g.id=o,j.body.insertBefore(g,j.body.firstChild);d=new u(o);a.add(d)}return d}});f(f(u.prototype,q),{mountView:function(a,b){var d=this,i=c(d.id);i._bak?i._chgd=1:(i._bak=1,i._tmpl=i.innerHTML.replace(g,""));d.unmountView();if(a){var h=e.pathToObject(a),l=h.pathname,m=--d.sign;e.libRequire(l,function(a){if(m==d.sign){var g=d.owner;p.prepare(a);var e=new a({owner:d,id:d.id,$:c,path:l,vom:g,location:t});d.view=e;e.on("interact",function(a){if(!a.tmpl){if(i._chgd)i.innerHTML=i._tmpl;d.mountZoneVframes(0,
0,1)}e.on("rendered",function(){d.mountZoneVframes(0,0,1)});e.on("prerender",function(){d.unmountZoneVframes()});e.on("inited",function(){d.viewInited=1;d.fire("viewInited",{view:e})})},0);b=b||{};e.load(f(b,h.params,b))}})}},unmountView:function(){if(this.view){a||(a={caused:this.id});this.unmountZoneVframes();this.cAlter(a);this.view.destroy();var b=c(this.id);if(b&&b._bak)b.innerHTML=b._tmpl;delete this.view;delete this.viewInited;a=0;this.fire("viewUnmounted");i()}this.un("viewInited");this.sign--},
mountVframe:function(a,c,b,d){var g=this.owner,f=g.get(a);if(!f)f=new u(a),f.pId=this.id,k(this.cM,a)||this.cC++,this.cM[a]=d,g.add(f);f.mountView(c,b);return f},mountZoneVframes:function(a,d,g){this.unmountZoneVframes(a);var a=c(a||this.id).getElementsByTagName(l),f=a.length,e={};if(f)for(var i=0,m,h,t,j;i<f;i++)if(m=a[i],h=m.id||(m.id="magix_vf_"+b--),!k(e,h)&&(t=m.getAttribute("mx-view"),(j=!m.getAttribute(r)==n)||t)){this.mountVframe(h,t,d,g);h=c(m).getElementsByTagName(l);for(var u=0,o=h.length,
p;u<o;u++)p=h[u],t=p.getAttribute("mx-view"),j=!m.getAttribute(r)==n,!j&&!t&&(e[p.id||(p.id="magix_vf_"+b--)]=1)}this.cC==this.rC&&this.cCreated({})},unmountVframe:function(a){var a=a||this.id,c=this.owner,b=c.get(a);if(b){var d=b.fcc;b.unmountView();c.remove(a,d);if((c=c.get(b.pId))&&k(c.cM,a))delete c.cM[a],c.cC--}},unmountZoneVframes:function(a){if(a){for(var a=c(a).getElementsByTagName(l),b={},d=this.cM,g=a.length-1,f;0<=g;g--)f=a[g].id,k(d,f)&&(b[f]=1);a=b}else a=this.cM;for(var e in a)this.unmountVframe(e)},
cCreated:function(a){var c=this.view;if(c&&!this.fcc)this.fcc=1,delete this.fca,c.fire("created",a),this.fire("created",a);var b=this.owner;b.vfCreated();c=this.id;if((b=b.get(this.pId))&&!k(b.rM,c))b.rM[c]=b.cM[c],b.rC++,b.rC==b.cC&&b.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var c=this.view,b=this.id;if(c)this.fca=1,c.fire("alter",a),this.fire("alter",a);if((c=this.owner.get(this.pId))&&k(c.rM,b)){var d=c.rM[b];c.rC--;delete c.rM[b];d&&c.cAlter(a)}}},locChged:function(a,c){var b=
this.view;if(b&&b.sign&&b.rendered){var d=b.olChanged(c),g={location:a,changed:c,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];e.isString(a)&&(a=a.split(","));this.cs=a}};d&&e.safeExec(b.locationChange,g,b);for(var b=g.cs||e.keys(this.cM),d=0,g=b.length,f=this.owner,m;d<g;d++)(m=f.get(b[d]))&&m.locChged(a,c)}}});return u},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(h,e,q,p,j){var b=e.safeExec,i=e.has,f=[],l=e.mix,o=["render","renderUI"],n=function(a){return function(){var c;this.notifyUpdate()&&(c=a.apply(this,arguments));return c}},k=e.cache(40),r=function(a){l(this,a);this.sign=1};l(r,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,c,b=o.length-1,d;-1<b;b--)d=o[b],c=a[d],e.isFunction(c)&&c!=e.noop&&(a[d]=n(c))}}});var d=r.prototype,a=window.CollectGarbage||e.noop,c=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
g=/\smx-owner\s*=/,t=/\smx-[^v][a-z]+\s*=/,u=function(a){return!g.test(a)&&t.test(a)?a+' mx-owner="'+u.t+'"':a},s={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},w=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,I=/(\w+):([^,]+)/g;l(d,q);l(d,{render:e.noop,locationChange:e.noop,init:e.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,c=a.hasTmpl,d=arguments,g=a.sign,e=i(a,"template"),h=function(i){if(g==a.sign){if(!e)a.template=a.wrapMxEvent(i);a.delegateEvents();a.fire("interact",{tmpl:c},1);b(a.init,d,a);a.fire("inited",0,1);b(a.render,f,a);if(!c&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};c&&!e?a.fetchTmpl(h):h()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
a()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){u.t=this.id;return(""+a).replace(c,u)},setViewHTML:function(a){var c;this.beginUpdate();if(this.sign&&(c=this.$(this.id)))c.innerHTML=a;this.endUpdate()},observeLocation:function(a){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var b=c.keys;if(e.isObject(a))c.pn=a.pathname,a=a.keys;if(a)c.keys=b.concat((""+a).split(","))},olChanged:function(a){var c=this.$ol;if(c){var b=0;c.pn&&
(b=a.isPathname());b||(b=a.isParam(c.keys));return b}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),c=null;if(a&&a.viewInited)c=a.view;return c},processEvent:function(a){if(this.enableEvent&&this.sign){var c=a.info,d=a.se,g=k.get(c);g||(g=c.match(w),g={n:g[1],f:g[2],i:g[3],p:{}},g.i&&g.i.replace(I,function(a,c,b){g.p[c]=b}),k.set(c,g));if(c=this.events){var f=c[d.type],e=
s[g.f];e&&e.call(s,d);(e=f&&f[g.n])&&b(e,l({view:this,currentId:a.cId,targetId:a.tId,domEvent:d,events:c,params:g.p},s),f)}}},delegateEvents:function(a){var c=this.events,a=a?p.un:p.on,b=this.vom,d;for(d in c)a.call(p,d,b)}});var J=e.config("appHome"),K=e.config("debug")?"?t="+h.now():"",D=function(a,c,b){for(var d in c)h.isObject(c[d])?(i(a,d)||(a[d]={}),D(a[d],c[d],1)):b&&(a[d]=c[d])};r.prototype.fetchTmpl=function(a){var c=this,d=c.template;if(h.isUndefined(d))if(d=e.tmpl(c.path),d.h)a(d.v);else{var g=
J+c.path+".html",f=D[g],d=function(b){a(e.tmpl(c.path,b))};f?f.push(d):(f=D[g]=[d],j({url:g+K,success:function(a){b(f,a);delete D[g]},error:function(a,c){b(f,c);delete D[g]}}))}else a(d)};r.extend=function(a,c,d){var g=function(){g.superclass.constructor.apply(this,arguments);c&&b(c,arguments,this)};g.extend=this.extend;return h.extend(g,this,a,d)};r.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var c=a.prototype,b=a.superclass;b;)b=b.constructor,D(c,
b.prototype),b=b.superclass}a.wrapUpdate()};return r},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(h,e,q,p){var j=q.has,b=q.mix,i=0,f=0,l=0,o=0,n={},k={},r=q.mix({all:function(){return n},add:function(b){if(!j(n,b.id))i++,n[b.id]=b,b.owner=r,r.fire("add",{vframe:b})},get:function(b){return n[b]},remove:function(b,a){var c=n[b];c&&(i--,a&&f--,delete n[b],r.fire("remove",{vframe:c}))},vfCreated:function(){if(!o){f++;var b=f/i;l<b&&r.fire("progress",{percent:l=b},o=1==b)}},root:function(){return e.root(r,k)},locChged:function(d){var a=d.loc,c;a?c=1:a=d.location;b(k,
a);if(!c)c=r.root(),d=d.changed,d.isView()?c.mountView(a.view):c.locChged(a,d)}},p);return r},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(h,e,q){var p=e.has,j=e.safeExec,b=e.mix,i=function(a){h.isArray(a)||(a=[a]);for(var c=0,b;c<a.length;c++)b=a[c],delete b.cacheKey;return a},f=function(a){this.$mClass=a;this.$mCache=e.cache();this.$mCacheKeys={};this.$mMetas={}},l=[].slice,o={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},n=function(a){var c={},b;for(b in a)o[b]||(c[b]=a[b]);return c},k=function(a,c,b){return function(){return a.apply(c,[c,b].concat(l.call(arguments)))}},r=function(a,
c){if(c)for(var b=a.length-1;-1<b;b--)r(a[b]);else{b=a.$mm;if(!a.fromCache&&0<b.used)a.fromCache=!0;b.used++}};b(f,{create:function(a){if(!a)throw Error("MManager.create:modelClass ungiven");return new f(a)}});var d=function(a){this.$host=a;this.$doTask=!1;this.$reqModels={}};b(d.prototype,{fetchModels:function(a,c,b){var d=this;if(d.$doTask)return d.next(function(d){d.fetchModels(a,c,b)}),d;d.$doTask=!0;var f=d.$host,e=f.$mCache,i=f.$mCacheKeys,l=d.$reqModels;h.isArray(a)||(a=[a]);var o=a.length,
n=0,q,m,E=Array(o),x=[],v={},F=[],L=h.isArray(c);L&&(x=Array(c.length));for(var N=function(a,k,y,A){if(!d.$destroy){n++;delete l[a.id];var B=a.$mm,C=B.cacheKey;E[k]=a;if(A)m=!0,q=A,v[k]=y;else if(!C||C&&!e.has(C)){C&&e.set(C,a);B.doneAt=h.now();var z=B.after,B=B.meta;z&&j(z,[a,B]);f.fireAfter(B.name,[a])}if(2==b){if(z=L?c[k]:c)r(a),x[k]=j(z,[a,m?{msg:q}:null,m?v:null],d)}else if(4==b){F[k]={m:a,e:m,s:q};for(k=F.i||0;z=F[k];k++)if(B=L?c[k]:c,r(z.m),x[k]=j(B,[z.m,z.e?{msg:z.s}:null,F.e?v:null,x],d),
z.e)v[k]=z.s,F.e=1;F.i=k}if(n>=o)v.msg=q,k=m?v:null,1==b?(r(E,1),E.push(k),x[0]=j(c,E,d),x[1]=k):x.push(k),d.$ntId=setTimeout(function(){d.doNext(x)},30);if(C&&p(i,C))k=i[C].q,delete i[C],j(k,[y,A],a)}},G=0,y;G<a.length;G++)if(y=a[G]){var H;H=f.getModel(y);var A=H.cacheKey;y=H.entity;var M=k(N,y,G);A&&p(i,A)?i[A].q.push(M):H.needUpdate?(l[y.id]=y,A&&(i[A]={q:[],e:y}),y.request(M)):M()}else throw Error("miss attrs:"+a);return d},fetchAll:function(a,c){return this.fetchModels(a,c,1)},saveAll:function(a,
c){a=i(a);return this.fetchModels(a,c,1)},fetchOrder:function(a,c){var b=l.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOrder:function(a,c){var a=i(a),b=l.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOne:function(a,c){var a=i(a),b=l.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,2)},fetchOne:function(a,c){var b=l.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,c=this.$host.$mCacheKeys;
if(a)for(var b in a){var d=a[b],f=d.$mm.cacheKey;if(f&&p(c,f)){var e=c[f];delete c[f];j(e,[!0,d,"aborted"],d)}d.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){this.$doTask=!1;var c=this.$queue;c&&(c=c.shift())&&j(c,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});b(f.prototype,
{registerModels:function(a){var c=this.$mMetas;h.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++){if((d=a[b])&&!d.name)throw Error("model must own a name attribute");c[d.name]=d}},registerMethods:function(a){b(this,a)},createModel:function(a){var c=this.getModelMeta(a),b=new this.$mClass(n(c));b.$mm={used:0};var d=a.before||c.before;this.fireBefore(c.name,[b]);h.isFunction(d)&&j(d,[b,c,a]);b.$mm.after=a.after||c.after;d=a.cacheKey||c.cacheKey;h.isFunction(d)&&(d=j(d,[c,a]));b.$mm.cacheKey=d;b.$mm.meta=
c;b.set(n(a));b.setUrlParams(c.urlParams);b.setPostParams(c.postParams);b.setUrlParams(a.urlParams);b.setPostParams(a.postParams);return b},getModelMeta:function(a){var c=this.$mMetas,b;b=h.isString(a)?a:a.name;c=c[b];if(!c)throw Error("Not found:"+a.name);return c},getModel:function(a){var c=this.getCachedModel(a),b;c||(b=!0,c=this.createModel(a));return{entity:c,cacheKey:c.$mm.cacheKey,needUpdate:b}},saveAll:function(a,c){return(new d(this)).saveAll(a,c)},fetchAll:function(a,c){return(new d(this)).fetchAll(a,
c)},saveOrder:function(a,c){var b=new d(this);return b.saveOrder.apply(b,arguments)},fetchOrder:function(a,b){var g=new d(this);return g.fetchOrder.apply(g,arguments)},saveOne:function(a,b){var g=new d(this);return g.saveOne.apply(g,arguments)},fetchOne:function(a,b){var g=new d(this);return g.fetchOne.apply(g,arguments)},clearCacheByKey:function(a){var b=this.$mCache;h.isString(a)&&b.del(a)},clearCacheByName:function(a){for(var b=this.$mCache,d=b.c,f=0;f<d.length;f++){var e=d[f].v;(e=e&&e.$mm)&&
e.meta.name==a&&b.del(e.cacheKey)}},getModelUrl:function(a){a=this.getModelMeta(a);return a.url?a.url:this.$mClass.prototype.url(a.uri)},listenBefore:function(a,b){q.on.call(this,a+"_before",b)},listenAfter:function(a,b){q.on.call(this,a+"_after",b)},unlistenBefore:function(a,b){q.un.call(this,a+"_before",b)},unlistenAfter:function(a,b){q.un.call(this,a+"_after",b)},fireBefore:function(a,b){q.fire.call(this,a+"_before",b)},fireAfter:function(a,b){q.fire.call(this,a+"_after",b)},getCachedModel:function(a){var b=
this.$mCache,d=null,f,e;h.isString(a)?f=a:(e=this.getModelMeta(a),f=a.cacheKey||e.cacheKey,h.isFunction(f)&&(f=j(f,[e,a])));if(f)if(d=this.$mCacheKeys[f])d=d.e;else if(d=b.get(f)){if(!e)e=d.$mm.meta;b=a.cacheTime||e.cacheTime||0;h.isFunction(b)&&(b=j(b,[e,a]));0<b&&h.now()-d.$mm.doneAt>b&&(this.clearCacheByKey(f),d=null)}return d}});return f},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(h,e){var q=function(b,i,f){for(var l in i)h.isObject(i[l])?(e.has(b,l)||(b[l]={}),q(b[l],i[l],!0)):f&&(b[l]=i[l])},p=function(b){b&&this.set(b);this.id=h.guid("m")},j=encodeURIComponent;e.mix(p,{GET:"GET",POST:"POST",extend:function(b,i){var f=function(){f.superclass.constructor.apply(this,arguments);i&&e.safeExec(i,[],this)};e.mix(f,this,{prototype:!0});q(b,this.prototype);return h.extend(f,this,b)}});e.mix(p.prototype,{urlMap:{},sync:e.noop,parse:function(b){return b},
getPostParams:function(){return this.getParams(p.POST)},getUrlParams:function(){return this.getParams(p.GET)},getParams:function(b){var b=b?b.toUpperCase():p.GET,b=this["$"+b],e=[],f;if(b)for(var l in b)if(f=b[l],h.isArray(f))for(var o=0;o<f.length;o++)e.push(l+"="+j(f[o]));else e.push(l+"="+j(f));return e.join("&")},setUrlParamsIf:function(b,e){this.setParams(b,e,p.GET,!0)},setPostParamsIf:function(b,e){this.setParams(b,e,p.POST,!0)},setParams:function(b,e,f,l){f=f?f.toUpperCase():p.GET;if(!this.$types)this.$types=
{};this.$types[f]=!0;f="$"+f;this[f]||(this[f]={});if(h.isObject(b))for(var j in b){if(!l||!this[f][j])this[f][j]=b[j]}else if(b&&(!l||!this[f][b]))this[f][b]=e},setPostParams:function(b,e){this.setParams(b,e,p.POST)},setUrlParams:function(b,e){this.setParams(b,e,p.GET)},reset:function(){var b=this.$types;if(b){for(var i in b)e.has(b,i)&&delete this["$"+i];delete this.$types}b=this.$keys;i=this.$attrs;if(b){for(var f=0;f<b.length;f++)delete i[b[f]];delete this.$keys}},url:function(b){var e=this.get("url");
if(b=b||this.get("uri")){var e=b.split(":"),f=this.urlMap;if(f){for(var h=0,j=e.length;h<j&&!(f=f[e[h]],!f);h++);b=f||b}e=b}else if(!e)throw Error("model not set uri and url");return e},get:function(b){var e=!arguments.length,f=this.$attrs;return f?e?f:f[b]:null},set:function(b,e,f){if(!this.$attrs)this.$attrs={};if(f&&!this.$keys)this.$keys=[];if(h.isObject(b))for(var j in b)f&&this.$keys.push(j),this.$attrs[j]=b[j];else b&&(f&&this.$keys.push(b),this.$attrs[b]=e)},request:function(b,e){b||(b=function(){});
var f=h.isFunction(b),j=b.success,o=b.error,n=this;n.$abort=!1;var k=function(k,d){if(!n.$abort)if(d)f&&b(k,d,e),o&&o.call(n,d);else{if(k){var a=n.parse(k);h.isObject(a)||(a={data:a});n.set(a,null,!0)}f&&b(k,d,e);j&&j.call(n,k)}};k.success=function(b){k(b)};k.error=function(b){k(null,b||"request error")};n.$trans=n.sync(k,e)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=
h.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return p},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(h,e,q,p){var j=window,b=function(b){j.clearTimeout(b);j.clearInterval(b)},i=function(b){l(b.destroy,[],b)},f=0,l=e.safeExec,o=e.has,n={},k=function(b){if(!k.d)k.d=1,b.on("add",function(a){var a=a.vframe,b=n[a.id];if(b){for(var d=0;d<b.length;d++)r(a,b[d]);delete n[a.id]}}),b.on("remove",function(a){delete n[a.vframe.id]}),b.root().on("created",function(){n={}})},r=function(b,a){var c=b.view;if(c&&b.viewInited)l(c.receiveMessage,a,c);else{var e=function(c){b.un("viewInited",
e);l(c.view.receiveMessage,a,c.view)};b.on("viewInited",e)}};return q.extend({mxViewCtor:e.noop,navigate:function(){p.navigate.apply(p,arguments)},manage:function(d,a){var c=!0;1==arguments.length&&(a=d,d="res_"+f++,c=!1);if(!this.$res)this.$res={};var e;h.isNumber(a)?e=b:a&&a.destroy&&(e=i);this.$res[d]={hasKey:c,res:a,destroy:e};return a},getManaged:function(b){var a=this.$res;return a&&o(a,b)?a[b].res:null},removeManaged:function(b){var a=null,c=this.$res;if(c)if(o(c,b))a=c[b].res,delete c[b];
else for(var e in c)if(c[e].res===b){a=c[e].res;delete c[e];break}return a},destroyManaged:function(b){var a=this.$res;if(a){for(var c in a){var e=a[c],f=e.res,h=e.destroy,i=!1;h&&(h(f),i=!0);e.hasKey||delete a[c];this.fire("destroyManaged",{resource:f,processed:i})}"destroy"==b.type&&delete this.$res}},receiveMessage:e.noop,postMessageTo:function(b,a){var c=this.vom;k(c);e.isArray(b)||(b=[b]);a||(a={});for(var f=0,h;f<b.length;f++){h=b[f];var i=c.get(h);i?r(i,a):(n[h]||(n[h]=[]),n[h].push(a))}},
destroyMRequest:function(){var b=this.$res;if(b)for(var a in b){var c=b[a].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete b[a])}}},function(){var b=this;b.home=e.config().appHome;b.beginUpdateHTML=b.beginUpdate;b.endUpdateHTML=b.endUpdate;b.on("interact",function(){b.on("rendercall",b.destroyMRequest);b.on("prerender",b.destroyManaged);b.on("destroy",b.destroyManaged)});b.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(h){var e=function(){};if(!h.console)h.console={log:e,info:e,error:e};var q,p={};if(!h.Magix)h.Magix={config:function(e){for(var b in e)p[b]=e[b]},start:function(e){q=e}},KISSY.use("magix/magix",function(e,b){h.Magix=b;b.config(p);q&&b.start(q)})})(this);