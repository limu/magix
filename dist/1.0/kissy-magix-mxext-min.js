KISSY.add("magix/body",function(g,f,r){var q=f.has,i=f.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),c=document.body,h={},e={},k=65536,o=function(c,a,b){b?c.setAttribute(a,b):b=c.getAttribute(a);return b},j,m={process:function(h){for(var a=h.target||h.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var b=a,d=h.type,n=e[d]||(e[d]=RegExp("(?:^|,)"+d+"(?:,|$)"));if(!n.test(o(a,"mx-ie"))){for(var f="mx-"+d,i,l,E=[];b&&b!=c&&!(i=o(b,f),l=o(b,"mx-ie"),i||n.test(l));)E.push(b),
b=b.parentNode;if(i){d=o(b,"mx-owner");if(!d){n=b;for(l=j.all();n&&n!=c;)if(q(l,n.id)){o(b,"mx-owner",d=n.id);break}else n=n.parentNode}if(d)(d=(d=j.get(d))&&d.view)&&d.processEvent({info:i,se:h,tId:a.id||(a.id="mx-e-"+k--),cId:b.id||(b.id="mx-e-"+k--)});else throw Error("miss mx-owner:"+i);}else for(;E.length;)h=E.shift(),l=o(h,"mx-ie"),n.test(l)||(l=l?l+","+d:d,o(h,"mx-ie",l))}},on:function(e,a){var b=this;h[e]?h[e]++:(j=a,h[e]=1,i[e]?b.unbubble(0,c,e):c["on"+e]=function(a){(a=a||window.event)&&
b.process(a)})},un:function(e){var a=h[e];0<a&&(a--,a||(i[e]?this.unbubble(1,c,e):c["on"+e]=null),h[e]=a)}};m.unbubble=function(c,a,b){(c?r.undelegate:r.delegate).call(r,a,b,"[mx-"+b+"]",m.process)};return m},{requires:["magix/magix","event","sizzle"]});
KISSY.add("magix/event",function(g,f){var r=f.safeExec;return{fire:function(f,i,c,h){var e="~"+f,k=this[e];if(k){i||(i={});if(!i.type)i.type=f;for(var f=k.length,g=f-1,j,m;f--;){j=h?f:g-f;m=k[j];if(m.d||m.r)k.splice(j,1),g--;m.d||r(m.f,i,this)}}c&&delete this[e]},on:function(g,i,c){g="~"+g;g=this[g]||(this[g]=[]);f.isNumeric(c)?g.splice(c,0,{f:i}):g.push({f:i,r:c})},un:function(f,g){var c="~"+f,h=this[c];if(h)if(g)for(var c=h.length-1,e;0<=c;c--){if(e=h[c],e.f==g&&!e.d){e.d=1;break}}else delete this[c]}}},
{requires:["magix/magix"]});
KISSY.add("magix/magix",function(g){var f=[].slice,r=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,q=/\/[^\/]*$/,i=/[#?].*$/,c=/([^=&?\/#]+)=([^&=#?]*)/g,h=/^https?:\/\//i,e={},k=0,o={debug:false,iniFile:"app/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},j=e.hasOwnProperty,m=function(a){return function(c,F,e){switch(arguments.length){case 0:e=a;break;case 1:e=l.isObject(c)?d(a,c):b(a,c)?a[c]:null;break;case 2:null===F?(delete a[c],e=F):a[c]=e=F}return e}},s=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new s(a)},b=function(a,b){return a?j.call(a,b):0},d=function(a,d,c){for(var e in d)if(!c||!b(c,e))a[e]=d[e];return a};d(s.prototype,{get:function(a){var d=this.c,c,a="pathname"+a;if(b(d,a)&&(c=d[a],1<=c.f))c.f++,c.t=k++,c=c.v;return c},set:function(a,d){var c=this.c,a="pathname"+a,e=c[a];if(!b(c,a)){if(c.length>=this.b){c.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var n=this.b-this.x;n--;)e=c.pop(),delete c[e.k]}e={};c.push(e);c[a]=
e}e.k=a;e.v=d;e.f=1;e.t=k++;return e},del:function(a){var a="pathname"+a,b=this.c,d=b[a];if(d)d.f=-1E5,d.v="",delete b[a]},has:function(a){return b(this.c,"pathname"+a)}});var n=a(60),t=a(),v=function(a,b,d,c,e,p){l.isArray(a)||(a=[a]);if(!b||!l.isArray(b)&&!b.callee)b=[b];for(c=0;c<a.length;c++)try{p=a[c],e=l.isFunction(p)&&p.apply(d,b)}catch(n){}return e},l={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:d,has:b,safeExec:v,noop:function(){},config:m(o),start:function(a){var b=
this,a=d(o,a);b.libEnv(a);b.libRequire(a.iniFile,function(c){o=d(a,c,a);o.tagNameChanged="vframe"!=o.tagName;var e=a.progress;b.libRequire(["magix/router","magix/vom"],function(d,c){d.on("!ul",c.locChged);d.on("changed",c.locChged);e&&c.on("progress",e);b.libRequire(a.extensions,d.start)})});a.ready&&(v(a.ready),delete a.ready)},keys:Object.keys||function(a){var d=[],c;for(c in a)b(a,c)&&d.push(c);return d},local:m({}),path:function(a,b){var d=a+"\n"+b,c=t.get(d);if(!c){h.test(b)?c=b:(a=a.replace(i,
"").replace(q,"")+"/","/"==b.charAt(0)?(c=h.test(a)?8:0,c=a.indexOf("/",c),c=a.substring(0,c)+b):c=a+b);for(;r.test(c);)c=c.replace(r,"$1/");t.set(d,c)}return c},pathToObject:function(a,b){var d=n.get(a);if(!d){var d={},e={},l="";i.test(a)?l=a.replace(i,""):~a.indexOf("=")||(l=a);if(l&&h.test(l))var p=l.indexOf("/",8),l=-1==p?"/":l.substring(p);a.replace(c,function(a,d,c){if(b)try{c=decodeURIComponent(c)}catch(p){}e[d]=c});d.pathname=l;d.params=e;n.set(a,d)}return d},objectToPath:function(a,b){var d=
a.pathname,c=[],e=a.params,p,l;for(l in e)p=e[l],b&&encodeURIComponent(p),c.push(l+"="+p);return d+(d&&c.length?"?":"")+c.join("&")},tmpl:function(a,d){return 1==arguments.length?{v:e[a],h:b(e,a)}:e[a]=d},listToMap:function(a,b){var d,c,e={},p;l.isString(a)&&(a=a.split(","));if(a&&(p=a.length))for(d=0;d<p;d++)c=a[d],e[b?c[b]:c]=b?c:1;return e},cache:a};return d(l,{libRequire:function(a,b){a?g.use(""+a,function(a){b&&b.apply(a,f.call(arguments,1))}):b&&b()},libEnv:function(a){var b=a.appHome,d=location,
c=a.appName,b=this.path(d.href,b+"/");a.appHome=b;var e=a.debug;e&&(e=0==b.indexOf(d.protocol+"//"+d.host+"/"));d="";(d=e?g.now():a.appTag)&&(d+=".js");g.config({packages:[{name:c,path:b,debug:a.debug=e,combine:a.appCombine,tag:d}]})},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isObject,isRegExp:g.isRegExp,isString:g.isString,isNumber:g.isNumber})});
KISSY.add("magix/router",function(g,f,r,q){var i=window,c=f.has,h=f.mix,g=document,e=/^UTF-8$/i.test(g.charset||g.characterSet||"UTF-8"),k=f.config(),o=f.cache(),j=f.cache(),m,s,a,b=/#.*$/,d=/^[^#]*#?!?/,n=k.nativeHistory,t,v,l=function(a,b,d){if(a){d=this.params;f.isArray(a)||(a=a.split(","));for(var e=0;e<a.length&&!(b=c(d,a[e]));e++);}return b},E=function(){return c(this,"pathname")},I=function(){return c(this,"view")},F=function(){return this.hash.pathname!=this.query.pathname},J=function(a){return this.hash.params[a]!=
this.query.params[a]},x=function(a){return c(this.hash.params,a)},p=function(a){return c(this.query.params,a)},u=function(a){return this.params[a]},A=function(a){var a=f.pathToObject(a,e),b=a.pathname;b&&v&&(a.pathname=f.path(i.location.pathname,b));return a},w=h({getView:function(b){if(!a){a={rs:k.routes||{},nf:k.notFoundView};var d=k.defaultView;if(!d)throw Error("unset defaultView");a.home=d;var c=k.defaultPathname||"";a.rs[c]=d;a.pathname=c}b||(b=a.pathname);d=a.rs;d=f.isFunction(d)?d.call(k,
b):d[b];return{view:d?d:a.nf||a.home,pathname:d?b:a.nf?b:a.pathname}},start:function(){var a=w,b=i.history;t=n&&b.pushState;v=n&&!t;t?a.useState():a.useHash();a.route()},parseQH:function(a){var a=a||i.location.href,c=w,e=o.get(a);if(!e){var e=a.replace(b,""),l=a.replace(d,""),f=A(e),g=A(l),k={};h(k,f.params);h(k,g.params);e={pathnameDiff:F,paramDiff:J,hashOwn:x,queryOwn:p,get:u,href:a,srcQuery:e,srcHash:l,query:f,hash:g,params:k};o.set(a,e)}e.view||(a=c.getView(n?e.hash.pathname||e.query.pathname:
e.hash.pathname),h(e,a));return e},getChged:function(a,b){var d=b.href,c=a.href+"\n"+d,e=j.get(c);e||(c=d+"\n"+c,e=j.get(c));if(!e){var p,e={params:{}};if(a.pathname!=b.pathname)p=e.pathname=1;if(a.view!=b.view)p=e.view=1;var d=a.params,n=b.params,f;for(f in d)d[f]!=n[f]&&(p=1,e.params[f]=1);for(f in n)d[f]!=n[f]&&(p=1,e.params[f]=1);e.occur=p;e.isParam=l;e.isPathname=E;e.isView=I;j.set(c,e)}return e},route:function(){var a=w,b=a.parseQH(),d=s||{params:{},href:"~"},c=!s;s=b;d=a.getChged(d,b);d.occur&&
(m=b,a.fire("changed",{location:b,changed:d,force:c}))},navigate:function(a,b,d){var p=w;!b&&f.isObject(a)&&(b=a,a="");b&&(a=f.objectToPath({params:b,pathname:a},e));if(a){b=A(a);a={};a.params=h({},b.params);a.pathname=b.pathname;if(a.pathname){if(v&&(b=m.query)&&(b=b.params))for(var l in b)c(b,l)&&!c(a.params,l)&&(a.params[l]="")}else l=h({},m.params),a.params=h(l,a.params),a.pathname=m.pathname;l=f.objectToPath(a);if(t?l!=m.srcQuery:l!=m.srcHash)t?(p.poped=1,history[d?"replaceState":"pushState"](null,
null,l),p.route()):(h(a,m,a),a.srcHash=l,a.hash={params:a.params,pathname:a.pathname},p.fire("!ul",{loc:m=a}),l="#!"+l,d?location.replace(l):location.hash=l)}}},r);w.useState=function(){var a=w,b=location.href;q.on(i,"popstate",function(){var d=location.href==b;if(a.poped||!d)a.poped=1,a.route()})};w.useHash=function(){q.on(i,"hashchange",w.route)};return w},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(g,f,r,q){var i=document,c=65536,h=window.CollectGarbage||f.noop,e=f.mix,k=f.config("tagName"),o=f.config("rootId"),j=!f.config("tagNameChanged"),m=f.has,s=j?"mx-defer":"mx-vframe",a,b,d=function(a){return"object"==typeof a?a:i.getElementById(a)};i.createElement(k);var n=/<script[^>]*>[\s\S]*?<\/script>/ig,t,v=function(a){this.id=a;this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};e(v,{root:function(b,c){if(!a){t=c;var e=d(o);if(!e)e=i.createElement(k),
e.id=o,i.body.insertBefore(e,i.body.firstChild);a=new v(o);b.add(a)}return a}});e(e(v.prototype,r),{mountView:function(a,b){var c=this,h=d(c.id);h._bak?h._chgd=1:(h._bak=1,h._tmpl=h.innerHTML.replace(n,""));c.unmountView();if(a){var g=f.pathToObject(a),k=g.pathname,p=--c.sign;f.libRequire(k,function(a){if(p==c.sign){var l=c.owner;q.prepare(a);var f=new a({owner:c,id:c.id,$:d,path:k,vom:l,location:t});c.view=f;f.on("interact",function(a){if(!a.tmpl){if(h._chgd)h.innerHTML=h._tmpl;c.mountZoneVframes(0,
0,1)}f.on("rendered",function(){c.mountZoneVframes(0,0,1)});f.on("prerender",function(){c.unmountZoneVframes()});f.on("inited",function(){c.viewInited=1;c.fire("viewInited",{view:f})})},0);b=b||{};f.load(e(b,g.params,b))}})}},unmountView:function(){if(this.view){b||(b={caused:this.id});this.unmountZoneVframes();this.cAlter(b);this.view.destroy();var a=d(this.id);if(a&&a._bak)a.innerHTML=a._tmpl;delete this.view;delete this.viewInited;b=0;this.fire("viewUnmounted");h()}this.un("viewInited");this.sign--},
mountVframe:function(a,b,d,c){var e=this.owner,f=e.get(a);if(!f)f=new v(a),f.pId=this.id,m(this.cM,a)||this.cC++,this.cM[a]=c,e.add(f);f.mountView(b,d);return f},mountZoneVframes:function(a,b,e){this.unmountZoneVframes(a);var a=d(a||this.id).getElementsByTagName(k),f=a.length,h={};if(f)for(var n=0,p,u,g,i;n<f;n++)if(p=a[n],u=p.id||(p.id="magix_vf_"+c--),!m(h,u)&&(g=p.getAttribute("mx-view"),(i=!p.getAttribute(s)==j)||g)){this.mountVframe(u,g,b,e);u=d(p).getElementsByTagName(k);for(var t=0,o=u.length,
q;t<o;t++)q=u[t],g=q.getAttribute("mx-view"),i=!p.getAttribute(s)==j,!i&&!g&&(h[q.id||(q.id="magix_vf_"+c--)]=1)}this.cC==this.rC&&this.cCreated({})},unmountVframe:function(a){var a=a||this.id,b=this.owner,d=b.get(a);if(d){var c=d.fcc;d.unmountView();b.remove(a,c);if((b=b.get(d.pId))&&m(b.cM,a))delete b.cM[a],b.cC--}},unmountZoneVframes:function(a){if(a){for(var a=d(a).getElementsByTagName(k),b={},c=this.cM,e=a.length-1,f;0<=e;e--)f=a[e].id,m(c,f)&&(b[f]=1);a=b}else a=this.cM;for(var n in a)this.unmountVframe(n)},
cCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;d.vfCreated();b=this.id;if((d=d.get(this.pId))&&!m(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.cCreated(a)},cAlter:function(a){delete this.fcc;if(!this.fca){var b=this.view,d=this.id;if(b)this.fca=1,b.fire("alter",a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&m(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.cAlter(a)}}},locChged:function(a,b){var d=
this.view;if(d&&d.sign&&d.rendered){var c=d.olChanged(b),e={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];f.isString(a)&&(a=a.split(","));this.cs=a}};c&&f.safeExec(d.locationChange,e,d);for(var d=e.cs||f.keys(this.cM),c=0,e=d.length,n=this.owner,p;c<e;c++)(p=n.get(d[c]))&&p.locChged(a,b)}}});return v},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(g,f,r,q,i){var c=f.safeExec,h=f.has,e=[],k=f.mix,o=["render","renderUI"],j=function(a){return function(){var b;this.notifyUpdate()&&(b=a.apply(this,arguments));return b}},m=f.cache(40),s=function(a){k(this,a);this.sign=1};k(s,{wrapUpdate:function(){if(!this["~"]){this["~"]=1;for(var a=this.prototype,b,d=o.length-1,c;-1<d;d--)c=o[d],b=a[c],f.isFunction(b)&&b!=f.noop&&(a[c]=j(b))}}});var a=s.prototype,b=window.CollectGarbage||f.noop,d=/<[a-z]+(?:[^">]|"[^"]*")+(?=>)/g,
n=/\smx-owner\s*=/,t=/\smx-[^v][a-z]+\s*=/,v=function(a){return!n.test(a)&&t.test(a)?a+' mx-owner="'+v.t+'"':a},l={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},E=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,I=/(\w+):([^,]+)/g;k(a,r);k(a,{render:f.noop,locationChange:f.noop,init:f.noop,hasTmpl:!0,enableEvent:!0,load:function(){var a=
this,b=a.hasTmpl,d=arguments,f=a.sign,n=h(a,"template"),g=function(h){if(f==a.sign){if(!n)a.template=a.wrapMxEvent(h);a.delegateEvents();a.fire("interact",{tmpl:b},1);c(a.init,d,a);a.fire("inited",0,1);c(a.render,e,a);if(!b&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)}};b&&!n?a.fetchTmpl(g):g()},beginUpdate:function(){this.sign&&this.rendered&&(this.fire("refresh",0,1),this.fire("prerender"))},endUpdate:function(){if(this.sign)this.rendered||this.fire("primed",0,1),this.rendered=!0,this.fire("rendered"),
b()},notifyUpdate:function(){this.sign&&(this.sign++,this.fire("rendercall"));return this.sign},wrapMxEvent:function(a){v.t=this.id;return(""+a).replace(d,v)},setViewHTML:function(a){var b;this.beginUpdate();if(this.sign&&(b=this.$(this.id)))b.innerHTML=a;this.endUpdate()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(f.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat((""+a).split(","))},olChanged:function(a){var b=this.$ol;if(b){var d=0;b.pn&&
(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),b=null;if(a&&a.viewInited)b=a.view;return b},processEvent:function(a){if(this.enableEvent&&this.sign){var b=a.info,d=a.se,e=m.get(b);e||(e=b.match(E),e={n:e[1],f:e[2],i:e[3],p:{}},e.i&&e.i.replace(I,function(a,b,d){e.p[b]=d}),m.set(b,e));if(b=this.events){var f=b[d.type],n=
l[e.f];n&&n.call(l,d);(n=f&&f[e.n])&&c(n,k({view:this,currentId:a.cId,targetId:a.tId,domEvent:d,events:b,params:e.p},l),f)}}},delegateEvents:function(a){var b=this.events,a=a?q.un:q.on,d=this.vom,c;for(c in b)a.call(q,c,d)}});var F=f.config("appHome"),J=f.config("debug")?"?t="+g.now():"",x=function(a,b,d){for(var c in b)g.isObject(b[c])?(h(a,c)||(a[c]={}),x(a[c],b[c],1)):d&&(a[c]=b[c])};s.prototype.fetchTmpl=function(a){var b=this,d=b.template;if(g.isUndefined(d))if(d=f.tmpl(b.path),d.h)a(d.v);else{var e=
F+b.path+".html",n=x[e],d=function(d){a(f.tmpl(b.path,d))};n?n.push(d):(n=x[e]=[d],i({url:e+J,success:function(a){c(n,a);delete x[e]},error:function(a,b){c(n,b);delete x[e]}}))}else a(d)};s.extend=function(a,b,d){var e=function(){e.superclass.constructor.apply(this,arguments);b&&c(b,arguments,this)};e.extend=this.extend;return g.extend(e,this,a,d)};s.prepare=function(a){if(!a.wrapUpdate){a.wrapUpdate=this.wrapUpdate;a.extend=this.extend;for(var b=a.prototype,d=a.superclass;d;)d=d.constructor,x(b,
d.prototype),d=d.superclass}a.wrapUpdate()};return s},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(g,f,r,q){var i=r.has,c=r.mix,h=0,e=0,k=0,o=0,j={},m={},s=r.mix({all:function(){return j},add:function(a){if(!i(j,a.id))h++,j[a.id]=a,a.owner=s,s.fire("add",{vframe:a})},get:function(a){return j[a]},remove:function(a,b){var d=j[a];d&&(h--,b&&e--,delete j[a],s.fire("remove",{vframe:d}))},vfCreated:function(){if(!o){e++;var a=e/h;k<a&&s.fire("progress",{percent:k=a},o=1==a)}},root:function(){return f.root(s,m)},locChged:function(a){var b=a.loc,d;b?d=1:b=a.location;c(m,
b);if(!d)d=s.root(),a=a.changed,a.isView()?d.mountView(b.view):d.locChged(b,a)}},q);return s},{requires:["magix/vframe","magix/magix","magix/event"]});
KISSY.add("mxext/mmanager",function(g,f,r){var q=f.has,i=f.safeExec,c=function(a){g.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++)d=a[b],delete d.cacheKey;return a},h=function(a){this.$mClass=a;this.$mCache=f.cache();this.$mCacheKeys={};this.$mMetas={}},e=[].slice,k={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},o=function(a){var b={},d;for(d in a)k[d]||(b[d]=a[d]);return b},j=function(a,b,d){return function(){return a.apply(b,[b,d].concat(e.call(arguments)))}},m=function(a,
b){if(b)for(var d=a.length-1;-1<d;d--)m(a[d]);else{d=a.$mm;if(!a.fromCache&&0<d.used)a.fromCache=!0;d.used++}};f.mix(h,{create:function(a){if(!a)throw Error("MManager.create:modelClass ungiven");return new h(a)}});var s=function(a){this.$host=a;this.$doTask=!1;this.$reqModels={}};f.mix(s.prototype,{fetchModels:function(a,b,d){var c=this;if(c.$doTask)return c.next(function(c){c.fetchModels(a,b,d)}),c;c.$doTask=!0;var e=c.$host,f=e.$mCache,h=e.$mCacheKeys,k=c.$reqModels;g.isArray(a)||(a=[a]);var o=
a.length,s=0,r,x,p=Array(o),u=[],A={},w=[],K=g.isArray(b);K&&(u=Array(b.length));for(var M=function(a,j,y,B){if(!c.$destroy){s++;delete k[a.id];var C=a.$mm,D=C.cacheKey;p[j]=a;if(B)x=!0,r=B,A[j]=y;else if(!D||D&&!f.has(D)){D&&f.set(D,a);C.doneAt=g.now();var z=C.after,C=C.meta;z&&i(z,[a,C]);e.fireAfter(C.name,[a])}if(2==d){if(z=K?b[j]:b)m(a),u[j]=i(z,[a,x?{msg:r}:null,x?A:null],c)}else if(4==d){w[j]={m:a,e:x,s:r};for(j=w.i||0;z=w[j];j++)if(C=K?b[j]:b,m(z.m),u[j]=i(C,[z.m,z.e?{msg:z.s}:null,w.e?A:null,
u],c),z.e)A[j]=z.s,w.e=1;w.i=j}if(s>=o)A.msg=r,j=x?A:null,1==d?(m(p,1),p.push(j),u[0]=i(b,p,c),u[1]=j):u.push(j),c.$ntId=setTimeout(function(){c.doNext(u)},30);if(D&&q(h,D))j=h[D].q,delete h[D],i(j,[y,B],a)}},G=0,y;G<a.length;G++)if(y=a[G]){var H;H=e.getModel(y);var B=H.cacheKey;y=H.entity;var L=j(M,y,G);B&&q(h,B)?h[B].q.push(L):H.needUpdate?(k[y.id]=y,B&&(h[B]={q:[],e:y}),y.request(L)):L()}else throw Error("miss attrs:"+a);return c},fetchAll:function(a,b){return this.fetchModels(a,b,1)},saveAll:function(a,
b){a=c(a);return this.fetchModels(a,b,1)},fetchOrder:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOrder:function(a,b){var a=c(a),d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,4)},saveOne:function(a,b){var a=c(a),d=e.call(arguments,1);return this.reqModels(a,1<d.length?d:b,2)},fetchOne:function(a,b){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:b,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,b=this.$host.$mCacheKeys;
if(a)for(var d in a){var c=a[d],e=c.$mm.cacheKey;if(e&&q(b,e)){var f=b[e];delete b[e];i(f,[!0,c,"aborted"],c)}c.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){this.$doTask=!1;var b=this.$queue;b&&(b=b.shift())&&i(b,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});f.mix(h.prototype,
{registerModels:function(a){var b=this.$mMetas;g.isArray(a)||(a=[a]);for(var d=0,c;d<a.length;d++){if((c=a[d])&&!c.name)throw Error("model must own a name attribute");b[c.name]=c}},registerMethods:function(a){var b=this,d;for(d in a)b[d]=function(a){return function(d,c){var e,f=a.call(b,d,function(){e||c.apply(b,arguments)});return{destroy:function(){e=!0;f&&f.destroy&&f.destroy()},fetchAll:1,fetchOne:1}}}(a[d])},createModel:function(a){var b=this.getModelMeta(a),d=new this.$mClass(o(b));d.$mm={used:0};
var c=a.before||b.before;this.fireBefore(b.name,[d]);g.isFunction(c)&&i(c,[d,b,a]);d.$mm.after=a.after||b.after;c=a.cacheKey||b.cacheKey;g.isFunction(c)&&(c=i(c,[b,a]));d.$mm.cacheKey=c;d.$mm.meta=b;d.set(o(a));d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);return d},getModelMeta:function(a){var b=this.$mMetas,d;d=g.isString(a)?a:a.name;b=b[d];if(!b)throw Error("Not found:"+a.name);return b},getModel:function(a){var b=this.getCachedModel(a),
d;b||(d=!0,b=this.createModel(a));return{entity:b,cacheKey:b.$mm.cacheKey,needUpdate:d}},saveAll:function(a,b){return(new s(this)).saveAll(a,b)},fetchAll:function(a,b){return(new s(this)).fetchAll(a,b)},saveOrder:function(a,b){var d=new s(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(a,b){var d=new s(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(a,b){var d=new s(this);return d.saveOne.apply(d,arguments)},fetchOne:function(a,b){var d=new s(this);return d.fetchOne.apply(d,
arguments)},clearCacheByKey:function(a){var b=this.$mCache;g.isString(a)&&b.del(a)},clearCacheByName:function(a){for(var b=this.$mCache,d=b.c,c=0;c<d.length;c++){var e=d[c].v;(e=e&&e.$mm)&&e.meta.name==a&&b.del(e.cacheKey)}},getModelUrl:function(a){a=this.getModelMeta(a);return a.url?a.url:this.$mClass.prototype.url(a.uri)},listenBefore:function(a,b){r.on.call(this,a+"_before",b)},listenAfter:function(a,b){r.on.call(this,a+"_after",b)},unlistenBefore:function(a,b){r.un.call(this,a+"_before",b)},unlistenAfter:function(a,
b){r.un.call(this,a+"_after",b)},fireBefore:function(a,b){r.fire.call(this,a+"_before",b)},fireAfter:function(a,b){r.fire.call(this,a+"_after",b)},getCachedModel:function(a){var b=this.$mCache,d=null,c,e;g.isString(a)?c=a:(e=this.getModelMeta(a),c=a.cacheKey||e.cacheKey,g.isFunction(c)&&(c=i(c,[e,a])));if(c)if(d=this.$mCacheKeys[c])d=d.e;else if(d=b.get(c)){if(!e)e=d.$mm.meta;b=a.cacheTime||e.cacheTime||0;g.isFunction(b)&&(b=i(b,[e,a]));0<b&&g.now()-d.$mm.doneAt>b&&(this.clearCacheByKey(c),d=null)}return d}});
return h},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(g,f){var r=function(c,h,e){for(var k in h)g.isObject(h[k])?(f.has(c,k)||(c[k]={}),r(c[k],h[k],!0)):e&&(c[k]=h[k])},q=function(c){c&&this.set(c);this.id=g.guid("m")},i=encodeURIComponent;f.mix(q,{GET:"GET",POST:"POST",extend:function(c,h){var e=function(){e.superclass.constructor.apply(this,arguments);h&&f.safeExec(h,[],this)};f.mix(e,this,{prototype:!0});r(c,this.prototype);return g.extend(e,this,c)}});f.mix(q.prototype,{urlMap:{},sync:f.noop,parse:function(c){return c},
getPostParams:function(){return this.getParams(q.POST)},getUrlParams:function(){return this.getParams(q.GET)},getParams:function(c){var c=c?c.toUpperCase():q.GET,c=this["$"+c],f=[],e;if(c)for(var k in c)if(e=c[k],g.isArray(e))for(var o=0;o<e.length;o++)f.push(k+"="+i(e[o]));else f.push(k+"="+i(e));return f.join("&")},setUrlParamsIf:function(c,f){this.setParams(c,f,q.GET,!0)},setPostParamsIf:function(c,f){this.setParams(c,f,q.POST,!0)},setParams:function(c,f,e,k){e=e?e.toUpperCase():q.GET;if(!this.$types)this.$types=
{};this.$types[e]=!0;e="$"+e;this[e]||(this[e]={});if(g.isObject(c))for(var i in c){if(!k||!this[e][i])this[e][i]=c[i]}else if(c&&(!k||!this[e][c]))this[e][c]=f},setPostParams:function(c,f){this.setParams(c,f,q.POST)},setUrlParams:function(c,f){this.setParams(c,f,q.GET)},reset:function(){var c=this.$types;if(c){for(var h in c)f.has(c,h)&&delete this["$"+h];delete this.$types}c=this.$keys;h=this.$attrs;if(c){for(var e=0;e<c.length;e++)delete h[c[e]];delete this.$keys}},url:function(c){var f=this.get("url");
if(c=c||this.get("uri")){var f=c.split(":"),e=this.urlMap;if(e){for(var g=0,i=f.length;g<i&&!(e=e[f[g]],!e);g++);c=e||c}f=c}else if(!f)throw Error("model not set uri and url");return f},get:function(c){var f=!arguments.length,e=this.$attrs;return e?f?e:e[c]:null},set:function(c,f,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(g.isObject(c))for(var i in c)e&&this.$keys.push(i),this.$attrs[i]=c[i];else c&&(e&&this.$keys.push(c),this.$attrs[c]=f)},request:function(c,f){c||(c=function(){});
var e=g.isFunction(c),i=c.success,o=c.error,j=this;j.$abort=!1;var m=function(m,a){if(!j.$abort)if(a)e&&c(m,a,f),o&&o.call(j,a);else{if(m){var b=j.parse(m);g.isObject(b)||(b={data:b});j.set(b,null,!0)}e&&c(m,a,f);i&&i.call(j,m)}};m.success=function(c){m(c)};m.error=function(c){m(null,c||"request error")};j.$trans=j.sync(m,f)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=
g.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return q},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(g,f,r,q){var i=window,c=function(a){i.clearTimeout(a);i.clearInterval(a)},h=function(a){k(a.destroy,[],a)},e=0,k=f.safeExec,o=f.has,j={},m=function(a){if(!m.d)m.d=1,a.on("add",function(a){var a=a.vframe,d=j[a.id];if(d){for(var c=0;c<d.length;c++)s(a,d[c]);delete j[a.id]}}),a.on("remove",function(a){delete j[a.vframe.id]}),a.root().on("created",function(){j={}})},s=function(a,b){var d=a.view;if(d&&a.viewInited)k(d.receiveMessage,b,d);else{var c=function(d){a.un("viewInited",
c);k(d.view.receiveMessage,b,d.view)};a.on("viewInited",c)}};return r.extend({mxViewCtor:f.noop,navigate:function(){q.navigate.apply(q,arguments)},manage:function(a,b){var d=!0;1==arguments.length&&(b=a,a="res_"+e++,d=!1);if(!this.$res)this.$res={};var f;g.isNumber(b)?f=c:b&&b.destroy&&(f=h);this.$res[a]={hasKey:d,res:b,destroy:f};return b},getManaged:function(a){var b=this.$res;return b&&o(b,a)?b[a].res:null},removeManaged:function(a){var b=null,d=this.$res;if(d)if(o(d,a))b=d[a].res,delete d[a];
else for(var c in d)if(d[c].res===a){b=d[c].res;delete d[c];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);e.hasKey||delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}"destroy"==a.type&&delete this.$res}},receiveMessage:f.noop,postMessageTo:function(a,b){var c=this.vom;m(c);f.isArray(a)||(a=[a]);b||(b={});for(var e=0,g;e<a.length;e++){g=a[e];var h=c.get(g);h?s(h,b):(j[g]||(j[g]=[]),j[g].push(b))}},
destroyMRequest:function(){var a=this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.home=f.config().appHome;a.beginUpdateHTML=a.beginUpdate;a.endUpdateHTML=a.endUpdate;a.on("interact",function(){a.on("rendercall",a.destroyMRequest);a.on("prerender",a.destroyManaged);a.on("destroy",a.destroyManaged)});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(g){var f=function(){};if(!g.console)g.console={log:f,info:f,error:f};var r,q={};if(!g.Magix)g.Magix={config:function(f){for(var c in f)q[c]=f[c]},start:function(f){r=f}},KISSY.use("magix/magix",function(f,c){g.Magix=c;c.config(q);r&&c.start(r)})})(this);